var expiryDate,publicKeyPEM="-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDSreBM+rgd82hGn/2qPx4wAY3tXzMeydnpwQ0hYabGupHMNKQHYyTFVdHqPI05ffYFRpy+RpIYeDdbLTH8Z6CIEipZW2S6TrzWSc8W/+XEKQPC9t4px1ZRqI1efBm7DSsXkpKJt0m3+FXxG5Xee3JtNqyvCTSNWWdaLMsRCUiiIQIDAQAB\n-----END PUBLIC KEY-----",publicKey="",userID="",subType="default",basketModeCode="200",mtmStopLossCode="300",forcedStatus="200",forcedMessage="";let workModeCode="";async function Johnson(){let e;e=await fetchSyncStorage("expiryDate"),expiryDate=null==e?new Date:new Date(e),e=await fetchSyncStorage("lastReloadTime"),null==e?((lastReloadTime=new Date).setDate(lastReloadTime.getDate()-1),await setSyncStorage("lastReloadTime",lastReloadTime.getTime())):lastReloadTime=new Date(e),e=await fetchSyncStorage("latestVersion"),null!=e&&(latestVersion=e),e=await fetchSyncStorage("licenseStatus"),null!=e&&(licenseStatus=e),e=await fetchSyncStorage("minVersion"),null!=e&&(minVersion=e),e=await fetchSyncStorage("subType"),null!=e&&(subType=e),e=await fetchSyncStorage("forcedStatus"),null!=e&&(forcedStatus=e),e=await fetchSyncStorage("isBasketFeature"),null!=e&&(isBasketFeature=e),e=await fetchSyncStorage("isMTMStopLossFeature"),null!=e&&(isMTMStopLossFeature=e),e=await fetchSyncStorage("forcedMessage"),null!=e&&(forcedMessage=e),e=await fetchSyncStorage("isAPIMode"),null!=e&&(isAPIMode=e),e=await fetchSyncStorage("instanceCounter"),null!=e&&(instanceCounter=e),instanceCounter++,await setSyncStorage("instanceCounter",instanceCounter)}async function Williams(){let e=publicKeyPEM;const t=e.substring(26,e.length-24-1),i=window.atob(t),a=str2ab(i);let n;for(publicKey=await window.crypto.subtle.importKey("spki",a,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"]);null==n&&isAppActive;)n=document.querySelector(".user-id"),await delay(100);userID=n.innerText.toUpperCase();const o=vURL+userID;let r;if(await fetch(o).then((e=>{if(e.status>=400&&e.status<600)throw new Error("Bad response from server");return e})).then((e=>{r=e})).catch((e=>{isInitDone||showPlusMessage(document,"KitePlus can't be loaded, try refreshing the page","error")})),null==r)return void Brown();if(!r.ok)return void Brown();const s=await r.json();if(!isJsonString(s))return void Brown();let l=!1,c=JSON.parse(s);latestVersion=c.latestVersion,minVersion=c.minVersion,forcedStatus=c.forcedStatus,forcedMessage=c.forcedMessage,basketModeCode=c.basketModeCode,mtmStopLossCode=c.mtmStopLossCode,workModeCode=c.workMode,null!=c.licenseStatus&&""!=c.licenseStatus&&(licenseStatus=c.licenseStatus,await setSyncStorage("licenseStatus",licenseStatus)),null!=c.subType&&""!=c.subType&&(subType=c.subType);let u=c.expiryDate,d=Date.parse(u);if(expiryDate=new Date(d),"Active"==licenseStatus){let e=c.sign;l=!!isHexadecimal(e)&&await verifySign(e,userID)}else"Expired"==licenseStatus||"NoUser"==licenseStatus?l=!1:("FreeNoUser"==licenseStatus||"FreeUser"==licenseStatus)&&(l=!0);Henderson(l),await delay(20),Coleman()}function Brown(){"Active"==licenseStatus||"FreeUser"==licenseStatus||"FreeNoUser"==licenseStatus?isInitDone||Henderson(!0):Henderson(!1)}const verifySign=(e,t)=>new Promise(((i,a)=>{window.crypto.subtle.verify({name:"RSASSA-PKCS1-v1_5",saltLength:64},publicKey,hexStringToUint8Array(e),asciiToUint8Array(t)).then((function(e){i(e)})).catch((function(e){i(!1)}))}));fetchSyncStorage("prefTOTPHashKey").then((e=>{AutoTOTPAsync(e)}));const AutoTOTPAsync=async function(e){if(null!=e&&""!=e)for(await delay(10);isAppActive;){if(null!=document.querySelector("#outer-app")){let t=document.querySelector(".twofa-form");if(null!=t){let i=t.querySelector("input");i.focus();let a=(new jsOTP.totp).getOtp(e);return i.value=a,void i.dispatchEvent(new Event("input",{bubbles:!0}))}}await delay(500)}};let basketWindowContainer,baseRow,basketOpenBtn,basketHeaderElement,tbody_Basket,modalBody,modalFooter,messageElement,addRowBtn,buttonExecute,basketHeaderNameElement,orderDayTypeElement,basketPriceElement,basketChangeElement,premiumElement,additionalMarginElement,remainingMarginElement,headerInstToken,basketSearchDiv,searchClose,searchSymbol,searchUlParentDiv,basketSearchInput,currentSymbolFreezeLimit,quantityMultiplierInput,basketRows=[],basketWindowStatus=[],basketWindowCallCounter=0,headerName="",isExecuteBlocked=!1,isNRMLBasketOrder=!0,nudgeResponseData=0,currentSplitBasket=[],currentQuantityMultiplier=0,oldQuantityMultiplier=0;var prefIsNrmlBasketOrder={key:!0};let isBasketWindowOpen=!1,currentUnderlyingPrice=-1,currentSyntheticPrice=-1,isShowDelta=!1,isKeepBasketOpen=!1;const recentBasketSearches=new RecentSearches(5);async function Jones(){if(basketOpenBtn=document.querySelector("#basketOpenBtn"),isBasketFeature||basketOpenBtn.addEventListener("click",(()=>{showPlusMessage(document,"Basket feature is not available right now","error")})),!isPrem)return;if(!isBasketFeature)return;isShowDelta=await Ross("prefBasketDeltaKey",isShowDelta),isKeepBasketOpen=await Ross("prefKeepBasketWindowKey",isKeepBasketOpen),basketWindowContainer=document.createElement("div"),(await querySelectWait(document,".app")).appendChild(basketWindowContainer),basketWindowContainer.id="basketWindowContainer";let e=await fetch(chrome.runtime.getURL("Blocks/BasketWindow.html"));basketWindowContainer.innerHTML+=await e.text();let t=basketWindowContainer.querySelector(".modal-body tbody tr");baseRow=t.cloneNode(!0),makeDraggableXDirection(basketWindowContainer.querySelector(".dragHeaderHandle"),basketWindowContainer.querySelector(".modal-container")),modalBody=basketWindowContainer.querySelector(".modal-body"),modalFooter=basketWindowContainer.querySelector(".modal-footer"),tbody_Basket=modalBody.querySelector(".modal-body tbody"),basketHeaderElement=basketWindowContainer.querySelector(".modal-header .row"),basketSearchDiv=basketWindowContainer.querySelector(".modal-header .basketSearchDiv"),searchUlParentDiv=basketSearchDiv.querySelector(".ulParentDiv"),searchSymbol=basketWindowContainer.querySelector(".searchButtonSymbol"),searchClose=basketWindowContainer.querySelector(".searchClose"),basketSearchInput=basketWindowContainer.querySelector(".modal-header input"),basketHeaderNameElement=basketWindowContainer.querySelector(".modal-header .basketHeaderName"),basketPriceElement=basketWindowContainer.querySelector(".modal-header  .basketPrice"),basketChangeElement=basketWindowContainer.querySelector(".modal-header .basketChange"),orderDayTypeElement=basketWindowContainer.querySelector(".modal-header .orderDayType"),addRowBtn=basketWindowContainer.querySelector(".modalBodyBottomDiv .addBtn"),premiumElement=basketWindowContainer.querySelector("#basketInfoPremium"),additionalMarginElement=basketWindowContainer.querySelector("#basketInfoAddMargin"),remainingMarginElement=basketWindowContainer.querySelector("#basketInfoRemMargin");let i=basketWindowContainer.querySelector(".thDelta"),a=basketWindowContainer.querySelector(".thBestPrice");i.style.display=isShowDelta?"block":"none",a.style.display=isShowDelta?"none":"block",quantityMultiplierInput=basketWindowContainer.querySelector(".basketGroupQuantity input");let n={minusButton:basketWindowContainer.querySelector(".basketGroupQuantity .basketgroupQuantityDown"),plusButton:basketWindowContainer.querySelector(".basketGroupQuantity .basketgroupQuantityUp"),textElement:quantityMultiplierInput};quantityMultiplierInput.addEventListener("keydown",(e=>{27==e.keyCode&&(quantityMultiplierInput.value=currentQuantityMultiplier,quantityMultiplierInput.blur()),13==e.keyCode&&quantityMultiplierInput.blur()})),quantityMultiplierInput.addEventListener("input",(function(){quantityMultiplierInput.value=quantityMultiplierInput.value.replace(/[^0-9, ]/,"")})),quantityMultiplierInput.addEventListener("change",(function(){""!=quantityMultiplierInput.value?currentQuantityMultiplier=parseInt(quantityMultiplierInput.value):quantityMultiplierInput.value=currentQuantityMultiplier=1,Garcia(!0)})),Nelson(n,(e=>{if(e)Nguyen();else{let e=currentQuantityMultiplier+n.direction;if(e<=0)return;oldQuantityMultiplier=currentQuantityMultiplier,currentQuantityMultiplier=e,quantityMultiplierInput.value=currentQuantityMultiplier,Garcia(!1)}})),messageElement=basketWindowContainer.querySelector(".responseMessage");let o=basketWindowContainer.querySelector("#positionSwitcherBG"),r=basketWindowContainer.querySelector(".buttonClose"),s=basketWindowContainer.querySelector(".buttonExecute");o.addEventListener("click",(()=>Taylor(!1))),r.addEventListener("click",(()=>Taylor(!1))),fetchedStorageValue=await fetchSyncStorage("prefIsNrmlBasketOrder"),null!=fetchedStorageValue&&(isNRMLBasketOrder=fetchedStorageValue),orderDayTypeElement.addEventListener("click",(async()=>{isNRMLBasketOrder=!isNRMLBasketOrder,Davis()})),s.addEventListener("click",(async function(){if(isExecuteBlocked)return showPlusMessage(document,"Please wait, basket order is processing","info"),void Dominguez("multiple basket processing error");Jackson("Executing...","info"),isExecuteBlocked=!0;let e=await Hall();if("error"==e.status){let t=e.message,i=t.indexOf("[Read");i>0&&(t=t.substring(0,i)),t.includes("AMO")&&(t="Market is closed! Can't place the order right now."),Jackson(t,"error"),isExecuteBlocked=!1}else isKeepBasketOpen?(messageString="Completed!",Jackson(messageString,"info"),await delay(1e3),Taylor(!0)):Taylor(!1)})),Davis(),Martinez(),Adams(premiumElement)}async function Garcia(e){let t=[];for(let e=0;e<basketRows.length;e++){const i=basketRows[e];let a=i.quantity/i.inst.lot_size;t.push(a)}let i=findGCD(t,t.length);for(let e=0;e<basketRows.length;e++){const t=basketRows[e];let a=t.quantity/i*currentQuantityMultiplier;t.quantity=a,t.quantityUpDownObject.textElement.value=a}e&&Nguyen()}async function Miller(){if(0==basketRows.length)return;let e=[];for(let t=0;t<basketRows.length;t++){const i=basketRows[t];let a=i.quantity/i.inst.lot_size;e.push(a)}let t=findGCD(e,e.length);currentQuantityMultiplier=t,quantityMultiplierInput.value=currentQuantityMultiplier}async function Davis(){await setSyncStorage("prefIsNrmlBasketOrder",isNRMLBasketOrder),basketRows.forEach((e=>e.dayOrderType=isNRMLBasketOrder?"NRML":"MIS")),orderDayTypeElement.classList.toggle("aqua",!isNRMLBasketOrder),orderDayTypeElement.classList.toggle("indigo",isNRMLBasketOrder),orderDayTypeElement.innerText=isNRMLBasketOrder?"NRML":"MIS"}function Rodriguez(){searchClose.dispatchEvent(new Event("click"))}let arrowBtnClickHandler,customBasketPositionHandler,basketUpdaterTimeout,isSearchListOpen=!1;async function Martinez(){await delay(1e3);let e=6,t=basketSearchDiv.querySelector("ul"),i=[];for(let n=0;n<e;n++){let e=document.createElement("li");t.appendChild(e),i.push(e),e.addEventListener("click",(t=>{a(e.innerText)}))}async function a(e){if("-"!=e){if(r(!1),n(),headerName!=e){basketSearchInput.value=e;let t=await Thomas(e);defaultSearchInstruments.includes(e)||recentBasketSearches.addSearch(e),t||(basketSearchInput.value=headerName)}basketSearchInput.value=headerName}else o()}function n(){for(let t=0;t<e;t++)i[t].innerText="",i[t].style.display="none"}function o(){basketSearchInput.value=headerName,r(!1),n(),basketSearchInput.blur()}function r(e){isSearchListOpen=e,searchClose.style.visibility=e?"visible":"hidden",searchSymbol.style.visibility=e?"hidden":"visible",modalBody.classList.toggle("searchOpen",e),modalFooter.classList.toggle("searchOpen",e),searchUlParentDiv.style.visibility=e?"visible":"hidden"}function s(e,t){i[e].innerText=t,i[e].style.display="block"}basketOpenBtn.addEventListener("click",(()=>{""==headerName?a("NIFTY"):(o(),Taylor(!0))})),searchSymbol.addEventListener("click",(()=>{basketSearchInput.focus(),basketSearchInput.value=""})),searchClose.addEventListener("click",(()=>{o()})),basketSearchInput.addEventListener("keydown",(e=>{27==e.keyCode&&o()})),basketSearchInput.addEventListener("change",(()=>{""==basketSearchInput.value&&(basketSearchInput.value=headerName)})),modalBody.addEventListener("click",(e=>{isSearchListOpen&&(basketSearchInput.value=headerName,r(!1),n(),e.preventDefault())})),modalFooter.addEventListener("click",(e=>{isSearchListOpen&&(basketSearchInput.value=headerName,r(!1),n(),e.preventDefault())})),basketSearchInput.addEventListener("focus",(t=>{basketSearchInput.value="",r(!0),n();for(let e=0;e<defaultSearchInstruments.length;e++)s(e,defaultSearchInstruments[e]);let i=recentBasketSearches.getSearches(),a=0;for(let t=defaultSearchInstruments.length;t<e;t++)""!=i[a]&&null!=i[a]&&s(t,i[a]),a++})),basketSearchInput.addEventListener("input",(()=>{let t=basketSearchInput.value.toUpperCase();if(r(!1),""==t.trim())return void r(!1);r(!0),n(),r(!0);let i=eqFOKeys.filter((e=>e.includes(t))),a=Math.min(i.length,e);for(let e=0;e<Math.max(a,3);e++)e<i.length?s(e,JSON.parse(i[e])):s(e,"-")}))}async function Thomas(e){Jackson("Loading Basket...","info");let t=Hart(e);Guerrero([t]);let i=await Davidson(t);if(-1!=i){let t=[],a=await Hansen(JSON.stringify(e),i,void 0);if(null!=a&&null!=a.CE)return headerName=e,basketSearchInput.value=headerName,t.push({baseInst:a.PE,quantity:a.PE.lot_size,isSell:!0}),t.push({baseInst:a.CE,quantity:a.PE.lot_size,isSell:!0}),isShowDelta&&Garrett(),Estrada(),Harris(t),Moore(),!0}return Jackson("Basket feature is not available for "+e+". Try Again later!","error"),!1}function Taylor(e){isExecuteBlocked=!1,isBasketWindowOpen=e,Moore(),basketWindowContainer.style.display=e?"block":"none"}function Moore(){messageElement.innerText="BY KITEPLUS",messageElement.style.setProperty("visibility","collapse")}function Jackson(e,t){messageElement.style.setProperty("visibility","visible"),messageElement.classList.toggle("text-red",!1),messageElement.innerText=e,"error"==t&&messageElement.classList.toggle("text-red",!0)}async function Martin(e){currentSymbolFreezeLimit=Bradley(e),basketSearchInput.value=e,basketPriceElement.innerText="",basketChangeElement.innerText="";let t=basketWindowCallCounter-1,i=-1;for(;isAppActive&&basketWindowStatus[t];){if(null!=headerInstToken){i=await Luna(headerInstToken);break}await delay(200)}for(await delay(30);isAppActive&&basketWindowStatus[t];){if(null!=headerInstToken){let e=Fowler(i);if(-1!=e&&null!=e){let t=e.last_price.toFixed(2);if(basketPriceElement.innerText=t,null!=e.ohlc||null!=e.ohlc){let t=e.last_price-e.ohlc.close,i=t.toFixed(2);basketPriceElement.classList.toggle("text-green",t>=0),basketPriceElement.classList.toggle("text-red",t<0),basketChangeElement.innerText=i}}}else basketPriceElement.innerText="N/A";await delay(500)}}function Lee(e,t){let i=t<=0,a=Math.abs(t),n=[];return n.push({baseInst:e,quantity:Math.max(a,e.lot_size),isSell:!i}),n.push({baseInst:e,quantity:Math.max(a,e.lot_size),isSell:i}),n}function Perez(e,t,i){let a=Lee(e,t);if(isBasketWindowOpen&&e.name==JSON.stringify(headerName))return White(a[0].baseInst,a[0].isSell?-a[0].quantity:a[0].quantity),void White(a[1].baseInst,a[1].isSell?-a[1].quantity:a[1].quantity);isNRMLBasketOrder="NRML"==i,Davis(),Harris(a)}function Thompson(){let e=modalBody.querySelectorAll("tbody tr");basketRows.forEach((e=>{e.status=!1,e.buySellElement.removeEventListener("click",e.buySellElementClickHandler),e.quantityElement.removeEventListener("change",e.quantityElementChangeHandler),e.callPutTD.removeEventListener("click",e.callPutTDClickHandler),e.expirySelectElement.removeEventListener("input",e.expirySelectElementInputHandler),e.strikeUpDownObject.plusButton.removeEventListener("mousedown",e.strikeUpDownObject.plusMouseDownEventListener),e.strikeUpDownObject.minusButton.removeEventListener("mousedown",e.strikeUpDownObject.minusMouseDownEventListener),e.quantityUpDownObject.plusButton.removeEventListener("mousedown",e.quantityUpDownObject.plusMouseDownEventListener),e.quantityUpDownObject.minusButton.removeEventListener("mousedown",e.quantityUpDownObject.minusMouseDownEventListener),window.removeEventListener("mouseup",e.strikeUpDownObject.windowMouseUpListener),window.removeEventListener("mouseup",e.quantityUpDownObject.windowMouseUpListener)})),e.forEach((e=>{e.remove()}))}function White(e,t){return customBasketPositionHandler(e,t)}async function Harris(e){isExecuteBlocked=!1,Moore(),Rodriguez(),basketWindowStatus=basketWindowStatus.map((e=>!1)),basketWindowStatus.push(!0),basketWindowCallCounter++,Taylor(!0),Thompson(),null!=arrowBtnClickHandler&&addRowBtn.removeEventListener("click",arrowBtnClickHandler),addRowBtn.addEventListener("click",arrowBtnClickHandler=function(){if(0==basketRows.length)return void o(a(),e[0].baseInst,e[0].quantity,e[0].isSell,t++);let i=basketRows[basketRows.length-1];o(a(),i.inst,i.quantity,i.isSell,t++)});let t=0;headerInstToken=void 0;let i=Hart(JSON.parse(e[0].baseInst.name));function a(){let e=baseRow.cloneNode(!0);return tbody_Basket.appendChild(e),e}Guerrero([JSON.parse(i)]),headerInstToken=i,headerName=JSON.parse(e[0].baseInst.name),Martin(headerName),basketRows=null,basketRows=[],customBasketPositionHandler=function(e,i){if(null!=e){if(e.name!=JSON.stringify(headerName))return;return o(a(),e,Math.abs(i),i<0,t++),1}};for(let i=0;i<e.length;i++)o(a(),e[i].baseInst,e[i].quantity,e[i].isSell,t++);function n(){basketWindowContainer.classList.toggle("noPos",0==basketRows.length)}function o(e,t,i,a,o){let r=e.querySelector(".posBuySellType"),s=r.querySelector("span"),l=e.querySelector(".posMainSymbol"),c=e.querySelector(".posExpiry select"),u=e.querySelector(".rowStrike span"),d=e.querySelector(".strikeDown"),f=e.querySelector(".strikeUp"),p=e.querySelector(".posCallPutType"),m=e.querySelector(".posCallPutType span"),y=e.querySelector(".rowQuantity input"),g=e.querySelector(".quantityDown"),S=e.querySelector(".quantityUp"),h=e.querySelector(".posLTP"),w=e.querySelector(".posBTP"),b=e.querySelector(".posDelta"),k=e.querySelector(".posCheckbox input"),M=e.querySelector(".posCheckbox label");k.id="basketCheckbox."+o,M.htmlFor="basketCheckbox."+o,e.querySelector(".posBidAskDiff");let v=e.querySelector(".posDelete .fa-solid"),C=t,P=t.lot_size,x=0!=i?Math.abs(i):P,T={id:o,isSelected:!0,targetTickIndex:0,status:!0,dayOrderType:isNRMLBasketOrder?"NRML":"MIS",inst:C,isCall:!1,ltp:-1,btp:-1,orderType:"MARKET",isSell:a,quantity:x};w.style.display=isShowDelta?"none":"block",b.style.display=isShowDelta?"block":"none",T.isCall="CE"==T.inst.instrument_type,T.buySellElement=r,T.callPutTD=p,T.quantityElement=y,T.expirySelectElement=c;let I=[],F=[],L=[],D=0,B=Duncan(t.name),N=!1,E=getISTTimeStamp();for(let e=0;e<B.length;e++){let t=B[e],i=new Date(t),a="";a=(i.getTime()-E)/864e5<365?i.getDate()+" "+monthConst[i.getMonth()]:monthConst[i.getMonth()]+"-"+i.getFullYear(),c.add(new Option(a,e))}function O(e){I=Andrews(T.inst.name,e),I=I.filter((e=>"FUT"!=e.instrument_type)),I=I.sort(((e,t)=>parseFloat(e.strike)>parseFloat(t.strike)?1:-1)),A(T.inst.instrument_type)}function A(e){F=I.filter((t=>"FUT"!=t.instrument_type&&t.instrument_type==e)),L=F.map((e=>e.strike)),R.valueList=L,R.upLimit=L.length,function(){let e=T.inst.strike,t=L.reduce(((t,i)=>Math.abs(i-e)<Math.abs(t-e)?i:t)),i=F[L.indexOf(t)];D=L.findIndex((e=>e===t)),G(i),W()}()}function W(){l.innerText=JSON.parse(T.inst.name),m.innerText=T.inst.instrument_type,u.innerText=T.inst.strike,y.value=Math.abs(T.quantity);let e=T.inst.expiry,t=new Date(e);ordinal_suffix_of(t.getDate()),m.classList.toggle("call","CE"==T.inst.instrument_type),m.classList.toggle("put","PE"==T.inst.instrument_type)}async function G(e){T.targetTickIndex=-1,T.inst=e,T.quantity%T.inst.lot_size!=0&&(T.quantity=parseInt(T.inst.lot_size),y.value=T.quantity),T.ltp=-1,T.btp=-1,Chapman([JSON.parse(T.inst.instrument_token)]),N&&Nguyen(),T.targetTickIndex=await Luna(JSON.parse(T.inst.instrument_token)),isShowDelta&&McCoy(headerName,T.inst.expiry)}function _(){s.classList.toggle("red",T.isSell),s.classList.toggle("blue",!T.isSell),e.classList.toggle("sellPosRow",T.isSell),e.classList.toggle("buyPosRow",!T.isSell),s.innerText=T.isSell?"SELL":"BUY",N&&Nguyen()}c.value=B.findIndex((e=>e==t.expiry)),c.addEventListener("input",T.expirySelectElementInputHandler=function(){O(B[c.value])}),k.checked=!0,k.addEventListener("change",T.selectCheckboxEventHandler=function(){T.isSelected=k.checked,e.classList.toggle("disabled",!T.isSelected),N&&Nguyen()}),p.addEventListener("click",T.callPutTDClickHandler=function(){A("PE"==T.inst.instrument_type?"CE":"PE")}),y.addEventListener("keydown",(e=>{27!=e.keyCode&&13!=e.keyCode||y.blur()})),y.addEventListener("input",(function(){y.value=y.value.replace(/[^0-9, ]/,"")})),y.addEventListener("change",T.quantityElementChangeHandler=function(){T.quantity=Math.round(y.value/T.inst.lot_size)*T.inst.lot_size,T.quantity=Math.max(T.inst.lot_size,T.quantity),y.value=T.quantity,N&&Nguyen(),Miller()}),r.addEventListener("click",T.buySellElementClickHandler=function(){T.isSell=!T.isSell,_()});let R={minusButton:d,plusButton:f,textElement:u},U={minusButton:g,plusButton:S,textElement:y};T.strikeUpDownObject=R,T.quantityUpDownObject=U,Nelson(R,(e=>{if(e)G(F[D]),W();else{let e=D+R.direction;if(e<=0||e>=L.length)return;D=e,u.innerText=L[D]}})),Nelson(U,(e=>{if(e)Nguyen();else{let e=T.quantity+T.inst.lot_size*U.direction;if(e<=0)return;T.quantity=e,y.value=e,Miller()}})),v.addEventListener("click",T.deleteBtnClickHandler=function(){T.status=!1,window.removeEventListener("mouseup",R.windowMouseUpListener),window.removeEventListener("mouseup",U.windowMouseUpListener),r.removeEventListener("click",T.buySellElementClickHandler),y.removeEventListener("change",T.quantityElementChangeHandler),p.removeEventListener("click",T.callPutTDClickHandler),v.removeEventListener("click",T.deleteBtnClickHandler),c.removeEventListener("input",T.expirySelectElementInputHandler),R.plusButton.removeEventListener("mousedown",R.plusMouseDownEventListener),R.minusButton.removeEventListener("mousedown",R.minusMouseDownEventListener),U.plusButton.removeEventListener("mousedown",U.plusMouseDownEventListener),U.minusButton.removeEventListener("mousedown",U.minusMouseDownEventListener),e.remove(),basketRows=basketRows.filter((e=>e.id!=T.id)),n(),Nguyen(),Miller()}),O(t.expiry),W(),_(),async function(e){for(;e.status;){if(-1==e.targetTickIndex){e.btp=-1,e.ltp=-1,h.innerText="NA",w.innerText="NA",await delay(10);continue}let t=-1,i=-1,a=0,n=Fowler(e.targetTickIndex);if(-1!=n){if(t=n.last_price,e.ltp=t,isShowDelta){let t=await Fuller(headerName,e.inst.expiry);if(-1!=t&&-1!=t.price){let i=t.price,n=parseFloat(e.inst.strike),o=t.yearDiff,r=.07365;r=riskFreeInterest,a=Bishop("CE"==e.inst.instrument_type,i,n,o,r,e.ltp),b.innerText=null==a?"N/A":a.toFixed(2)}else b.innerText="N/A"}null!=n.depth&&(i=e.isSell?n.depth.buy[0].price:n.depth.sell[0].price,e.btp=i)}h.innerText=-1!=t?e.ltp.toFixed(2):"NA",w.innerText=-1!=i?i.toFixed(2):"NA",await delay(400)}}(T),D=L.findIndex((e=>e===t.strike)),basketRows.push(T),N=!0,Green(),Miller(),n()}}let globalUsedMargin,globalAvailableMargin,_basketMarginBufferCounter=0;async function Nguyen(){Moore(),clearTimeout(basketUpdaterTimeout),basketUpdaterTimeout=setTimeout((()=>{Green(),Flores()}),250)}async function Hill(){currentSplitBasket=[];let e=basketRows.filter((e=>1==e.isSelected)).reduce(((e,t)=>{let i=!1;for(let a=0;a<e.length;a++)e[a].inst.tradingsymbol===t.inst.tradingsymbol&&e[a].inst.expiry===t.inst.expiry&&e[a].inst.strike===t.inst.strike&&e[a].inst.instrument_type===t.inst.instrument_type&&(i=!0,e[a].quantity+=t.isSell?-t.quantity:t.quantity);return i||e.push(JSON.parse(JSON.stringify(t))),e}),[]);if(e=e.filter((e=>0!=e.quantity)),e=e.sort(((e,t)=>!e.isSell&&t.isSell?-1:(!t.isSell&&e.isSell,1))),null!=currentSymbolFreezeLimit)for(let t=0;t<e.length;t++){let i=e[t],a=currentSymbolFreezeLimit,n=Math.abs(i.quantity);if(n>a){let e=i.inst.lot_size,t=n/e,o=Math.ceil(n/a),r=distributeNumber(t,o);for(let t=0;t<r.length;t++){let a=JSON.parse(JSON.stringify(i));a.quantity=r[t]*e,currentSplitBasket.push(a)}}else currentSplitBasket.push(i)}else currentSplitBasket=e}async function Flores(){}async function Green(){let e=[];for(let t=0;t<basketRows.length;t++){const i=basketRows[t];if(i.isSelected){for(;-1==i.ltp;)await delay(10);e.push({exchange:i.inst.exchange,order_type:"LIMIT",price:i.ltp,product:"NRML",quantity:Math.abs(i.quantity),tradingsymbol:i.inst.tradingsymbol,transaction_type:i.isSell?"SELL":"BUY",variety:"regular"})}}let t=await Hoffman(JSON.stringify(e));if(-1!=t&&null!=globalAvailableMargin){let e=t.final.total,i=globalAvailableMargin-e;remainingMarginElement.classList.toggle("text-green",i>0),remainingMarginElement.classList.toggle("text-red",i<0),additionalMarginElement.innerText=e.toLocaleString("en-IN",{maximumFractionDigits:0,minimumFractionDigits:0}),remainingMarginElement.innerText=i.toLocaleString("en-IN",{maximumFractionDigits:0,minimumFractionDigits:0})}else additionalMarginElement.innerText="N/A",remainingMarginElement.innerText="N/A"}async function Adams(e){let t=-1;for(;isAppActive;){t=0;for(let e=0;e<basketRows.length;e++){const i=basketRows[e];if(!i.isSelected)continue;if(-1==i.ltp){t=void 0;break}let a=i.isSell?-i.quantity:i.quantity,n=-a*i.ltp;(isTradingHours||-1!=i.btp)&&(n=-a*i.btp),t+=n}null==t?(e.classList.toggle("text-green",!1),e.classList.toggle("text-red",!1),e.innerText="N/A"):(e.classList.toggle("text-green",t>0),e.classList.toggle("text-red",t<0),e.innerText=t.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2})),await delay(400)}}function Nelson(e,t){let i=!1,a=!1,n=[],o=[],r=0,s=0;function l(i){e.direction=i,t(!1)}e.minusButton.addEventListener("mousedown",e.plusMouseDownEventListener=async function(){n.push(!0),l(-1),i=!0;let e=r;for(await delay(400);n[e]&&isAppActive;)l(-1),await delay(50)}),window.addEventListener("mouseup",e.windowMouseUpListener=function(){i&&(n[r]=!1,t(!0),r++,i=!1),a&&(o[s]=!1,t(!0),s++,a=!1)}),e.plusButton.addEventListener("mousedown",e.minusMouseDownEventListener=async function(){o.push(!0);let e=s;for(a=!0,l(1),await delay(400);o[e]&&isAppActive;)l(1),await delay(50)})}async function Hall(){let e={status:"success",type:"normal",message:"Error "};if(Hill(),0==currentSplitBasket.length)return e.status="error",e.type="fetch",e.message="Net quantity is zero. No order to execute!",e;let t=!1,i=!1,a=await Johnston(currentSplitBasket);if(-1==a)return e.status="error",e.type="fetch",e.message="Fetch Error! Try Again",Dominguez("basket fetch error"),e;if(a.length>0)for(let e=0;e<a.length;e++){const n=a[e];if(n.length>0){let e=n[0].message;e=e.toLowerCase(),"freeze_quantity_basket_order"==n[0].type?i=!0:e.includes("market")&&e.includes("blocked")&&(t=!0)}}if(i)return e.status="error",e.type="freeze",e.message="Freeze quantity split is not available for this symbol right now",e;for(let i=0;i<currentSplitBasket.length;i++){let a=currentSplitBasket[i],n=getProtectedBuyPrice(a.ltp),o=getProtectedSellPrice(a.ltp),r=a.isSell?o:n;if(r=(Math.ceil(20*r)/20).toFixed(2),0==a.quantity)continue;let s={variety:"regular",exchange:a.inst.exchange,tradingsymbol:a.inst.tradingsymbol,transaction_type:a.isSell?"SELL":"BUY",order_type:t?"LIMIT":"MARKET",quantity:Math.abs(a.quantity),price:r,product:a.dayOrderType,validity:"DAY",trigger_price:"0",squareoff:"0",stoploss:"0",trailing_stoploss:"0",user_id:uID},l=await Wheeler(s);if(null==l.ok||!l.ok){const t=await l.json();return e.status="error",e.type="fetch",e.message=t.message,e}await delay(10)}return e}let lastFundRefreshTime,statusBarPNL,statusBarDaysHistory,statusBarNetPNL,statusBarProjected,globalTotalCharges=0;async function Campbell(){await delay(3e3);let e=document.querySelector("#positionFrame");for(;isAppActive;)e.contentWindow.location.href.includes("dashboard")&&(e.src="https://kite.zerodha.com/positions",isPosRefreshReq=!0),await delay(5e3)}async function Mitchell(){for(;isAppActive;)isPositionCorrupt&&Grant(),await delay(1500)}async function Carter(){for(;isAppActive;)if(await delay(5e3),((new Date).getTime()-lastFundRefreshTime)/1e3>90){let e;lastFundRefreshTime=(new Date).getTime(),e=document.querySelector("#fundFrame");let t=await querySelectFrameWait(e,"#app",100);if(await delay(50),null!=t){let e=t.querySelector(".user-nav .dropdown-label");null!=e&&e.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!1,cancelable:!0}))}await delay(20);let i=t.querySelector('.dropdown-nav-list a[href="/funds');null!=i&&i.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!1,cancelable:!0}))}}async function Roberts(){await delay(3e3);let e=document.querySelector("#fundFrame");for(;isAppActive;)e.contentWindow.location.href.includes("dashboard")&&(e.src="https://kite.zerodha.com/funds",isFundRefreshReq=!0),await delay(5e3)}async function Gomez(){for(await delay(500);isAppActive;)isPos&&(document.title="P&L: "+globalPNL.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2})+" / Kite By Zerodha"),await delay(1e3)}let statusBarPLObserver,globalPNL=0,isDayHistoryVisibleIndex=0,isMTMInit=!1;async function Phillips(e,t){if(globalPNL=e,!isMTMInit){let o=document.querySelector("#dayMTMParent"),r=document.querySelector("#netPNLParent"),s=document.querySelector("#netProjectedParent");function i(){o.style.display=0==isDayHistoryVisibleIndex?"block":"none",r.style.display=1==isDayHistoryVisibleIndex?"block":"none",s.style.display=2==isDayHistoryVisibleIndex?"block":"none"}o.addEventListener("click",(function(){isDayHistoryVisibleIndex=1,i()})),r.addEventListener("click",(function(){isDayHistoryVisibleIndex=2,i()})),s.addEventListener("click",(function(){isDayHistoryVisibleIndex=0,i()})),i(),statusBarPNL=document.querySelector("#MTM"),statusBarPNL.innerText="N/A",statusBarNetPNL=document.querySelector("#netMTM"),statusBarNetPNL.innerText="N/A",statusBarProjected=document.querySelector("#netProjected"),statusBarProjected.innerText="N/A",statusBarDaysHistory=document.querySelector("#dayMTM"),statusBarDaysHistory.innerText="N/A",isMTMInit=!0,null!=statusBarPLObserver&&statusBarPLObserver.disconnect(),statusBarPLObserver=new MutationObserver((function(){Grant()})),statusBarPLObserver.observe(statusBarPNL,{subtree:!0,childList:!0,characterData:!0})}let a=e-globalTotalCharges,n=currentTotalProjected-globalTotalCharges;e>0?statusBarPNL.classList.contains("text-Positive")||(statusBarPNL.classList.remove("text-Negative"),statusBarPNL.classList.add("text-Positive")):statusBarPNL.classList.contains("text-red")||(statusBarPNL.classList.add("text-Negative"),statusBarPNL.classList.remove("text-Positive")),statusBarPNL.innerText=e.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2}),a>0?statusBarNetPNL.classList.contains("text-Positive")||(statusBarNetPNL.classList.remove("text-Negative"),statusBarNetPNL.classList.add("text-Positive")):statusBarNetPNL.classList.contains("text-red")||(statusBarNetPNL.classList.add("text-Negative"),statusBarNetPNL.classList.remove("text-Positive")),statusBarNetPNL.innerText=a.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2}),n>0?statusBarProjected.classList.contains("text-Positive")||(statusBarProjected.classList.remove("text-Negative"),statusBarProjected.classList.add("text-Positive")):statusBarProjected.classList.contains("text-red")||(statusBarProjected.classList.add("text-Negative"),statusBarProjected.classList.remove("text-Positive")),statusBarProjected.innerText=n.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2}),t>0?statusBarDaysHistory.classList.contains("text-Positive")||(statusBarDaysHistory.classList.remove("text-Negative"),statusBarDaysHistory.classList.add("text-Positive")):statusBarDaysHistory.classList.contains("text-red")||(statusBarDaysHistory.classList.add("text-Negative"),statusBarDaysHistory.classList.remove("text-Positive")),statusBarDaysHistory.innerText=t.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2})}let isPosRefreshReq=!0;async function Turner(){let e,t,i;if(Campbell(),isPosRefreshReq){for(isPosRefreshReq=!1,e=document.querySelector("#positionFrame");null==i&&isAppActive;)t=await querySelectFrameWait(e,".container-right",150),i=t.querySelector(".open-positions"),await delay(50);let o,r=i.querySelector(".total div"),s=document.querySelector("#MTM"),l=new MutationObserver((e=>a()));function a(){Grant(),s.innerText=r.innerText,r.classList.contains("text-green")?s.classList.contains("text-Positive")||(s.classList.remove("text-Negative"),s.classList.add("text-Positive")):r.classList.contains("text-red")&&(s.classList.contains("text-red")||(s.classList.add("text-Negative"),s.classList.remove("text-Positive")))}a(),l.observe(r,{subtree:!0,childList:!0,characterData:!0});let c=document.querySelector("#dayMTM");for(c.innerText="N/A";null==o&&isAppActive;)o=t.querySelector(".day-positions"),await delay(1e3);if(await delay(10),null==t.querySelector(".day-positions .icon-chevron-up")){let f=t.querySelector(".day-positions .page-title a");null!=f&&f.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0})),await delay(300)}let u=o.querySelector(".total div");if(null==u)return;let d=new MutationObserver((e=>n()));function n(){c.innerText=u.innerText,u.classList.contains("text-green")?c.classList.contains("text-Positive")||(c.classList.remove("text-Negative"),c.classList.add("text-Positive")):u.classList.contains("text-red")&&(c.classList.contains("text-red")||(c.classList.add("text-Negative"),c.classList.remove("text-Positive")))}n(),d.observe(u,{subtree:!0,childList:!0,characterData:!0})}}async function Cruz(){Gomez();let e=document.querySelector("#usedMargin"),t=document.querySelector("#availMargin"),i=document.querySelector("#totalMargin"),a=document.querySelector("#availCash"),n=document.querySelector("#equityCommoditySwitch");if(!isPrem)return e.innerHTML=lockFrame,t.innerHTML=lockFrame,i.innerHTML=lockFrame,void(a.innerHTML=lockFrame);e.innerText="N/A",t.innerText="N/A",i.innerText="N/A",a.innerText="N/A",new MutationObserver((e=>s())).observe(n,{attributes:!0});let o=0,r=(new Date).getTime();async function s(){let n=await Delgado();if(-1==n)return void(o=50);r=(new Date).getTime();let s=0,l=0,c=0;globalUsedMargin=n.eq_UserMargin,globalAvailableMargin=n.eq_AvailMargin,isCommodity?(s=n.co_UserMargin,c=n.co_AvailMargin,l=n.co_AvailCash):(s=n.eq_UserMargin,c=n.eq_AvailMargin,l=n.eq_AvailCash);let u=s+c;i.innerText=u.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2}),e.innerText=s.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2}),t.innerText=c.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2}),a.innerText=l.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2}),t.classList.remove("text-Positive"),t.classList.remove("text-Negative"),c>0?t.classList.add("text-Positive"):t.classList.add("text-Negative")}!async function(){for(;isAppActive;)o=((new Date).getTime()-r)/1e3,o>60&&isTradingHours&&(s(),r=(new Date).getTime()),await delay(2e3)}(),s(),document.addEventListener("kc_MarginSetUpdate",(function(){s()}))}let isFundRefreshReq=!0;async function Reyes(){let e,t;if(Roberts(),Carter(),isFundRefreshReq){isFundRefreshReq=!1,lastFundRefreshTime=(new Date).getTime(),e=document.querySelector("#fundFrame");let a=document.querySelector("#usedMargin"),n=document.querySelector("#availMargin"),o=document.querySelector("#totalMargin"),r=document.querySelector("#availCash"),s=document.querySelector("#equityCommoditySwitch");if(!isPrem)return a.innerHTML=lockFrame,n.innerHTML=lockFrame,o.innerHTML=lockFrame,void(r.innerHTML=lockFrame);a.innerText="N/A",n.innerText="N/A",o.innerText="N/A",r.innerText="N/A",t=await querySelectFrameWait(e,".margins",100);let l=t.querySelectorAll("h1");for(;0==l.length&&isAppActive;)l=t.querySelectorAll("h1"),await delay(50);let c=new MutationObserver((e=>i())),u=new MutationObserver((e=>i()));function i(){let e,t,i;lastFundRefreshTime=(new Date).getTime(),isCommodity?(e=l[4],t=l[3],i=l[5]):(e=l[1],t=l[0],i=l[2]);let s=parseFloat(e.innerText.replaceAll(",","")),c=parseFloat(t.innerText.replaceAll(",",""));null!=s&&null!=c&&(totalMarginAmount=s+c,o.innerText=totalMarginAmount.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2}),n.innerText=c.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2}),n.classList.remove("text-Positive"),n.classList.remove("text-Negative"),c>0?n.classList.add("text-Positive"):n.classList.add("text-Negative")),r.innerText=i.innerText,a.innerText=e.innerText}i(),u.observe(l[0],{characterData:!0,subtree:!0}),u.observe(l[3],{characterData:!0,subtree:!0}),c.observe(s,{attributes:!0})}}async function Morris(){if(!isTiledFeature)return;let e=-1,t=document.querySelector("#orderFrame"),i=document.querySelector("#totalCharges");if(!isPrem)return void(i.innerHTML=lockFrame);i.innerText="N/A";let a=await querySelectFrameWait(t,".completed-orders-wrap",150);for(await delay(100);isAppActive;){let n=0,o=a.querySelector(".page-title span");if(null==o){await delay(1e3);continue}let r=o.innerText;if(n=parseInt(r.replace(/[{()}]/g,"")),e==n){await delay(2e3);continue}let s=await querySelectFrameWait(t,".toolbar .toolbar-before a",150);if(null!=s){s.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!1,cancelable:!0})),await delay(300);let a=await querySelectFrameWait(t,".modal-mask.contract-note",20);if(await delay(450),null!=a){let t=a.querySelector(".row.final .text-right");if(null!=t){let a=parseFloat(t.innerText.replace(/,/g,""));globalTotalCharges=a,i.innerText=a.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2}),e=n}}let o=await querySelectFrameWait(t,".modal-footer button",20);null!=o&&o.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!1,cancelable:!0}))}await delay(2500)}}async function Murphy(e){let t,i;if(await delay(1e3),e)i=document;else{let e=document.querySelector("#orderFrame");i=e.contentDocument||e.contentWindow.document}let a,n=!1;async function o(){let t,a=i.querySelector(".order-window");if(null==a)return;let o=a.querySelector(".margins"),r=premiumBlockHTML;for(o.insertAdjacentHTML("afterend",r),t=a.querySelector("#premiumBlock");null!=a&&n&&isAppActive;){let i=1,n=!1,o=a.querySelector(".exchange-selector input"),r=a.querySelector(".exchange-selector"),s=a.querySelector(".tradingsymbol"),l=a.classList.contains("sell");if(null!=o&&(l=!1),l&&(n=!0),e){let e=a.querySelector(".submit");null!=e&&e.addEventListener("click",(async function(e){let t=a.querySelector(".body .trigger input");null==t||t.disabled||Reynolds()}))}if(null!=r&&((r.innerText.includes("CDS")||r.innerText.includes("BCD"))&&(i=1e3),r.innerText.includes("MCX")&&(n=!1)),null!=s&&s.innerText.includes(" FUT")&&(n=!1),t.style.visibility=n?"visible":"hidden",n){let e=0,t=a.querySelector(".last-price").innerText,n=0;null!=t&&(n=Number(t.replace(/[^0-9.-]+/g,"")));let o=a.querySelector(".body .quantity input"),r=a.querySelector(".body .trigger input"),s=a.querySelector(".body .price input");if("lots"==o.getAttribute("label").toLowerCase()){let t=a.querySelector(".quantity-helpers").innerText,i=parseFloat(t);isNaN(i)||(e=i)}else e=o.value;null!=r&&!r.disabled&&s.disabled?n=r.value:s.disabled||(n=s.value);let l=e*i*n*1,c=a.querySelector("#premiumSpan");null!=c&&(c.innerText="₹"+l.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2}))}await delay(1e3)}}a=e?await querySelectWait(i,"#app"):await querySelectWait(i,".page-orders"),t=new MutationObserver((e=>function(e){e.forEach((e=>{if("childList"===e.type){if(e.addedNodes.length>0)for(let t=0;t<e.addedNodes.length;t++){const i=e.addedNodes[t];if(i.childNodes.length>0&&i.classList.contains("order-window"))return n=!0,void o()}if(e.removedNodes.length>0)for(let t=0;t<e.removedNodes.length;t++){const i=e.removedNodes[t];if(i.childNodes.length>0&&i.classList.contains("order-window"))return void(n=!1)}}}))}(e))),t.observe(a,{childList:!0})}async function Gutierrez(){document.querySelectorAll(".vddl-list .instrument").forEach((e=>{let t=e.querySelector(".nice-name");t.classList.remove("ceNiceName"),t.classList.remove("peNiceName")}))}async function Ortiz(){isColorUpdateNeeded=!0}let watchListObserver,isColorUpdateNeeded=!0;async function Morgan(){let e;for(await delay(10),isColorUpdateNeeded=!1,null!=watchListObserver&&watchListObserver.disconnect(),isColorUpdateNeeded=!0,e=document.querySelector(".container-left .vddl-list"),watchListObserver=new MutationObserver((e=>{isColorUpdateNeeded=!0})),null!=e&&watchListObserver.observe(e,{childList:!0}),await delay(10);isAppActive;)isColorUpdateNeeded&&1==prefColorizeStrikes.key&&(document.querySelectorAll(".vddl-list .instrument").forEach((e=>{let t=e.querySelector(".nice-name");t.innerText.includes(" CE")?t.classList.add("ceNiceName"):t.innerText.includes(" PE")&&t.classList.add("peNiceName")})),isColorUpdateNeeded=!1),await delay(1e3)}async function Bailey(){await delay(200),window.addEventListener("dblclick",(async function(e){let t=document.querySelector("#orderFrame");if(null==t)return;let i=t.contentDocument||t.contentWindow.document,a=i.querySelector(".baskets-modal");if(null==a)return;let n=!1;if(e.ctrlKey&&(n=!0),e.target.classList.contains("nice-name")||e.target.classList.contains("tradingsymbol")){let t=e.target.innerHTML;if(t=t.replace(/<sup.*?>.*?<\/sup>/gi,""),(t.includes(" PE")||t.includes(" CE")||t.includes(" FUT"))&&null!=a){let e=a.querySelector(".search-input-field input");e.value=t,e.dispatchEvent(new Event("input",{bubbles:!0})),await delay(10);let o=i.querySelector("body");o.classList.add("noBasket"),a.querySelector(".results-item").dispatchEvent(new MouseEvent("click")),await delay(25);let r=i.querySelector(".variety-quick");if(null!=r){let e=r.querySelector('input[value="regular"]');null!=e&&e.dispatchEvent(new MouseEvent("click")),await delay(25)}let s=i.querySelector('input[value="BUY"]'),l=i.querySelector('input[value="SELL"]');null==s||n||s.dispatchEvent(new MouseEvent("click")),null!=l&&n&&l.dispatchEvent(new MouseEvent("click")),await delay(15);let c=i.querySelector('input[value="MARKET"]');null!=c&&c.dispatchEvent(new MouseEvent("click")),await delay(25);let u=i.querySelector(".order-window .submit");null!=u&&u.dispatchEvent(new MouseEvent("click")),await delay(230),o.classList.remove("noBasket")}}}))}function Kelly(){let e="#181818",t="#8c8c8c",i="#B1C8CC",a="#0E5EFF",n="#242424",o="#181818",r="#444";return"default"!==document.documentElement.getAttribute("data-theme")||(e="#F9F9F9",t="#181818",n="#CBCBCB",o="#CBCBCB","#808080"),{height:300,width:0,autoSize:!0,localization:{timeFormatter:e=>e.toString(),priceFormatter:rupeePriceFormatter},crosshair:{mode:1,vertLine:{width:1,color:i,labelBackgroundColor:i,labelVisible:!1},horzLine:{color:a,labelBackgroundColor:a,visible:!1,labelVisible:!1}},layout:{background:{color:e},textColor:t,fontStyle:"bolder",fontFamily:"Arial, Helvetica, sans-serif"},grid:{vertLines:{color:n,style:2},horzLines:{color:o,style:2}},timeScale:{timeVisible:!0,fixLeftEdge:!0,tickMarkFormatter:e=>e.toString(),borderColor:"#444",timeVisible:!0,secondsVisible:!1},rightPriceScale:{borderColor:"#444",mode:0,autoScale:!0,scaleMargins:{top:.08,bottom:0}},handleScroll:!1,handleScale:!1,axisPressedMouseMove:!1}}function Howard(){return{priceLineVisible:!1,lineType:0,topFillColor1:"rgba(69, 207, 112, 0.2)",topFillColor2:"rgba(69, 207, 112, 0.05)",topLineColor:"rgba(69, 207, 112, 1)",lastValueVisible:!1,crosshairMarkerVisible:!0,axisLabelVisible:!1,title:""}}function Ramos(e){try{return!e.time}catch{}return!1}function Kim(e){try{if(void 0===e.point||!e.time||e.point.x<0||e.point.x>chartDiv.clientWidth||e.point.y<0||e.point.y>chartDiv.clientHeight)return!0}catch{}return!1}let chartDiv,straddleIVChartObject,isTestMTMTicks=!1,isTestTimeData=!1,chartDataKeyName="",isChartInit=!1;async function Cox(){if(isChartInit=!0,rightContainer=document.querySelector(".container-right"),null==rightContainer)return;let e=document.createElement("div");e.id="chartRootParent";let t=Moreno("chartButtons");for(e.innerHTML=t,rightContainer.insertBefore(e,rightContainer.firstChild),chartDiv=rightContainer.querySelector("#lightWeightChartParent");0==userID.length&&isAppActive;)await delay(10);chartDataKeyName="mtmChartDataKey",chartDataKeyName+=userID,Watson()}async function Richardson(e){let t=document.querySelector("#chartRootParent");e?t.classList.contains("hiddenChart")&&t.classList.remove("hiddenChart"):t.classList.contains("hiddenChart")||t.classList.add("hiddenChart")}async function Watson(){let e="default"!==document.documentElement.getAttribute("data-theme"),t="#181818",i="#D3D3D3",a="#3D4447",n="#3D4447",o="#3D4447",r="#3D4447",s="#242424",l="#242424",c="#342700",u="#1F1F1F",d="#444",f=0;e||(t="#F9F9F9",i="#2C2C2C",a="#B1C8CC",n="#B1C8CC",o="#B1C8CC",r="#B1C8CC",s="#CBCBCB",l="#CBCBCB",u="#DEDEDE",c="#838280",d="#808080");const p={height:400,width:0,autoSize:!0,localization:{priceFormatter:rupeePriceFormatter},crosshair:{mode:0,vertLine:{width:1,color:a,labelBackgroundColor:n},horzLine:{color:o,labelBackgroundColor:r}},watermark:{color:u,text:"KitePlus For Zerodha",visible:!0,fontFamily:'"Open Sans", sans-serif',fontSize:35,fontStyle:"bolder",horzAlign:"center",vertAlign:"bottom"},layout:{background:{color:t},textColor:i,fontStyle:"bolder",fontFamily:"Arial, Helvetica, sans-serif"},grid:{vertLines:{color:s,style:2},horzLines:{color:l,style:2}},rightPriceScale:{borderColor:d,mode:0,autoScale:!0,scaleMargins:{top:.08,bottom:.08}},handleScroll:!0,handleScale:!0,axisPressedMouseMove:!0};if(!isPrem)return;const m=LightweightCharts.createChart(chartDiv,p);m.timeScale().applyOptions({borderColor:d,timeVisible:!0,secondsVisible:!1});const y=m.addBaselineSeries({priceLineVisible:!1,lineType:0,lastValueVisible:!1,crosshairMarkerVisible:!1,lineColor:c,lineWidth:2,axisLabelVisible:!1,title:""}),g=m.addCandlestickSeries({priceLineVisible:!1,lastValueVisible:!1,priceLineColor:"#FFCD00"});let S,h=[],w=await fetchSyncStorage(chartDataKeyName);if(isTestTimeData&&(w=await Ward()),null!=w){let e=getISTTimeStamp(),t=new Date(e);t.setUTCHours(8,15,0),w.sort((function(e,t){return e.time-t.time}));let i=e/1e3,a=Math.floor(t.getTime()/1e3);S=i>a?1e3*(a+86400):1e3*a;for(let e=0;e<w.length;e++){let t=!0;const n=w[e];void 0!==n.time&&void 0!==n.open&&void 0!==n.high&&void 0!==n.low&&void 0!==n.close&&(i>a&&n.time<a&&(t=!1),n.time+86400<a&&(t=!1),t&&h.push({close:n.close,low:n.low,high:n.high,open:n.open,time:n.time}))}if(!isTestTimeData)try{await setSyncStorage(chartDataKeyName,h)}catch(e){}}let b=Number.POSITIVE_INFINITY,k=Number.NEGATIVE_INFINITY;if(null!=w&&h.length>0){let e=[];g.setData(h);for(let t=0;t<h.length;t++){const i=h[t];e.push({time:i.time,value:i.close})}y.setData(e);let t=h.reduce((function(e,t){return e&&e.high>t.high?e:t}));k=t.high;let i=h.reduce((function(e,t){return e&&e.low<t.low?e:t}));b=i.low}let M=document.querySelector("#MTM");y.createPriceLine({price:0,color:c,lineWidth:1,lineStyle:2,axisLabelVisible:!0,title:""});let v=y.createPriceLine({price:b,color:"#79240A",lineWidth:2,lineStyle:1,axisLabelVisible:!0,title:"Low"});const C=y.createPriceLine({price:0,color:"#612B19",lineWidth:1,lineStyle:0,axisLabelVisible:!0,title:"MTM"});let P,x,T=y.createPriceLine({price:k,color:"#3B8A68",lineWidth:2,lineStyle:1,axisLabelVisible:!0,title:"High"}),I=document.querySelector("#chartSave");document.querySelector("#chartSaveCSV").addEventListener("click",(function(){if(0==G.length)return void showPlusMessage(document,"There is no chart data","info");let e=new Date,t=e.getFullYear()+"_"+(e.getMonth()+1)+"_"+e.getDate()+"_"+e.getHours()+"_"+e.getMinutes(),i="data:text/csv;charset=utf-8,";i+="Time,Low,High,Open,Close,\r\n",G.forEach((function(e){let t=new Date(1e3*e.time),a=getFullDateForExcel(t)+","+e.low+","+e.high+","+e.open+","+e.close+",";i+=a+"\r\n"}));let a=encodeURI(i),n=document.createElement("a");n.setAttribute("href",a),n.setAttribute("download",t+".csv"),n.click()})),I.addEventListener("click",(function(){let e=new Date,t=e.getFullYear()+"_"+(e.getMonth()+1)+"_"+e.getDate()+"_"+e.getHours()+"_"+e.getMinutes(),i=m.takeScreenshot(),a=document.createElement("a");a.setAttribute("download",t+".jpg"),a.setAttribute("href",i.toDataURL("image/png").replace("image/png","image/octet-stream")),a.click()}));let F=document.querySelector("#chartROICheckbox");async function L(){if(null!=F)if(F.checked){let e={priceFormatter:rupeePriceFormatter};e=0!=f?{priceFormatter:e=>(e/f*100).toFixed(2)+"%"}:{priceFormatter:e=>currencyToShortText(e)+" (N/A %)"};let t=m.options();t.localization=e,m.applyOptions(t)}else{let e={priceFormatter:rupeePriceFormatter},t=m.options();t.localization=e,m.applyOptions(t)}}P=await fetchSyncStorage("prefChartROICheckboxKey"),x=!1,null!=P&&null!=P&&(x=P),F.checked=x,F.addEventListener("change",(async function(){L(),await setSyncStorage("prefChartROICheckboxKey",F.checked)})),async function(){let e,t=!1;for(;!t&&isAppActive;)e=document.querySelector("#totalMargin"),null!=e&&(isNaN(parseFloat(e.innerText.replaceAll(",","")))||(t=!0)),await delay(100);f=parseFloat(e.innerText.replaceAll(",","")),L()}(),L();let D=document.querySelector("#chartHighLowCheckbox");P=await fetchSyncStorage("prefChartHighLowCheckboxKey"),x=!0,null!=P&&null!=P&&(x=P),D.checked=x,D.addEventListener("change",(async function(){E(),await setSyncStorage("prefChartHighLowCheckboxKey",D.checked)}));let B=document.querySelector("#chartCandleCheckbox");P=await fetchSyncStorage("prefChartCandleCheckboxKey"),x=!0,null!=P&&null!=P&&(x=P),B.checked=x,B.addEventListener("change",(async function(){E(),await setSyncStorage("prefChartCandleCheckboxKey",B.checked)}));let N=document.querySelector("#chartLinesCheckbox");async function E(){let e=document.querySelector("#chartCandleCheckbox"),t=document.querySelector("#chartLinesCheckbox"),i=document.querySelector("#chartHighLowCheckbox"),a=g.options();a.visible=e.checked,g.applyOptions(a);let n=y.options();n.lineVisible=t.checked,y.applyOptions(n);let o=v.options();o.lineVisible=i.checked,o.axisLabelVisible=i.checked,v.applyOptions(o);let r=T.options();r.lineVisible=i.checked,r.axisLabelVisible=i.checked,T.applyOptions(r)}P=await fetchSyncStorage("prefChartLinesCheckboxKey"),x=!0,null!=P&&null!=P&&(x=P),N.checked=x,N.addEventListener("change",(async function(){E(),await setSyncStorage("prefChartLinesCheckboxKey",N.checked)})),E();let O=document.querySelector("#idPrefMTMChart");document.querySelector("#chartMaxButton").addEventListener("click",(function(){let e=document.querySelector("#chartRootParent");e.classList.contains("fullView")||e.classList.add("fullView")}));let A=document.querySelector("#chartMinButton"),W=document.querySelector("#chartRootParent");A.addEventListener("click",(function(){W.classList.contains("fullView")&&W.classList.remove("fullView")})),document.querySelector("#chartCloseButton").addEventListener("click",(function(){null!=O&&O.click()}));let G=h;!async function(){await delay(30);let e,t=0==h.length,i=0,a=0,n=0,o=!1,r=Math.floor(getISTTimeStamp()/6e4);n=r;let s=h.length>0;for(h.length>0&&(e=h[h.length-1],i=e.close,r==e.time/60&&(o=!0));isAppActive;){let r={high:0,low:0,open:0,close:0,time:0};r.low=Number.POSITIVE_INFINITY,r.high=Number.NEGATIVE_INFINITY,r.open=a,r.close=a,s&&(o?(r.open=e.open,r.close=e.close,r.high=e.high,r.low=e.low,o=!1):r.open=e.close,s=!1);let l=-1;for(;isAppActive;){let e=!0,o=getISTTimeStamp(),s=new Date(o);if(o>S)return void location.reload();let c=60*s.getUTCHours()+s.getUTCMinutes();(c<540||c>930)&&(e=!1);let u=Math.floor(o/6e4);if(u!=n){n=u;break}let d=M.innerText,f=parseFloat(d.replaceAll(",","")),p=!1;if(null==f||isNaN(f)){if(!e){await delay(1e3);continue}}else p=!0,isTestMTMTicks||(a=f),isTestMTMTicks&&(p=!0,a+=817*(2*Math.random()-1)),t&&(r.open=a,t=!1);e||i!=a||(p=!1),i=a;let m=C.options();if(m.price=a,m.color=a<0?"rgba(239, 83, 80, 1)":"rgba(38, 166, 154, 1)",C.applyOptions(m),p){if(r.close=a,a<r.low&&(r.low=a),a>r.high&&(r.high=a),a>k){let e=T.options();e.price=a,k=a,T.applyOptions(e)}if(a<b){let e=v.options();e.price=a,b=a,v.applyOptions(e)}if(r.time=60*u,isTestTimeData){await delay(2500);continue}try{g.update(r),y.update({time:r.time,value:r.close})}catch{}if(-1===l){const e=G.findIndex((e=>e.time===60*u));-1!=e?(l=e,G[l]=r):(G.push(r),l=G.length-1)}else G[l]=r;try{await setSyncStorage(chartDataKeyName,G)}catch(e){location.reload()}}await delay(1e3)}}}()}let straddleLineSeries,ivLineSeries,currentStraddleLine,indexMetaSymbolSelector,indexMetaChartRootParent,chartIndexMetaObject={},lastIndexMetaCleanTime=0,chartTimeLength=60,ivExpirySymbolList=[],isChartExpanded=!1,activeIvChartSymbol="NIFTY";async function Bennett(){let e="default"!==document.documentElement.getAttribute("data-theme"),t=await querySelectWait(document,".container-right");indexMetaChartRootParent=document.createElement("div"),indexMetaChartRootParent.classList.add("hiddenIndexMetaChart"),indexMetaChartRootParent.id="chartRootParentIndexMeta";let i=Moreno("chartIndexMetaButtons");indexMetaChartRootParent.innerHTML=i,t.insertBefore(indexMetaChartRootParent,t.firstChild);let a=t.querySelector("#lightWeightChartIndexMetaParent"),n="#181818";indexMetaSymbolSelector=indexMetaChartRootParent.querySelector(".indexMetaSymbolSelect");let o=indexMetaChartRootParent.querySelector("#indexMetaIvToggle"),r=indexMetaChartRootParent.querySelector("#indexMetaStraddleToggle");r.checked=await Ross("prefIndexMetaChartStraddleChartKey",!0),o.checked=await Ross("prefIndexMetaChartIvChartKey",!1),activeIvChartSymbol=await Ross("activeIvChartSymbolKey",!1),o.addEventListener("change",(async function(){C(),await setSyncStorage("prefIndexMetaChartIvChartKey",o.checked)})),r.addEventListener("change",(async function(){C(),await setSyncStorage("prefIndexMetaChartStraddleChartKey",r.checked)})),isChartExpanded=await Ross("indexMetaChartExpandStatus",isChartExpanded),indexMetaChartRootParent.querySelector("#chartIndexMetaCloseButton").addEventListener("click",(function(){isChartExpanded=!1,f()}));let s=indexMetaChartRootParent.querySelector("#chartIndexMetaZoomOut"),l=indexMetaChartRootParent.querySelector("#chartIndexMetaZoomIn"),c=indexMetaChartRootParent.querySelector("#chartIndexMetaResetButton"),u=document.querySelector("#chartIndexMetaMaxButton"),d=document.querySelector("#chartIndexMetaMinButton");async function f(){await setSyncStorage("indexMetaChartExpandStatus",isChartExpanded),indexMetaChartRootParent.classList.toggle("hiddenIndexMetaChart",!isChartExpanded)}u.addEventListener("click",(function(){indexMetaChartRootParent.classList.contains("fullView")||indexMetaChartRootParent.classList.add("fullView")})),d.addEventListener("click",(function(){indexMetaChartRootParent.classList.contains("fullView")&&indexMetaChartRootParent.classList.remove("fullView")})),s.addEventListener("click",(function(){let e=straddleIVChartObject.timeScale().getVisibleLogicalRange(),t=e.to-e.from;e.to=e.to+.1*t,e.from=e.from-.1*t,straddleIVChartObject.timeScale().setVisibleLogicalRange(e)})),l.addEventListener("click",(function(){let e=straddleIVChartObject.timeScale().getVisibleLogicalRange(),t=e.to-e.from;e.to=e.to-.1*t,e.from=e.from+.1*t,straddleIVChartObject.timeScale().setVisibleLogicalRange(e)})),c.addEventListener("click",(function(){straddleIVChartObject.timeScale().fitContent()})),indexMetaChartRootParent.querySelector("#chartIndexMetaShowButton").addEventListener("click",(function(){isChartExpanded=!0,f()})),f(),await delay(10);let p="#D3D3D3",m="#3D4447",y="#3D4447",g="#3D4447",S="#3D4447",h="#242424",w="#242424",b="#342700",k="#1F1F1F",M="#444";e||(n="#F9F9F9",p="#2C2C2C",m="#B1C8CC",y="#B1C8CC",g="#B1C8CC",S="#B1C8CC",h="#CBCBCB",w="#CBCBCB",k="#DEDEDE",b="#838280",M="#808080");const v={height:400,width:0,autoSize:!0,crosshair:{mode:1,vertLine:{visible:!0,labelVisible:!1,width:1,color:m,labelBackgroundColor:y},horzLine:{visible:!1,labelVisible:!1,color:g,labelBackgroundColor:S}},watermark:{color:k,text:"",visible:!0,fontFamily:'"Open Sans", sans-serif',fontSize:35,fontStyle:"bolder",horzAlign:"center",vertAlign:"bottom"},layout:{background:{color:n},textColor:p,fontStyle:"bolder",fontFamily:"Arial, Helvetica, sans-serif"},timeScale:{timeVisible:!0,rightOffset:5,borderColor:"#444",shiftVisibleRangeOnNewBar:!0,secondsVisible:!1},grid:{vertLines:{color:h,style:2},horzLines:{color:w,style:2,visible:!1}},leftPriceScale:{visible:!0,borderColor:M,mode:0,autoScale:!0,scaleMargins:{top:.08,bottom:.08}},rightPriceScale:{borderColor:M,mode:0,autoScale:!0,scaleMargins:{top:.08,bottom:.08}},handleScroll:{vertTouchDrag:!1,mouseWheel:!1,pressedMouseMove:!0},handleScale:{mouseWheel:!1,axisPressedMouseMove:!0,axisDoubleClickReset:!0}};async function C(){let t=straddleLineSeries.options(),i=e?"#2b2b2b":"#e7e7e7";t.color=r.checked?"#13dda0":i,t.axisLabelTextColor="#13dda0",straddleLineSeries.applyOptions(t);let a=ivLineSeries.options();a.color=o.checked?"#ddb813":i,a.lineVisible=o.checked,ivLineSeries.applyOptions(a)}straddleIVChartObject=LightweightCharts.createChart(a,v),straddleIVChartObject.timeScale().applyOptions({borderColor:M,timeVisible:!0,secondsVisible:!1}),straddleLineSeries=straddleIVChartObject.addLineSeries({priceScaleId:"right",priceLineSource:1,priceLineVisible:!1,lineType:0,lastValueVisible:!1,crosshairMarkerVisible:!0,lineColor:b,lineWidth:2,axisLabelVisible:!0,title:"",color:"#13dda0"}),ivLineSeries=straddleIVChartObject.addLineSeries({priceScaleId:"left",priceLineVisible:!0,lineType:0,lineStyle:0,lastValueVisible:!0,crosshairMarkerVisible:!0,lineColor:b,lineWidth:2,axisLabelVisible:!0,title:"IV",color:"#ddb813"}),currentStraddleLine=straddleLineSeries.createPriceLine({price:0,color:"#13dda0",lineWidth:1,lineStyle:1,axisLabelVisible:!0,title:""}),new ResizeObserver((e=>{straddleIVChartObject.timeScale().fitContent()})).observe(a),Sanders(a,straddleIVChartObject,straddleLineSeries,activeIvChartSymbol),C()}let ivChartAwaitTimeOut,isIndexChartPlotInit=!1;async function Ruiz(){document.addEventListener("kc_OnConfigChange",(function(e){"prefATMChartFeaturesKey"==e.detail.configName&&(e.detail.configValue&&!isIndexChartPlotInit?Hughes():0==e.detail.configValue&&isIndexChartPlotInit?indexMetaChartRootParent.classList.toggle("disabledIndexMetaChart",!0):1==e.detail.configValue&&isIndexChartPlotInit&&indexMetaChartRootParent.classList.toggle("disabledIndexMetaChart",!1))})),Hughes()}async function Hughes(){if(!prefATMChartFeatures.key)return;isIndexChartPlotInit=!0,await Pierce();let e=!1;e=await Ross("prefAllIndicesKey",e);let t=e?5:mainUnderlyingCount;for(let e=0;e<Math.min(underlyingMapping.length,t);e++){const t=underlyingMapping[e];let i=Duncan(JSON.stringify(t.FoName));0!=i.length&&(ivExpirySymbolList.push({foName:t.FoName,expiry:i[0]}),Le(t.FoName,i[0]),await delay(50))}await Bennett(),lastIndexMetaCleanTime=await Ross("lastIndexMetaCleanTimeKey",lastIndexMetaCleanTime);let i=getISTTimeStamp();if(i>lastIndexMetaCleanTime+864e5){lastIndexMetaCleanTime=i;let e=new Date(i);e.setUTCHours(8,15,0),lastIndexMetaCleanTime=e.getTime(),await setSyncStorage("lastIndexMetaCleanTimeKey",lastIndexMetaCleanTime),chartIndexMetaObject={},await setSyncStorage("chartIndexMetaObjectKey",chartIndexMetaObject)}chartIndexMetaObject=await Ross("chartIndexMetaObjectKey",chartIndexMetaObject);for(let e=0;e<ivExpirySymbolList.length;e++){const t=ivExpirySymbolList[e].foName;indexMetaSymbolSelector.add(new Option(t,e)),null==chartIndexMetaObject[t]&&(chartIndexMetaObject[t]=[])}ivExpirySymbolList.length>0&&(null==ivExpirySymbolList.find((e=>e.foName==activeIvChartSymbol))&&(activeIvChartSymbol=ivExpirySymbolList[0].foName),indexMetaSymbolSelector.value=ivExpirySymbolList.findIndex((e=>activeIvChartSymbol==e.foName)),Alvarez(activeIvChartSymbol)),indexMetaSymbolSelector.addEventListener("input",(function(){activeIvChartSymbol!=indexMetaSymbolSelector.value&&""!=indexMetaSymbolSelector.value&&Alvarez(ivExpirySymbolList.find((e=>e.foName==ivExpirySymbolList[indexMetaSymbolSelector.value].foName)).foName)}))}function Price(e,t){let i=e.options();i.price=t,e.applyOptions(i)}async function Alvarez(e){activeIvChartSymbol=e,await setSyncStorage("activeIvChartSymbolKey",activeIvChartSymbol),null!=ivChartAwaitTimeOut&&(isChartTicking=!1,ivChartAwaitTimeOut.cancel(),await delay(1)),isChartTicking=!0;let t=Object.keys(chartIndexMetaObject);for(let e=0;e<t.length;e++){let i=t[e];if(i==activeIvChartSymbol){let e=[],t=[];if(chartIndexMetaObject[i].length>0)for(let a=0;a<chartIndexMetaObject[i].length;a++){const n=chartIndexMetaObject[i][a];if(n.straddlePrice>0){let i={value:n.straddlePrice,time:n.time};e.push(i);let a={value:n.ivPrice<0?0:n.ivPrice,time:n.time};t.push(a)}a==chartIndexMetaObject[i].length-1&&Price(currentStraddleLine,n.straddlePrice)}straddleLineSeries.setData(e),ivLineSeries.setData(t)}}await delay(2),straddleIVChartObject.timeScale().fitContent(),Castillo()}let isChartTicking=!1;async function Castillo(){let e=new Date(getISTTimeStamp()),t=new Date(getISTTimeStamp());for(e.setUTCHours(9,15,0),t.setUTCHours(1,45,0),e.getTime(),t.getTime();isAppActive&&isChartTicking;){let e=getISTTimeStamp(),t=Math.floor(e/(1e3*chartTimeLength)),i=!0,a=new Date(e),n=60*a.getUTCHours()+a.getUTCMinutes();(n<540||n>930)&&(i=!1);for(let e=0;e<ivExpirySymbolList.length;e++){let a=ivExpirySymbolList[e],n=a.foName;if(!i&&0!=chartIndexMetaObject[n].length)continue;let o=await Fuller(n,a.expiry),r=0,s=0;if(-1!=o&&o.isReady&&(r=o.straddlePrice,s=o.atmIV),0==r)continue;let l={straddlePrice:r,ivPrice:s,time:t*chartTimeLength};const c=chartIndexMetaObject[n].findIndex((e=>e.time===t*chartTimeLength));-1!=c?chartIndexMetaObject[n][c]=l:chartIndexMetaObject[n].push(l),n==activeIvChartSymbol&&null!=straddleLineSeries&&l.straddlePrice>0&&(straddleLineSeries.update({time:l.time,value:l.straddlePrice}),Price(currentStraddleLine,l.straddlePrice),null!=ivLineSeries&&ivLineSeries.update({time:l.time,value:l.ivPrice>0?l.ivPrice:0}))}await setSyncStorage("chartIndexMetaObjectKey",chartIndexMetaObject),ivChartAwaitTimeOut=delayFlex(1e3),await ivChartAwaitTimeOut.promise}}function Sanders(e,t,i,a){let n=document.createElement("div");n.classList.add("metaChartTooltipStyle"),e.appendChild(n);let o=Moreno("metaChartTooltip"),r=function(t){if(Ramos(t))n.style.display="none";else{n.style.display="block";const r=t.seriesData.get(i),s=t.seriesData.get(ivLineSeries);if(null==r)return;const l=void 0!==r.value?r.value:r.close;if(null==s)return;const c=void 0!==s.value?s.value:s.close;let u=l.toFixed(2),d=o.replace("$instHeader",a);d=d.replace("$time",getFormattedTimeForChart(t.time)),d=d.replace("$straddlePrice",u),d=d.replace("$ivPrice",c.toFixed(2)),n.innerHTML=d;const f=i.priceToCoordinate(l);let p=t.point.x-50;if(null===f)return;p=Math.max(0,Math.min(e.clientWidth-80,p));const m=Math.max(0,Math.min(e.clientHeight-80-15,f+15));n.style.left=p+"px",n.style.top=m+"px"}};return t.subscribeCrosshairMove(r),{crosshairMoveHandler:r,toolTip:n}}var prefCompactView={key:!1},prefTiledOrderWindow={key:!1},prefAvailableCash={key:!1},prefColorizeStrikes={key:!1},prefLiquidOption={key:!1},prefATMChartFeatures={key:!0},prefMTMChartFeatures={key:!0},prefStraddleIVInfo={key:!0},prefFloatingPriceWindow={key:!1},prefGroupExpiryWise={key:!0},prefGroupViewStraddleInfo={key:!0},prefGroupViewCallPutInfo={key:!0},prefStrikeOrderFormat={key:"PE"},prefTOTPHash={key:""},prefOptionChainType={key:"OTM"},prefTotalStrikes={key:"48"},prefITMStrikes={key:"0"},prefFontFamily={key:"Default"};const configChangeEvent=new CustomEvent("kc_OnConfigChange",{detail:{configName:"",configValue:""}});async function Patel(){isPrem&&(await Myers("#idPrefCompactView","null","checkBox","change","prefCompactViewKey",prefCompactView),await Myers("#idPrefTiledOrderWindow","null","checkBox","change","prefTiledOrderWindowKey",prefTiledOrderWindow),await Myers("#idPrefAvailableCash","null","checkBox","input","prefAvailableCashKey",prefAvailableCash),await Myers("#idPrefMTMChartFeatures","null","checkBox","input","prefMTMChartFeatures",prefMTMChartFeatures),await Myers("#idPrefATMChartFeatures","null","checkBox","input","prefATMChartFeaturesKey",prefATMChartFeatures),await Myers("#idPrefFloatingPriceWindow","null","checkBox","input","prefFloatingPriceWindowKey",prefFloatingPriceWindow),await Myers("#idPrefStraddleIVInfo","null","checkBox","input","prefStraddleIVInfoKey",prefStraddleIVInfo),await Myers("#idPrefColorizeStrikes","null","checkBox","input","prefColorizeStrikesKey",prefColorizeStrikes),await Myers("#idPrefGroupExpiryWise","null","checkBox","input","prefGroupExpiryWise",prefGroupExpiryWise),await Myers("#idPrefGroupViewStraddleInfo","null","checkBox","input","prefGroupViewStraddleInfoKey",prefGroupViewStraddleInfo),await Myers("#idPrefGroupViewCallPutInfo","null","checkBox","input","prefGroupViewCallPutInfoKey",prefGroupViewCallPutInfo),await Myers("#idPrefTOTPHash","null","textBox","input","prefTOTPHashKey",prefTOTPHash),await Myers("#idPrefOptionChainType","null","textBox","input","prefOptionChainTypeKey",prefOptionChainType),await Myers("#idPrefTotalStrikes","null","textBox","input","prefTotalStrikesKey",prefTotalStrikes),await Myers("#idPrefITMStrikes","null","textBox","input","prefITMStrikesKey",prefITMStrikes),await Myers("#idPrefFontFamily","null","textBox","input","prefFontFamilyKey",prefFontFamily),await Myers("#idPrefCE","strikesFormat","radio","change","prefStrikeOrderFormatKey",prefStrikeOrderFormat),await Myers("#idPrefPE","strikesFormat","radio","change","prefStrikeOrderFormatKey",prefStrikeOrderFormat))}async function Myers(e,t,i,a,n,o){o.key=await Ross(n,o.key),"checkBox"==i?document.querySelector(e).checked=o.key:"textBox"==i?document.querySelector(e).value=o.key:"radio"==i&&document.querySelector(e).value==o.key&&(document.querySelector(e).checked=!0),Long(e,t,i,a,n,o)}function Long(e,t,i,a,n,o){document.querySelector(e).addEventListener(a,(async function(){if("checkBox"==i)o.key=document.querySelector(e).checked;else if("textBox"==i)o.key=document.querySelector(e).value;else if("radio"==i){let e="input[type=radio][name="+t+"]:checked";o.key=document.querySelector(e).value}await setSyncStorage(n,o.key),configChangeEvent.detail.configName=n,configChangeEvent.detail.configValue=o.key,document.dispatchEvent(configChangeEvent),onConfigChanged(!1)}))}async function Ross(e,t){return new Promise((async(i,a)=>{let n=await fetchSyncStorage(e);null==n&&(setSyncStorage(e,t),n=t),i(n)}))}var orderFrameHTML='<iframe src="https://kite.zerodha.com/orders" id="orderFrame"></iframe>',positionFrameHTML='<iframe src="https://kite.zerodha.com/positions" id="positionFrame" style="display:none"></iframe>',fundFrameHTML='<iframe src="https://kite.zerodha.com/funds" id="fundFrame"></iframe>',kiteTradeFrame='<iframe src="https://api.kite.trade/Data" id="tradeFrame"></iframe>',purchaseLink="https://kiteplus.radiuscraft.com/";let globalStatus;var isCommodity,lastReloadTime,utilityContainer,orderDiv,container,stickyOpenButton,stickyCloseButton,lockFrame,extraHTMLFileText,currentVersion=2.59,minVersion=1,latestVersion=1,licenseStatus="Expired",instanceCounter=0,isPrem=!1,versionTestPassed=!1,isWatchListFeatureEnabled=!0,isMTMStopLossFeature=!1,isBasketFeature=!0,isMobileView=!1;let isReal=!0,isPos=!1,isInitDone=!1,currentPage=window.location.pathname,isUtilityDone=!1;var authToken;let isFirstPagePosition=!0,isTiledFeature=!0,isTradingHours=!1,isAppActive=!0,isGhibliMode=!1;var isAPIMode=!0;async function Foster(){window.onpagehide=e=>{e.persisted||(isAppActive=!1)},globalStatus=await fetchSyncStorage("kiteGlobalStatus"),null==globalStatus&&(chrome.storage.local.set({kiteGlobalStatus:!0}),globalStatus=!0),await Johnson(),Powell(),Jenkins(),Russell()}async function Powell(){if(inIframe())return;if(0==globalStatus)return;await delay(10);let e=document.querySelector("#app");null!=e&&(e.classList.contains("mobile")&&(isMobileView=!0),mobileViewObserver=new MutationObserver((async function(t){e.classList.contains("mobile")&&(isMobileView=!0),isMobileView&&!e.classList.contains("mobile")&&(isInitDone?Butler():Sullivan()),await delay(15),window.location.pathname.includes("profile")&&Hamilton(!1),window.location.pathname.includes("chart")&&Hamilton(!1)})),mobileViewObserver.observe(e,{attributes:!0}))}async function Jenkins(){await setSyncStorage("validSensiSession",!1),globalStatus&&(inIframe()||(Perry(),Bell(),Williams()))}async function Perry(){currentPage.includes("positions")&&(isPos=!0),(await querySelectWait(document,".app-nav")).querySelectorAll("a").forEach((e=>{e.addEventListener("click",(function(){isPos=!1,e.href.includes("positions")?(isPos=!0,Hamilton(lastStickyStatus)):Hamilton(!1)}))})),currentPage.includes("positions")||(isFirstPagePosition=!1)}async function Russell(){for(;isAppActive;){let e=getISTTimeStamp(),t=new Date(e),i=60*t.getUTCHours()+t.getUTCMinutes();isTradingHours=!(i<540||i>930),await delay(1e4)}}async function Sullivan(){(await querySelectWait(document,".app-nav")).querySelector('a[href="/positions"]').addEventListener("click",(function(){window.location.replace("https://kite.zerodha.com/positions")}))}async function Bell(){let e=(new Date).getTime(),t=await fetchSyncStorage("lastAuthTime"),i=(await querySelectWait(document,".user-id")).innerText,a=await fetchSyncStorage("lastUserID");null!=t&&null!=a&&(e-new Date(t))/36e5<6&&a==i&&Henderson(!0)}async function Coleman(){let e=document.querySelector(".user-id").innerText,t=(new Date).getTime(),i=(new Date).getTime();i-=864e5,await setSyncStorage("lastUserID",e),await setSyncStorage("expiryDate",expiryDate.getTime()),await setSyncStorage("latestVersion",latestVersion),await setSyncStorage("minVersion",minVersion),await setSyncStorage("forcedStatus",forcedStatus),await setSyncStorage("forcedMessage",forcedMessage),await setSyncStorage("isAPIMode",isAPIMode),"Active"==licenseStatus||"FreeNoUser"==licenseStatus||"FreeUser"==licenseStatus?await setSyncStorage("lastAuthTime",t):await setSyncStorage("lastAuthTime",i),setSyncStorage("subType",subType),200!=workModeCode||isAPIMode?300==workModeCode&&isAPIMode&&(isAPIMode=!1,await setSyncStorage("isAPIMode",isAPIMode),location.reload()):(isAPIMode=!0,await setSyncStorage("isAPIMode",isAPIMode),location.reload()),200!=basketModeCode||isBasketFeature?300==basketModeCode&&isBasketFeature&&(isBasketFeature=!1,await setSyncStorage("isBasketFeature",isBasketFeature),location.reload()):(isBasketFeature=!0,await setSyncStorage("isBasketFeature",isBasketFeature),location.reload()),200!=mtmStopLossCode||isMTMStopLossFeature?300==mtmStopLossCode&&isMTMStopLossFeature&&(isMTMStopLossFeature=!1,await setSyncStorage("isMTMStopLossFeature",isMTMStopLossFeature),location.reload()):(isMTMStopLossFeature=!0,await setSyncStorage("isMTMStopLossFeature",isMTMStopLossFeature),location.reload()),"501"==forcedStatus?isInitDone&&versionTestPassed&&Butler():(currentVersion<minVersion&&versionTestPassed&&Butler(),currentVersion>=minVersion&&isInitDone&&!versionTestPassed&&Butler())}async function Butler(){((new Date).getTime()-lastReloadTime)/1e3>3&&(lastReloadTime=new Date,await setSyncStorage("lastReloadTime",lastReloadTime.getTime()),location.reload())}async function Henderson(e){isInitDone||(isInitDone=!0,(isPrem=e)||(isWatchListFeatureEnabled=!1),Barnes())}async function Barnes(){let e=await fetch(chrome.runtime.getURL("Blocks/ExtraBlocks.html"));extraHTMLFileText=await e.text(),Austin(),Yang(),Alvarado(),West(),Woods(),Li(),Rojas(),Simmons(),lockFrame=Moreno("lockFrame");let t=document.querySelector("head"),i=[];i[0]=chrome.runtime.getURL("Styles/commonStyle.css"),i[1]=chrome.runtime.getURL("Styles/style.css"),i[2]=chrome.runtime.getURL("Styles/chartStyle.css"),i[3]=chrome.runtime.getURL("Styles/chartStyleIndexMeta.css"),i[4]=chrome.runtime.getURL("Styles/utilityPageStyle.css"),i[5]=chrome.runtime.getURL("Styles/debugStyle.css"),isGhibliMode&&(i[6]=chrome.runtime.getURL("Styles/ghibliStyle.css"));for(let k=0;k<i.length;k++){let M=document.createElement("link");M.href=i[k],M.type="text/css",M.rel="stylesheet",t.append(M)}t.insertAdjacentHTML("afterend",Moreno("fontAwesomeLink")),isGhibliMode&&t.insertAdjacentHTML("afterend",Moreno("googleBetaFont"));var a=await querySelectWait(document,".app");const n=await fetch(chrome.runtime.getURL("Blocks/StatusBar.html"));let o=document.createElement("div");if(a.appendChild(o),isGhibliMode){document.querySelector("html").setAttribute("data-theme","default");let v=document.querySelector("body");v.style.backgroundImage="url('"+chrome.runtime.getURL("BetaAssets/MainBg.png"),v.style.backgroundSize="cover",v.style.backgroundPosition="center",v.style.backgroundRepeat="no-repeat",v.style.backgroundAttachment="fixed"}if("501"==forcedStatus){let C=Moreno("MinVersionStatusBlock");return o.innerHTML=C,o.querySelector("#forcedMessage").style.display="block",void(o.querySelector("#forcedMessage").innerHTML=forcedMessage)}if(currentVersion<minVersion){let P=Moreno("MinVersionStatusBlock");o.innerHTML=P,minVersion>latestVersion?o.querySelector("#notAvailableVersion").style.display="block":o.querySelector("#notSupportedVersion").style.display="block";let x=document.querySelector("#versionCloseBtn"),T=document.querySelector("#statusRootDiv");return void x.addEventListener("click",(function(){T.style.display="none",document.body.style.setProperty("--statusBarHeight","0px")}))}versionTestPassed=!0;let r=await Ross("prefNoTiledWindowKey",!isTiledFeature);isTiledFeature=!r,o.innerHTML=await n.text();let s=Moreno("NoticeLayer");a.insertAdjacentHTML("afterend",s);let l=document.querySelector("body");isPrem&&l.classList.add("prem"),isWatchListFeatureEnabled&&l.classList.add("watchListFeature"),isWatchListFeatureEnabled&&Romero(),(utilityContainer=document.createElement("div")).id="utilityContainer",a.appendChild(utilityContainer),isWatchListFeatureEnabled||utilityContainer.classList.add("watchListLocked"),isPrem||utilityContainer.classList.add("noSub");const c=await fetch(chrome.runtime.getURL("Blocks/UtilityWindow.html"));utilityContainer.innerHTML+=await c.text();var u=document.querySelector("#utilityBG");utilityContainer.style.display="none",u.addEventListener("click",(function(){utilityContainer.style.display="none"})),Acosta(),Brewer(document);let d=utilityContainer.querySelector("#aboutSectionLogo"),f=utilityContainer.querySelector("#updateAvail");currentVersion>=latestVersion&&(f.style.display="none"),d.src=chrome.runtime.getURL("Arts/KitePlus_Logo.png"),document.querySelector("#settingBtn").addEventListener("click",(function(e){if(!isReal){if(e.ctrlKey)return void chrome.storage.local.clear();if(e.altKey)return void Graham();if(e.altKey)return void Graham()}let t="#tabToggle01";isPrem||(t="#tabToggle03"),document.querySelector(t).checked=!0,utilityContainer.style.display="block",Jordan()}));let p=document.querySelector("#idPrefTotalStrikes");for(let I=8;I<60;I+=2)p.add(new Option(I.toString(),I));const m=await fetch(chrome.runtime.getURL("Styles/fontList.txt"));let y=(await m.text()).split("\n");const g=document.querySelector("#idPrefFontFamily");y.forEach((e=>{let t=e.trim();if(!t.startsWith("//")){let e=new Option(t,t);g.add(e)}})),document.addEventListener("keydown",(function(e){"Escape"===e.key&&"block"==utilityContainer.style.display&&(utilityContainer.style.display="none")}),!1),await Patel();let S=document.querySelector("#equityCommoditySwitch"),h=await fetchSyncStorage("isCommodity");function w(){let e=document.querySelector("#equityCommoditySwitch span");isCommodity?(e.innerText="Co.",S.setAttribute("data-balloon","Commodity Margins")):(e.innerText="Eq.",S.setAttribute("data-balloon","Equity Margins"))}if(isCommodity=null!=h&&h,w(),S.addEventListener("click",(async function(){isCommodity=!isCommodity,await setSyncStorage("isCommodity",isCommodity),w()})),isTiledFeature){container=a.getElementsByClassName("container")[0],(orderDiv=document.createElement("div")).id="orderDiv",container.appendChild(orderDiv),orderDiv.innerHTML=orderFrameHTML;let F=orderDiv.querySelector("#orderFrame");function b(){let e=window.innerWidth;e>1920&&(e=1920);let t=e/1920,i=.95/t*100-12*(1-window.innerHeight/1080),a=60/t;F.style.transform=`scale(${t})`,F.style.height=`${i}dvh`,F.style.width=`${a}vw`}window.addEventListener("resize",(()=>{b()})),b()}if(!isAPIMode){container=a;let L=document.createElement("div");L.id="positionDiv",container.appendChild(L),L.innerHTML=positionFrameHTML,container=a;let D=document.createElement("div");D.id="fundsDiv",container.appendChild(D),D.innerHTML=fundFrameHTML}isPrem&&isTiledFeature&&(o=document.createElement("div"),a.appendChild(o),o.innerHTML=Moreno("stickyOpenDiv"),o.innerHTML+=Moreno("stickyCloseDiv"),stickyOpenButton=document.querySelector("#stickyOpenDiv"),stickyCloseButton=document.querySelector("#stickyCloseDiv"),stickyOpenButton.addEventListener("click",(function(){Patterson(!0)})),stickyCloseButton.addEventListener("click",(function(){Patterson(!1)}))),onConfigChanged(!0),isAPIMode?Cruz():(Reyes(),Turner()),isPrem&&Wallace(),Morris(),Morgan(),Joseph(),Bailey(),plusMessageCheck(document),Griffin(),Jones(),Mitchell(),Jensen(),Gordon(),Ruiz(),Vasquez(),isPrem&&Murphy(!0),isPrem&&isTiledFeature&&Murphy(!1)}async function Vasquez(){prefTiledOrderWindow.key&&isPrem?(lastStickyStatus=!0,Hamilton(isFirstPagePosition)):(lastStickyStatus=!1,Hamilton(!1)),document.addEventListener("kc_OnConfigChange",(function(e){"prefTiledOrderWindowKey"==e.detail.configName&&(e.detail.configValue&&isPrem?(lastStickyStatus=!0,Hamilton(!0)):(lastStickyStatus=!1,Hamilton(!1)))}))}async function Simmons(){}async function Romero(){if(null==document.querySelector(".container-left #watchListButtonDiv")){let e=document.querySelector(".container-left .omnisearch");if(null!=e){let t=document.createElement("div");t.id="watchListButtonDiv",e.appendChild(t),t.innerHTML=Moreno("watchListBlock"),Newman()}}}function Jordan(){let e=utilityContainer.querySelector("#aboutZerodhaID"),t=utilityContainer.querySelector("#licenseHeader"),i=utilityContainer.querySelector("#expiryDateInfo"),a=utilityContainer.querySelector("#aboutPurchase"),n=utilityContainer.querySelector("#versionText"),o=document.querySelector(".user-id"),r=document.querySelector("#storeReviewLink");null!=r&&(r.href=storeRatingLink),e.innerText=o.innerText.toUpperCase(),n.innerText=currentVersion.toFixed(2),a.style.display="none","Active"==licenseStatus?(t.innerText="Valid Till:",i.innerHTML=getFormattedDateHTML(expiryDate)):"Expired"==licenseStatus?(t.innerText="Subscription Expired On",i.innerHTML=getFormattedDateHTML(expiryDate),a.style.display="flex"):"NoUser"==licenseStatus?(t.innerText="No Valid Subscription",i.innerHTML="",a.style.display="flex"):("FreeUser"==licenseStatus||"FreeNoUser"==licenseStatus)&&(t.innerText="Limited Free Trial With all Features",i.innerHTML="",a.style.display="flex"),"gift"==subType&&(t.innerText="Gift Subscription, Valid Till")}Foster();var lastStickyStatus=!1;function Patterson(e){lastStickyStatus=e,Alexander(e),Hamilton(e)}function Alexander(e){isTiledFeature&&isPrem&&null!=stickyOpenButton&&(stickyOpenButton.style.display="none",stickyCloseButton.style.display="none",isPos&&(e?stickyCloseButton.style.display="block":stickyOpenButton.style.display="block"))}const onConfigChanged=async function(e){let t,i=document.querySelector("body"),a=document.querySelector("#orderFrame");t=isTiledFeature?a.contentDocument||a.contentWindow.document:document,0==prefColorizeStrikes.key?Gutierrez():Ortiz(),1==prefAvailableCash.key?document.querySelector("#availTD").style.visibility="visible":document.querySelector("#availTD").style.visibility="hidden",1==prefCompactView.key&&isPrem?(i.classList.add("compactView"),t.querySelector("body").classList.add("compactView")):(i.classList.remove("compactView"),t.querySelector("body").classList.remove("compactView"));let n=document.querySelector("body");prefFontFamily.key.includes("Default")?(n.style.fontFamily="Open Sans",t.body.style.fontFamily="Open Sans"):(n.style.fontFamily=prefFontFamily.key,t.body.style.fontFamily=prefFontFamily.key)};function Hamilton(e){if(null==orderDiv)return;let t=document.querySelector("body");Alexander(e),e?(orderDiv.style.visibility="visible",t.classList.add("enabledTiledWindow"),t.classList.remove("disabledTiledWindow")):(orderDiv.style.visibility="collapse",t.classList.add("disabledTiledWindow"),t.classList.remove("enabledTiledWindow"))}async function Graham(){await delay(5e3);let e=document.querySelector("#orderFrame"),t=await querySelectFrameWait(e,".orderbook",5),i=await fetch(chrome.runtime.getURL("Blocks/OrderBookTestBlock.html")),a=await i.text(),n="";for(let e=0;e<250;e++)n+=a;t.innerHTML=n}async function Reynolds(){await delay(1e3);let e=document.querySelector("#orderFrame").contentDocument.querySelector('.page-nav a[href="/orders');null!=e&&e.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!1,cancelable:!0}))}var prefMTMChart={key:!1},prefPositionGroupOption={key:!1};async function Griffin(){if(!isPrem)return;if(isPrem){let e=document.querySelector("#idPrefMTMChartFeatures");null!=e&&e.addEventListener("change",(function(){let e=document.querySelector("#MTMChartCheckBoxDiv");if(1!=prefMTMChartFeatures.key||isChartInit){if(1==prefMTMChartFeatures.key&&isChartInit)null!=e&&(e.style.display="flex");else if(0==prefMTMChartFeatures.key){let t=document.querySelector("#idPrefMTMChart");null!=t&&t.checked&&t.click(),null!=e&&(e.style.display="none")}}else location.reload()}))}let e;for(await delay(10);null==e&&isAppActive;)e=document.querySelector(".open-positions"),await delay(10);let t=e.querySelector(".toolbar .search");if(null==t)return;let i=Moreno("GroupCheckBox");if(t.insertAdjacentHTML("beforebegin",i),Mendez(),1==prefMTMChartFeatures.key)isPrem&&(prefMTMChart.key=await Ross("prefMTMChartKey",prefMTMChart.key),e.querySelector("#idPrefMTMChart").checked=prefMTMChart.key,e.querySelector("#idPrefMTMChart").addEventListener("input",(async function(){prefMTMChart.key=e.querySelector("#idPrefMTMChart").checked,await setSyncStorage("prefMTMChartKey",prefMTMChart.key),Richardson(prefMTMChart.key)})),Cox(),Richardson(prefMTMChart.key));else{let e=document.querySelector("#MTMChartCheckBoxDiv");null!=e&&(e.style.display="none")}}async function Wallace(){if(!isTiledFeature)return;await delay(1);let e,t=document.querySelector("#orderFrame");for(;null==e&&isAppActive;)e=t.contentDocument.querySelector(".container-left"),await delay(10);e.remove();let i=t.contentDocument||t.contentWindow.document;i.querySelector("body").classList.add("enabledTiledWindow");let a=document.createElement("link");a.href=chrome.runtime.getURL("Styles/commonStyle.css"),a.rel="stylesheet",a.type="text/css",i.body.appendChild(a);let n=document.createElement("link");n.href=chrome.runtime.getURL("Styles/orderFrame.css"),n.rel="stylesheet",n.type="text/css",i.body.appendChild(n),isReal&&i.addEventListener("contextmenu",(e=>e.preventDefault())),i.head.insertAdjacentHTML("afterend",Moreno("googleFont")),await delay(100),await delay(100)}function Moreno(e){return getSubBlockHTML(extraHTMLFileText,e)}var prefExtraFloatingSymbol={key:!1},prefIndexMetaSymbol="NIFTY",prefIndexMetaExpiry=void 0,prefIndexMetaToggle={key:!0};async function West(){await Pierce(),Gibson();let e=document.createElement("div");(await querySelectWait(document,".app")).appendChild(e),e.id="floatingPriceWindow";let t=Moreno("floatingPriceWindow");function i(){1==prefFloatingPriceWindow.key&&isPrem?e.style.display="flex":e.style.display="none"}e.innerHTML=t;let a=document.querySelector("#idPrefFloatingPriceWindow");null!=a&&a.addEventListener("change",(()=>{i()}));let n=e.querySelector(".floatingRow"),o=e.querySelector(".downArrowBtn"),r=e.querySelector(".upArrowBtn");for(let f=0;f<5;f++){const p=n.cloneNode(!0);n.parentElement.appendChild(p)}let s=e.querySelectorAll(".floatingRow"),l=e.querySelector("#idPrefExtraFloatingSymbol");prefExtraFloatingSymbol.key=await Ross("prefExtraFloatingSymbolKey",prefExtraFloatingSymbol.key),r.style.display=prefExtraFloatingSymbol.key?"block":"none",o.style.display=prefExtraFloatingSymbol.key?"none":"block",l.addEventListener("click",(async function(){prefExtraFloatingSymbol.key=!prefExtraFloatingSymbol.key,r.style.display=prefExtraFloatingSymbol.key?"block":"none",o.style.display=prefExtraFloatingSymbol.key?"none":"block",await setSyncStorage("prefExtraFloatingSymbolKey",prefExtraFloatingSymbol.key),u()}));let c=[];function u(){for(let e=0;e<c.length;e++){let t=c[e],i=!1;(prefExtraFloatingSymbol.key||e<0||0==t.days)&&(i=!0),t.row.style.visibility=i?"visible":"collapse"}}for(let m=0;m<Math.min(underlyingMapping.length,mainUnderlyingCount);m++){const y=underlyingMapping[m];let g=Duncan(JSON.stringify(y.FoName)),S=(Date.parse(g[0])-getISTTimeStamp())/36e5;S+=3;let h=Math.ceil(S/24);h<0&&(h=0),s[m].querySelector(".floatingSymbol").innerText=y.FoName;let w=s[m].querySelector(".floatingPrice"),b=s[m].querySelector(".floatingChange"),k=s[m].querySelector(".floatingChangePercent"),M=s[m].querySelector(".floatingStatus");async function d(e){let t=await Luna(JSON.parse(e.InstrumentToken));for(;isAppActive;){let e=Fowler(t);if(null!=e&&-1!=e){let t=e.last_price.toFixed(2);if(w.innerText=t,null!=e.ohlc||null!=e.ohlc){let t=e.last_price-e.ohlc.close,i=(t/e.ohlc.close*100).toFixed(2)+"%",a=t.toFixed(2);w.classList.toggle("text-green",t>=0),w.classList.toggle("text-red",t<0),b.innerText=a,k.innerText=i}}await delay(500)}}0==h?(M.innerText="E",M.classList.toggle("activeExpiry",!0)):M.innerText=h,c.push({row:s[m],days:h}),d(y)}u(),i()}let indexMetaWindowParent,floatingPLElement,slElement,targetElement,floatingSLMessageElement,floatingStopLossWindow,isIndexMetaInit=!1,symbolObjects=[];async function Gibson(){let e;for(await delay(250);null==e&&isAppActive;)e=document.querySelector(".marketwatch-sidebar"),await delay(10);let t=document.querySelector("#idPrefStraddleIVInfo");if(null!=t&&t.addEventListener("change",(()=>{isIndexMetaInit||!prefStraddleIVInfo.key?(e.classList.toggle("hiddenIndexMetaParent",!prefStraddleIVInfo.key),indexMetaWindowParent.style.display=prefStraddleIVInfo.key?"flex":"none"):Gibson()})),0==prefStraddleIVInfo.key||!isPrem)return;isIndexMetaInit=!0,prefIndexMetaSymbol=await Ross("prefIndexMetaSymbolKey",prefIndexMetaSymbol),prefIndexMetaExpiry=await Ross("prefIndexMetaExpiryKey",prefIndexMetaExpiry),prefIndexMetaToggle.key=await Ross("prefIndexMetaToggleKey",prefIndexMetaToggle.key),e.classList.toggle("indexMetaData",!0),indexMetaWindowParent=document.createElement("div"),indexMetaWindowParent.id="indexMetaDataWindowParent";let i=await querySelectWait(document,".marketwatch-sidebar");i.insertBefore(indexMetaWindowParent,i.firstChild);let a=Moreno("indexMetaData");indexMetaWindowParent.innerHTML=a,Brewer(indexMetaWindowParent);let n,o,r,s,l,c,u,d,f,p,m,y,g,S,h,w,b,k,M,v,C=!1,P=[],x="",T="";basketHeaderElement=indexMetaWindowParent.querySelector(".row"),r=indexMetaWindowParent.querySelector(".basketSearchDiv"),c=indexMetaWindowParent.querySelector(".ulParentDiv"),l=indexMetaWindowParent.querySelector(".searchButtonSymbol"),d=indexMetaWindowParent.querySelector(".indexPrice"),f=indexMetaWindowParent.querySelector(".indexChange"),p=indexMetaWindowParent.querySelector(".syntheticValue"),g=indexMetaWindowParent.querySelector(".straddleValue").querySelector(".mainPart"),S=indexMetaWindowParent.querySelector(".straddleValue").querySelector(".subPart"),h=indexMetaWindowParent.querySelector(".atmStrikeValue"),b=indexMetaWindowParent.querySelector(".cePrice").querySelector(".mainPart"),M=indexMetaWindowParent.querySelector(".cePrice").querySelector(".subPart"),k=indexMetaWindowParent.querySelector(".pePrice").querySelector(".mainPart"),v=indexMetaWindowParent.querySelector(".pePrice").querySelector(".subPart"),thetaElement=indexMetaWindowParent.querySelector(".thetaValue"),m=indexMetaWindowParent.querySelector(".indexMetaExpiry"),y=m.querySelector("select"),w=indexMetaWindowParent.querySelector(".atmIV"),s=indexMetaWindowParent.querySelector(".searchClose"),u=indexMetaWindowParent.querySelector("input"),y.addEventListener("input",(async function(){o=P[y.value],prefIndexMetaExpiry=o,await setSyncStorage("prefIndexMetaExpiryKey",prefIndexMetaExpiry),E()}));let I=prefIndexMetaToggle.key,F=indexMetaWindowParent.querySelector(".floatingToggle"),L=indexMetaWindowParent.querySelector(".downArrowBtn"),D=indexMetaWindowParent.querySelector(".upArrowBtn");function B(){e.classList.toggle("hiddenIndexMeta",!I),e.classList.toggle("indexMetaData",I),D.style.display=I?"block":"none",L.style.display=I?"none":"block"}F.addEventListener("click",(async()=>{I=!I,prefIndexMetaToggle.key=I,B(),await setSyncStorage("prefIndexMetaToggleKey",prefIndexMetaToggle.key)})),B(),""==T&&(T="");let N=!1;async function E(){let e=x;Hanson(),Reid(e,o),null!=n&&(C=!1,n.cancel(),await delay(1)),C=!0;let t=!1;for(;isAppActive&&C;){let i=50,a=await Fuller(e,o);if(-1!=a.baseTickData){let e=a.baseTickData,t=e.last_price.toFixed(2);if(d.innerText=t,null!=e.ohlc||null!=e.ohlc){let t=e.last_price-e.ohlc.close,i=t.toFixed(2);d.classList.toggle("text-green",t>=0),d.classList.toggle("text-red",t<0),f.innerText=i}}else d.innerText="N/A";if(-1!=a&&a.isReady){i=500;let e=a.price.toFixed(2);p.innerText=-1==a.price?"N/A":e;let n=-1==a.straddlePrice?"N/A":a.straddlePrice.toFixed(2),o=-1==a.straddlePrice?"N/A":a.thetaPrice.toFixed(2),r=-1==a.cePrice?"N/A":a.cePrice.toFixed(2),s=-1==a.pePrice?"N/A":a.pePrice.toFixed(2),l=-1==a.ceTheta?"N/A":a.ceTheta.toFixed(2),c=-1==a.peTheta?"N/A":a.peTheta.toFixed(2);g.innerText=n,S.innerText=o,h.innerText=-1==a.atmStrike?"N/A":a.atmStrike,b.innerText=r,M.innerText=l,k.innerText=s,v.innerText=c,w.innerText=-1==a.atmIV?"N/A":a.atmIV.toFixed(2),t||(t=!0)}else p.innerText="N/A",g.innerText="N/A",S.innerText="N/A",g.innerText="N/A",h.innerText="N/A",b.innerText="N/A",M.innerText="N/A",k.innerText="N/A",v.innerText="N/A",w.innerText="N/A";n=delayFlex(i),await n.promise}}Willis((t=>{!async function(){let t=0,i=document.querySelector(".marketwatch-sidebar");null!=i&&null!=i&&i.addEventListener("click",(e=>{(new Date).getTime()-t<200||N&&m()}));let a=6,n=r.querySelector("ul"),d=[];for(let e=0;e<a;e++){let e=document.createElement("li");n.appendChild(e),d.push(e),e.addEventListener("click",(t=>{f(e.innerText)}))}async function f(e){"-"!=e?(g(!1),p(),T!=e&&(T=e,u.value=T,async function(e){for(let e=0;e<symbolObjects.length;e++)symbolObjects[e].runningStatus=!1;let t,i=symbolObjects.filter((t=>t.symbol==e));i.length>0?(t=i[0],t.runningStatus=!0):(t={symbol:e,runningStatus:!0},symbolObjects.push(t)),x=t.symbol,await async function(e){let t=e.symbol;P=Duncan(JSON.stringify(t)),P.includes(prefIndexMetaExpiry)?o=prefIndexMetaExpiry:(o=P.length>0?P[0]:void 0,prefIndexMetaExpiry=o,await setSyncStorage("prefIndexMetaExpiryKey",prefIndexMetaExpiry)),y.options.length=0;let i=getISTTimeStamp();for(let e=0;e<P.length;e++){let t=P[e],a=new Date(t),n="";n=(a.getTime()-i)/864e5<365?a.getDate()+" "+monthConst[a.getMonth()]:monthConst[a.getMonth()]+"-"+a.getFullYear(),y.add(new Option(n,e))}let a=P.indexOf(o);y.selectedIndex=a}(t),E()}(e)),u.value=T,prefIndexMetaSymbol=T,await setSyncStorage("prefIndexMetaSymbolKey",prefIndexMetaSymbol)):m()}function p(){for(let e=0;e<a;e++)d[e].innerText="",d[e].style.display="none"}function m(){u.value=T,g(!1),p(),u.blur()}function g(i){t=(new Date).getTime(),N=i,s.style.visibility=i?"visible":"hidden",l.style.visibility=i?"hidden":"visible",e.classList.toggle("searchOpen",N),c.style.visibility=i?"visible":"hidden"}function S(e,t){d[e].innerText=t,d[e].style.display="block"}l.addEventListener("click",(e=>{u.focus(),u.value=""})),s.addEventListener("click",(()=>{m()})),u.addEventListener("keydown",(e=>{27==e.keyCode&&m()})),u.addEventListener("change",(()=>{""==u.value&&(u.value=T)})),u.addEventListener("focus",(e=>{u.value="",g(!0),p();for(let e=0;e<defaultSearchInstruments.length;e++)S(e,defaultSearchInstruments[e])})),u.addEventListener("input",(()=>{let e=u.value.toUpperCase();if(g(!1),""==e.trim())return void g(!1);g(!0),p(),g(!0);let t=eqFOKeys.filter((t=>t.includes(e))),i=Math.min(t.length,a);for(let e=0;e<i;e++)S(e,JSON.parse(t[e]));for(let e=0;e<a;e++)e<t.length?S(e,JSON.parse(t[e])):S(e,"-")})),f(prefIndexMetaSymbol)}()}))}let tbodyObserver,isFloatingStoplossVisible=!0,floatingSL_PNL=0,isFloatingInit=!1,lifeSlUpdateCounter=0,currentSlUpdateCounter=0,floatingStopLossSetTime=0,slTriggerObject={isTrigger:!1,instanceNumber:0},floatingStopLossObject={stoploss:0,target:0,isStopLossActive:!1,isTargetActive:!1},floatingStopLossPreference={prefNoBuy:!1,prefNoEquity:!1},floatingUIElements={slElement:void 0,targetElement:void 0,slCheckBox:void 0,targetCheckBox:void 0,prefNoBuyToggle:void 0,prefNoEquityToggle:void 0,setUIElements:function(){this.slCheckBox.checked=floatingStopLossObject.isStopLossActive,this.targetCheckBox.checked=floatingStopLossObject.isTargetActive,this.prefNoBuyToggle.checked=floatingStopLossPreference.prefNoBuy,this.prefNoEquityToggle.checked=floatingStopLossPreference.prefNoEquity,Crawford(this.slElement,floatingStopLossObject.stoploss),Crawford(this.targetElement,floatingStopLossObject.target),Tucker()}};async function Fernandez(){let e=await fetchSyncStorage("lifeSlUpdateCounter");return null!=e?e:0}async function McDonald(){let e=await fetchSyncStorage("slTriggerObject");return null!=e?e:slTriggerObject}async function Woods(){if(await delay(500),!isPrem)return;if(!isMTMStopLossFeature)return;let e=await fetchSyncStorage("floatingStopLossSetTime");if(null!=e){let t=new Date(e);new Date(getISTTimeStamp()).getUTCDate()!=t.getUTCDate()&&(Freeman(),Chen())}lifeSlUpdateCounter=await Fernandez(),currentSlUpdateCounter=lifeSlUpdateCounter;let t=await fetch(chrome.runtime.getURL("Blocks/JsonData/mtmWarning.json")),i=await t.json(),a=document.createElement("div");(await querySelectWait(document,".app")).appendChild(a),a.id="StopLossWarningWindowParent";let n=Moreno("floatingStopLossWarningWindow");a.innerHTML=n;let o=document.querySelector("#stopLossWarningWindow");a.style.display="none";let r=o.querySelector("ul");for(let e=0;e<i.length;e++){const t=i[e];let a=document.createElement("li");a.innerText=t.Warning,r.appendChild(a)}let s=document.querySelector("#MTM").parentElement;floatingStopLossWindow=document.createElement("div"),s.appendChild(floatingStopLossWindow),floatingStopLossWindow.id="floatingStopLossWindow";let l=Moreno("floatingStopLossWindow");floatingStopLossWindow.innerHTML=l,floatingPLElement=floatingStopLossWindow.querySelector("#floatingPL"),floatingSLMessageElement=floatingStopLossWindow.querySelector(".stopLossMessage");let c=floatingStopLossWindow.querySelector(".floatingStopLossToggle"),u=floatingStopLossWindow.querySelector(".downArrowBtn"),d=floatingStopLossWindow.querySelector(".upArrowBtn");function f(){isFloatingStoplossVisible=!isFloatingStoplossVisible,floatingStopLossWindow.classList.toggle("hiddenSL",!isFloatingStoplossVisible),u.style.display=isFloatingStoplossVisible?"block":"none",d.style.display=isFloatingStoplossVisible?"none":"block",isFloatingStoplossVisible||Guzman("","error"),isFloatingStoplossVisible||(p=!1,b())}c.addEventListener("click",(()=>f()));let p=!1,m=!1,y=floatingStopLossWindow.querySelector(".floatingWarningBtn"),g=o.querySelector(".floatingWarningCloseBtn"),S=o.querySelector(".buttonExecute"),h=floatingStopLossWindow.querySelector(".floatingSLSettingBtn"),w=floatingStopLossWindow.querySelector(".floatingSettingCloseBtn");function b(){h.style.setProperty("visibility",p?"hidden":"visible"),floatingStopLossWindow.classList.toggle("settingVisible",p)}function k(){a.style.display=m?"block":"none",o.style.setProperty("visibility",m?"visible":"hidden")}h.addEventListener("click",(async function(){p=!0,b()})),w.addEventListener("click",(async function(){p=!1,b()})),y.addEventListener("click",(async function(){m=!0,k()})),g.addEventListener("click",(async function(){m=!1,k()})),S.addEventListener("click",(async function(){m=!1,k()})),k(),f(),floatingUIElements.targetCheckBox=floatingStopLossWindow.querySelector("#floatingTargetCheckbox"),floatingUIElements.slCheckBox=floatingStopLossWindow.querySelector("#floatingSLCheckbox"),floatingUIElements.slElement=floatingStopLossWindow.querySelector(".floatingSLInput"),floatingUIElements.targetElement=floatingStopLossWindow.querySelector(".floatingTargetInput"),floatingUIElements.prefNoBuyToggle=floatingStopLossWindow.querySelector("#floatingStopLossNoBuy"),floatingUIElements.prefNoEquityToggle=floatingStopLossWindow.querySelector("#floatingStopLossNoEquity"),floatingUIElements.prefNoBuyToggle.addEventListener("input",(async function(){floatingStopLossPreference.prefNoBuy=floatingUIElements.prefNoBuyToggle.checked,Freeman(),Chen()})),floatingUIElements.prefNoEquityToggle.addEventListener("input",(async function(){floatingStopLossPreference.prefNoEquity=floatingUIElements.prefNoEquityToggle.checked,Freeman(),Chen()})),floatingUIElements.targetCheckBox.addEventListener("change",(async function(){if(Burns(),await delay(10),floatingStopLossObject.target<floatingSL_PNL&&floatingUIElements.targetCheckBox.checked)return floatingUIElements.targetCheckBox.checked=!1,void Guzman("Target should be greater than current MTM","error");floatingStopLossObject.isTargetActive=floatingUIElements.targetCheckBox.checked,slTriggerObject.isTrigger=!1,await setSyncStorage("slTriggerObject",slTriggerObject),Freeman(),Tucker(),Chen()})),floatingUIElements.slCheckBox.addEventListener("change",(async function(){if(Burns(),await delay(10),floatingStopLossObject.stoploss>floatingSL_PNL&&floatingUIElements.slCheckBox.checked)return floatingUIElements.slCheckBox.checked=!1,void Guzman("Stoploss should be less than current MTM","error");floatingStopLossObject.isStopLossActive=floatingUIElements.slCheckBox.checked,slTriggerObject.isTrigger=!1,await setSyncStorage("slTriggerObject",slTriggerObject),Freeman(),Tucker(),Chen()})),Henry(floatingUIElements.slElement,!0),Henry(floatingUIElements.targetElement,!1),isFloatingInit=!0;let M=await fetchSyncStorage("floatingStopLossObject");null!=M&&(floatingStopLossObject=M),M=await fetchSyncStorage("floatingStopLossPreference"),null!=M&&(floatingStopLossPreference=M),floatingUIElements.setUIElements(),Webb()}function Henry(e,t){e.addEventListener("input",(function(){let t=e.value,i=t.slice(0,1);i=i.replace(/[^0-9.-]/g,"");let a=t.substring(1,t.length);a=a.replace(/[^0-9, ]/,""),e.value=i+a})),e.addEventListener("keydown",(t=>{27==t.keyCode&&(e.blur(),floatingUIElements.setUIElements())})),e.addEventListener("focus",(t=>{e.value="",e.classList.toggle("text-Zero",!0),e.classList.toggle("text-Negative",!1),e.classList.toggle("text-Positive",!1),Burns()})),e.addEventListener("focusout",(e=>{floatingUIElements.setUIElements()})),e.addEventListener("change",(i=>{isNaN(parseFloat(e.value))&&(e.value="0");let a=parseFloat(e.value);if(t){if(a>floatingSL_PNL&&floatingUIElements.slCheckBox.checked)return e.blur(),void Guzman("Stoploss should be less than current MTM","error");floatingStopLossObject.stoploss=a}else{if(a<floatingSL_PNL&&floatingUIElements.targetCheckBox.checked)return e.blur(),void Guzman("Target should be greater than current MTM","error");floatingStopLossObject.target=a}e.blur(),floatingUIElements.setUIElements(),Freeman()}))}async function Chen(){let e=getISTTimeStamp();await setSyncStorage("floatingStopLossSetTime",e)}async function Freeman(){lifeSlUpdateCounter++,currentSlUpdateCounter++,await setSyncStorage("floatingStopLossObject",floatingStopLossObject),await setSyncStorage("floatingStopLossPreference",floatingStopLossPreference),await setSyncStorage("lifeSlUpdateCounter",lifeSlUpdateCounter)}async function Webb(){for(;isAppActive;){let e=floatingStopLossObject;lifeSlUpdateCounter=await Fernandez(),currentSlUpdateCounter!=lifeSlUpdateCounter&&(currentSlUpdateCounter=lifeSlUpdateCounter,e=await fetchSyncStorage("floatingStopLossObject"),floatingStopLossObject=e,e=await fetchSyncStorage("floatingStopLossPreference"),floatingStopLossPreference=e,floatingUIElements.setUIElements()),e.isStopLossActive&&null!=e.stoploss&&floatingSL_PNL<e.stoploss&&(e.isStopLossActive=!1,Porter(!0)),e.isTargetActive&&null!=e.target&&floatingSL_PNL>e.target&&(e.isTargetActive=!1,Porter(!1)),await delay(300)}}function Tucker(){let e=floatingStopLossObject.isStopLossActive||floatingStopLossObject.isTargetActive;floatingStopLossWindow.classList.toggle("SLActive",e)}async function Guzman(e,t){floatingSLMessageElement.classList.toggle("text-Negative","error"==t),floatingSLMessageElement.classList.toggle("text-Zero","info"==t),floatingSLMessageElement.style.setProperty("display","none"),await delay(20),floatingSLMessageElement.innerText=e,floatingSLMessageElement.style.setProperty("display","inline")}function Burns(){floatingSLMessageElement.style.setProperty("display","none")}function Crawford(e,t){null==t||isNaN(t)?e.value="N/A":(e.value=t.toLocaleString("en-IN",{maximumFractionDigits:0,minimumFractionDigits:0}),e.classList.toggle("text-Zero",0==t),e.classList.toggle("text-Positive",t>0),e.classList.toggle("text-Negative",t<0)),Olson()}async function Olson(){}async function Simpson(e){isFloatingInit&&(floatingSL_PNL=e,floatingPLElement.classList.toggle("text-Positive",e>=0),floatingPLElement.classList.toggle("text-Negative",e<0),floatingPLElement.innerText=e.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2}))}async function Porter(e){floatingStopLossObject.isStopLossActive=!1,floatingStopLossObject.isTargetActive=!1,floatingUIElements.setUIElements(),Freeman(),await delay(Math.random(50*Math.random())+10);let t=await McDonald("slTriggerObject");if(t.isTrigger)return;let i=new Date(getISTTimeStamp()),a=e?"StopLoss triggered at":"Target achieved at";a+=" "+getUTCTimeFormat(i),Guzman(a,"info"),t.isTrigger=!0,t.instanceNumber=instanceCounter,await setSyncStorage("slTriggerObject",t),Hunter()}async function Hunter(){await delay(10);let e=activePositions.map((e=>e));floatingStopLossPreference.prefNoBuy&&(e=e.filter((e=>1==e.isSell))),floatingStopLossPreference.prefNoEquity&&(e=e.filter((e=>kitePlusFOExchanges.includes(e.exchange)))),e=e.sort(((e,t)=>!e.isSell&&t.isSell?1:!t.isSell&&e.isSell?-1:1));let t=[];for(let i=0;i<e.length;i++){let a=e[i],n=a.freezeLimit,o=Math.abs(a.quantity);if(o>n&&null!=n){let e=a.inst.lot_size,i=o/e,r=Math.ceil(o/n),s=distributeNumber(i,r);for(let i=0;i<s.length;i++){let n=JSON.parse(JSON.stringify(a));n.quantity=s[i]*e,t.push(n)}}else t.push(a)}for(let e=0;e<t.length;e++){const i=t[e];if(0==i.quantity)continue;let a={variety:"regular",exchange:i.exchange,tradingsymbol:i.tradingsymbol,transaction_type:i.isSell?"BUY":"SELL",order_type:"MARKET",quantity:Math.abs(i.quantity),price:0,product:i.product,validity:"DAY",trigger_price:"0",squareoff:"0",stoploss:"0",trailing_stoploss:"0",user_id:uID},n=await Wheeler(a);null!=n.ok&&n.ok||(await n.json(),showPlusMessage(document,"Error Exiting Positions","error")),await delay(15)}showPlusMessage(document,"Exited all the positions","info")}let quantityObserver,positionCountElement,posUtilityBlock,payoffTooltipBlockHTML,groupBlockHTML,premiumBlockHTML,positionGroupCheckbox,positionGroupExpiryCheckbox,activeGroups=[],payOffGraphStatus=new Set,isGroupSettingEnabled=!1,groupFunctionStatus=[],functionCallCounter=0,currentTotalProjected=0,isTableExist=!1,bufferCounter=0,rowDetails=[],rowsGroupDivPool=[],isPayOffDisabled=!1,isLightGroupCreation=!1,isCacheRowFeature=!0,isProjectProfitFeature=!1,isGroupCallPutInfoFeature=!1,groupInfoObjects=[],groupTargetSetObject=[],groupTargetUISet=[],lastGroupTargetCleanTime=0,isGroupStopLossFeature=!1,isGroupMarginFeature=!0,lifeGroupSlCounter=0,currentGroupSlCounter=0;const groupViewChangeEvent=new CustomEvent("kc_OnGroupViewChange",{detail:{groupType:""}});async function Gordon(){posUtilityBlock=Moreno("positionUtility"),groupBlockHTML=Moreno("GroupHeader"),payoffTooltipBlockHTML=Moreno("PayoffTooltip"),premiumBlockHTML=Moreno("PremiumDisplayBlock"),isLightGroupCreation=!0,isProjectProfitFeature=await Ross("prefGroupViewStraddleInfoKey",isProjectProfitFeature),isGroupCallPutInfoFeature=await Ross("prefGroupViewCallPutInfoKey",isGroupCallPutInfoFeature),isGroupStopLossFeature=isMTMStopLossFeature,lastGroupTargetCleanTime=await Ross("lastGroupTargetCleanTimeKey",lastGroupTargetCleanTime);let e=getISTTimeStamp();if(e>lastGroupTargetCleanTime+864e5){lastGroupTargetCleanTime=e;let t=new Date(e);t.setUTCHours(8,15,0),lastGroupTargetCleanTime=t.getTime(),await setSyncStorage("lastGroupTargetCleanTimeKey",lastGroupTargetCleanTime),groupTargetSetObject=[],Silva()}let t=document.querySelector("#idPrefGroupViewStraddleInfo");null!=t&&t.addEventListener("change",(function(){isProjectProfitFeature=t.checked,Snyder(!1)}));let i=document.querySelector("#idPrefGroupViewCallPutInfo");null!=i&&i.addEventListener("change",(function(){isGroupCallPutInfoFeature=i.checked,Snyder(!1)})),groupTargetSetObject=await Ross("groupTargetSetObjectKey",groupTargetSetObject),Holmes(),Wagner()}async function Mendez(){let e=document.querySelector(".open-positions");prefPositionGroupOption.key=await Ross("prefPositionGroupOptionKey",prefPositionGroupOption.key),positionGroupCheckbox=e.querySelector("#idPrefPositionGroupOption"),positionGroupCheckbox.checked=prefPositionGroupOption.key,positionGroupExpiryCheckbox=document.querySelector("#idPrefGroupExpiryWise"),positionGroupExpiryCheckbox.addEventListener("input",(async function(){groupTargetSetObject=[],Dixon(!0),Snyder(!1)})),positionGroupCheckbox.addEventListener("input",(async function(){prefPositionGroupOption.key=e.querySelector("#idPrefPositionGroupOption").checked,await setSyncStorage("prefPositionGroupOptionKey",prefPositionGroupOption.key),Dixon(!0),Snyder(!1)})),Snyder(!1)}async function Silva(){await setSyncStorage("groupTargetSetObjectKey",groupTargetSetObject)}function Shaw(){for(let e=0;e<rowsGroupDivPool.length;e++){const t=rowsGroupDivPool[e];if(1==t.status)return t.status=!1,t}}async function Snyder(e){lastGroupCreateTime=Date.now(),null!=tbodyObserver&&tbodyObserver.disconnect(),null!=quantityObserver&&quantityObserver.disconnect(),bufferCounter++,await delay(e?400:50),bufferCounter--,0==bufferCounter&&Black(prefPositionGroupOption.key)}async function Dixon(e){if(e)for(let e=0;e<groupTargetSetObject.length;e++){const t=groupTargetSetObject[e];t.isStopLossActive=!1,t.isTargetActive=!1}Silva();for(let e=0;e<groupTargetUISet.length;e++)groupTargetUISet[e].setUIElements();Palmer()}async function Munoz(e,t){for(let i=0;i<groupTargetUISet.length;i++){const a=groupTargetUISet[i];if(a.groupName==e.groupName&&a.expiry.value==e.expiry)return void a.onSlTargetActivated(t)}}async function Hunt(e){for(let t=0;t<groupInfoObjects.length;t++){const i=groupInfoObjects[t];if(i.groupStringyName==e.name&&(i.expiry.value==e.expiry||null==e.expiry))return void i.updateCallPutInfo(e)}}async function Hicks(e){for(let t=0;t<groupInfoObjects.length;t++){const i=groupInfoObjects[t];if(i.groupStringyName==e.name&&(i.expiry.value==e.expiry||null==e.expiry))return void i.updateCalPnl(e.profit)}}async function Holmes(){for(currentGroupSlCounter=await Ross("lifeGroupSlCounterKey",lifeGroupSlCounter);isAppActive;)lifeGroupSlCounter=await Ross("lifeGroupSlCounterKey",lifeGroupSlCounter),currentGroupSlCounter!=lifeGroupSlCounter&&(currentGroupSlCounter=lifeGroupSlCounter,prefPositionGroupOption.key=await Ross("prefPositionGroupOptionKey",prefPositionGroupOption.key),positionGroupCheckbox.checked=prefPositionGroupOption.key,prefGroupExpiryWise.key=await Ross("prefGroupExpiryWise",prefGroupExpiryWise.key),positionGroupExpiryCheckbox.checked=prefGroupExpiryWise.key,Snyder(!1)),await delay(200)}async function Palmer(){currentGroupSlCounter++,lifeGroupSlCounter++,await setSyncStorage("lifeGroupSlCounterKey",lifeGroupSlCounter)}let lastGroupCreateTime=0;async function Wagner(){for(;isAppActive;){if((Date.now()-lastGroupCreateTime)/1e3>5&&isTableExist){let e=document.querySelector(".open-positions tbody");if(null!=e){let t=e.querySelectorAll(":scope > tr:not(.groupDiv)");for(let e=0;e<t.length;e++)if(null==t[e].querySelector(".select-cell .posUtility")){lastGroupCreateTime=Date.now(),Snyder(!0);break}}lastGroupCreateTime=Date.now()}await delay(500)}}async function Black(e){groupInfoObjects=[],groupTargetSetObject=await Ross("groupTargetSetObjectKey",groupTargetSetObject),groupFunctionStatus=groupFunctionStatus.map((e=>!1)),Dominguez("processing groups and token lengths "+tokenSet_Global.length),groupFunctionStatus.push(!0),null!=quantityObserver&&quantityObserver.disconnect(),quantityObserver=new MutationObserver((e=>Payne())),null!=tbodyObserver&&tbodyObserver.disconnect(),functionCallCounter++;let t,i=functionCallCounter-1;for(activeGroups=[],groupTargetUISet=[],isGroupSettingEnabled=e;null==t&&groupFunctionStatus[i];)t=document.querySelector(".open-positions tbody"),await delay(10);if(null==t||null==t)return;positionCountElement=document.querySelector(".open-positions .page-title .count"),currentTotalProjected=0,lastGroupCreateTime=Date.now(),isTableExist=!0,t.classList.toggle("groupedBody",e),document.querySelectorAll(".open-positions tfoot .text-right").forEach((e=>{e.style.setProperty("visibility",isGroupSettingEnabled?"hidden":"visible")}));let a=t.querySelectorAll(".groupDiv");for(let w=0;w<a.length;w++)a[w].remove();for(let b=0;b<rowsGroupDivPool.length;b++)rowsGroupDivPool[b].status=!0;rowDetails=[];let n=t.querySelectorAll(":scope > tr:not(.groupDiv)"),o=groupBlockHTML;if(n.forEach((e=>{let t=e.querySelector(".instrument"),a=e.querySelector(".product"),n=e.querySelector(".exchange"),o=e.querySelector(".quantity"),r=e.querySelector(".average-price"),s=e.querySelector(".last-price"),l=e.querySelector(".pnl"),c=t.querySelector(".tradingsymbol").innerText,u="",d=!1;t.classList.contains("open")&&(d=!0);let f="",p="",m=1,y=0,g=-1,S=a.innerText.replace(/[\s]/g,""),h=n.innerText.replace(/[\s]/g,""),w=parseFloat(o.innerText.replace(/,/g,"")),b=parseFloat(r.innerText.replace(/,/g,"")),k=parseFloat(s.innerText.replace(/,/g,"")),M=parseFloat(l.innerText.replace(/,/g,"")),v=c.split(/\s+/);{null!=o&&quantityObserver.observe(o,{subtree:!0,characterData:!0});let e="",t="0";1==v.length?(f=v[0],e="EQ"):4==v.length?(f=v[0]+" "+v[1],t=v[2],e=v[v.length-1],u=v[1]):3==v.length?(f=v[0]+" "+v[1],u=v[1],e=v[v.length-1]):(f=v[0]+" "+v[1]+" "+v[2],t=v[3],u=v[1]+" "+v[2],e=v[v.length-1]),"CE"==e.toLocaleUpperCase()?g=1:"PE"==e.toLocaleUpperCase()?g=2:"FUT"==e.toLocaleUpperCase()?g=3:"EQ"==e.toLocaleUpperCase()&&(g=4),3!=g&&(y=parseFloat(t.replace(/,/g,""))),3!=g&&4!=g||(y=b)}0==prefGroupExpiryWise.key&&(f=c.replace(/ .*/,"")),"MCX"==h&&(m=Hudson(JSON.stringify(v[0]))),p=f.replace(/[^a-zA-Z0-9 ]/g,""),p=p.replace(/\s/g,"");let C={name:f,product:S,exchange:h,instFullName:c,strikeNumber:y,callPutType:g,isOpen:d,id:p,expiry:u,quantity:d?w:0,quantityMultiplier:m,averagePrice:b,ltp:k,row:e,pnlElement:l,pnl:M,targetInst:void 0};if(async function(){for(;isAppActive&&groupFunctionStatus[i];){let e=Sims(C.name.split(/\s(.+)/)[0],C.strikeNumber,C.callPutType,C.averagePrice,C.expiry);if(null!=e){C.targetInst=e;break}await delay(50)}for(;isAppActive&&groupFunctionStatus[i]&&-1==m;)m=Hudson(JSON.stringify(v[0])),await delay(100)}(),rowDetails.push(C),isBasketFeature){let t=e.querySelector(".select-cell .posUtility"),i=e.querySelector(".posUtility");if(!t&&i&&i.remove(),null==t){let i=e.querySelector(".select-cell"),a=e.querySelector(".su-checkbox-group"),n=document.createElement("div");n.classList.add("posUtilityParent"),t=document.createElement("div"),t.classList.add("posUtility"),i.appendChild(t),t.innerHTML=posUtilityBlock;let o=e.querySelector(".positionEdit"),r=e.querySelector(".positionAdd");i.append(n),n.append(a),n.append(t),Brewer(n),async function(e){}(),r.addEventListener("click",(async function(t){if(t.stopPropagation(),isBasketWindowOpen){let e=1;if(t.ctrlKey&&(e=-1),null!=White(C.targetInst,C.quantity*e))return}await delay(5),e.dispatchEvent(new Event("mouseover"));let i=e.querySelector(".icon-more-vertical");if(null==i)return;i.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0})),await delay(5);let a=e.querySelector('[data-label="Add"]');null!=a?(a.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0})),await delay(5)):showPlusMessage(document,"Quick add quantities not available! Add manually from dropdown menu","error"),i.dispatchEvent(new MouseEvent("mouseleave",{view:window,bubbles:!0,cancelable:!0}))}),!0),o.addEventListener("click",(async function(e){e.stopPropagation();let t,i=!1,a=rowDetails.findIndex((e=>e.instFullName==C.instFullName&&e.product==C.product));if(-1!=a&&(t=rowDetails[a]),null!=t){let e=Sims(f.split(/\s(.+)/)[0],t.strikeNumber,t.callPutType,t.averagePrice,t.expiry);null==e?i=!0:Perez(e,t.quantity,S)}else i=!0;i&&showPlusMessage(document,"Try Again","info")}))}if(null!=t){let e=t.querySelector(".posBasketUtility");e.style.visibility=1==g||2==g?"visible":"hidden","MCX"!=h&&"CDS"!=h||(e.style.visibility="hidden")}}})),!isPrem)return;if(!isGroupSettingEnabled&&rowDetails.length>0){rowDetails.sort((function(e,t){var i=e.instFullName,a=t.instFullName;return e.isOpen&&!t.isOpen?-1:!e.isOpen&&t.isOpen?1:i===a?-1:i>a?1:-1}));for(let k=0;k<rowDetails.length;k++)t.appendChild(rowDetails[k].row)}if(!isGroupSettingEnabled)return;let r=groupBy(rowDetails,"name"),s=Object.keys(r);for(let M=0;M<s.length;M++){const v=r[s[M]];v.sort((function(e,t){return e.isOpen&&!t.isOpen?-1:!e.isOpen&&t.isOpen||e.instFullName>t.instFullName?1:-1}));for(let C=0;C<v.length;C++)t.appendChild(v[C].row)}let l=[];for(let P=0;P<s.length;P++){let x=s[P],T=x.split(/(\s+)/)[0];const I=r[x];let F=P,L=I[0].id,D=I[0].exchange,B={value:void 0},N=!1;l.push(0);let E,O=I.some((e=>1==e.callPutType||2==e.callPutType));payOffGraphStatus.has(x)&&(N=!0);let A,W={},G=!1,_=!0;if(isCacheRowFeature)if(E=Shaw(),null!=E)E.row.id=L,E.row.classList.toggle("hiddenChart",N),I[0].row.parentElement.insertBefore(E.row,I[0].row),G=!0;else{let K=o.replace("targetGroupID",L);I[0].row.insertAdjacentHTML("beforebegin",K);let z=t.querySelector("#"+L);W={row:z,status:!1},A=May(z,".ktGroupProjected"),rowsGroupDivPool.push(W)}else{let q=o.replace("targetGroupID",L);I[0].row.insertAdjacentHTML("beforebegin",q);let J=t.querySelector("#"+L);A=May(J,".ktGroupProjected")}let R=t.querySelector("#"+L);R.classList.toggle("hiddenChart",!N);let U=R.querySelector(".groupName");U.innerText=s[P]+": ",U.addEventListener("dblclick",(async function(){I.forEach((async e=>{if(0!=e.quantity){let t=e.row.querySelector(".su-checkbox-group input");if(null!=t){t.dispatchEvent(new MouseEvent("input",{view:window,bubbles:!0,cancelable:!0})),await delay(5);let e=document.querySelector(".open-positions tfoot button");null!=e&&e.dispatchEvent(new MouseEvent("click"))}}}))}));let V=R.querySelector(".groupProfit");activeGroups.push({groupElements:r[s[P]],groupProfitElement:V});let H=!1;if(0==prefGroupExpiryWise.key){let Q=I.filter((e=>e.isOpen=!0)),Y=groupBy(Q,"expiry");Object.keys(Y).length>1&&(R.classList.add("hiddenPL"),H=!0)}function c(){R.querySelector(".groupMetaDetails").classList.toggle("hiddenGroupMetaDetails",!isProjectProfitFeature||H||!_),R.querySelector(".groupCallPutInfoParent").classList.toggle("hiddenGroupMetaDetails",!isGroupCallPutInfoFeature||!O)}if(c(),isPositionCorrupt&&I.filter((e=>!kitePlusExchanges.includes(e.exchange))).length>0&&(R.classList.add("hiddenPL"),H=!0),H)B.value="";else{async function u(e){for(;isAppActive&&groupFunctionStatus[i];){if(null!=I[0].targetInst){B.value=I[0].targetInst.expiry;break}await delay(50)}}u()}R.querySelector(".groupSLTarget").style.visibility=isGroupStopLossFeature?"visible":"collapse";let j={groupName:T,groupStringyName:JSON.stringify(T),expiry:B,currentPNL:0,groupCalProfitElement:R.querySelector(".groupCalProfit"),callPremiumElement:R.querySelector(".groupMetaCallPremium"),putPremiumElement:R.querySelector(".groupMetaPutPremium"),callPNLElement:R.querySelector(".groupMetaCallPNL"),putPNLElement:R.querySelector(".groupMetaPutPNL"),updateCalPnl(e){this.groupCalProfitElement.innerText=e.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2})},updateCallPutInfo(e){this.callPNLElement.classList.toggle("text-Positive",e.callPNL>0),this.callPNLElement.classList.toggle("text-Negative",e.callPNL<0),this.putPNLElement.classList.toggle("text-Positive",e.putPNL>0),this.putPNLElement.classList.toggle("text-Negative",e.putPNL<0),this.callPremiumElement.classList.toggle("text-Positive",e.callPremium>0),this.callPremiumElement.classList.toggle("text-Negative",e.callPremium<0),this.putPremiumElement.classList.toggle("text-Positive",e.putPremium>0),this.putPremiumElement.classList.toggle("text-Negative",e.putPremium<0),this.callPNLElement.innerText=formatToCompactNumberPNL(e.callPNL.toFixed(0)),this.putPNLElement.innerText=formatToCompactNumberPNL(e.putPNL.toFixed(0)),this.callPremiumElement.innerText=formatToCompactNumberPNL(e.callPremium.toFixed(0)),this.putPremiumElement.innerText=formatToCompactNumberPNL(e.putPremium.toFixed(0))}};if(groupInfoObjects.push(j),isGroupStopLossFeature){async function d(){for(;isAppActive&&groupFunctionStatus[i]&&null==B.value;)await delay(50);if(!groupFunctionStatus[i])return;let e;for(let t=0;t<groupTargetSetObject.length;t++){const i=groupTargetSetObject[t];if(i.groupName==T&&i.expiry==B.value){e=i;break}}null==e&&(e={groupName:T,expiry:B,currentPNL:0,stoploss:0,target:0,isStopLossActive:!1,isTargetActive:!1},groupTargetSetObject.push(e));let t={groupName:T,expiry:B,slElement:R.querySelector(".groupStopLossInput"),targetElement:R.querySelector(".groupTargetInput"),slCheckBox:R.querySelector(".groupStopLossCheckBox"),targetCheckBox:R.querySelector(".groupTargetCheckBox"),messageDiv:R.querySelector(".groupMessage"),onSlTargetActivated:async function(e){let t=new Date(getISTTimeStamp()),i=e?"Target achieved at":"StopLoss triggered at";i+=" "+getUTCTimeFormat(t),a(i,e?"success":"error")},setUIElements:async function(){this.slCheckBox.checked=e.isStopLossActive,this.targetCheckBox.checked=e.isTargetActive,n(this.slElement,e.stoploss),n(this.targetElement,e.target)}};async function a(e,i){"error"==i?t.messageDiv.classList.add("text-Negative"):"info"==i?t.messageDiv.classList.add("text-Zero"):"success"==i&&t.messageDiv.classList.add("text-Positive"),t.messageDiv.innerText=e}function n(e,t){null==t?e.value="N/A":(e.value=t.toLocaleString("en-IN",{maximumFractionDigits:0,minimumFractionDigits:0}),e.classList.toggle("text-Zero",0==t),e.classList.toggle("text-Positive",t>0),e.classList.toggle("text-Negative",t<0))}function o(i,n){i.addEventListener("input",(function(){let e=i.value,t=e.slice(0,1);t=t.replace(/[^0-9.-]/g,"");let a=e.substring(1,e.length);a=a.replace(/[^0-9, ]/,""),i.value=t+a})),i.addEventListener("keydown",(e=>{27==e.keyCode&&(i.blur(),t.setUIElements())})),i.addEventListener("focus",(e=>{i.value="",i.classList.toggle("text-Zero",!0),i.classList.toggle("text-Negative",!1),i.classList.toggle("text-Positive",!1),async function(){t.messageDiv.innerText=""}(),s()})),i.addEventListener("focusout",(e=>{t.setUIElements()})),i.addEventListener("change",(o=>{isNaN(parseFloat(i.value))&&(i.value="0");let s=parseFloat(i.value);if(n){if(s>e.currentPNL&&t.slCheckBox.checked)return i.blur(),void a("Stoploss should be less than current MTM","error");e.stoploss=s}else{if(s<e.currentPNL&&t.targetCheckBox.checked)return i.blur(),void a("Target should be greater than current MTM","error");e.target=s}i.blur(),t.setUIElements(),r()})),t.setUIElements()}async function r(){await Silva(),Palmer()}function s(){floatingSLMessageElement.style.setProperty("display","none")}groupTargetUISet.push(t),t.targetCheckBox.addEventListener("change",(async function(){if(s(),await delay(10),e.target<e.currentPNL&&t.targetCheckBox.checked)return t.targetCheckBox.checked=!1,void a("Target should be greater than current MTM","error");e.isTargetActive=t.targetCheckBox.checked,r()})),t.slCheckBox.addEventListener("change",(async function(){if(Burns(),await delay(10),e.stoploss>e.currentPNL&&t.slCheckBox.checked)return t.slCheckBox.checked=!1,void a("Stoploss should be less than current MTM","error");e.isStopLossActive=t.slCheckBox.checked,r()})),o(t.slElement,!0),o(t.targetElement,!1)}d()}if(!H){let X=R.querySelector(".groupMaxProfit"),Z=R.querySelector(".groupMaxLoss"),$=R.querySelector(".projectedHeader"),ee=R.querySelector(".groupProjected"),te=R.querySelector(".groupMetaSyntheticPrice"),ie=R.querySelector(".groupMetaStraddlePrice"),ae=R.querySelector(".groupMetaATMIVPrice"),ne=R.querySelector(".groupMetaDeltaPrice"),oe=R.querySelector(".groupMetaMarginUsed");async function f(){for(;isAppActive&&groupFunctionStatus[i];){let e=!0;for(let t=0;t<I.length;t++){const i=I[t];if(null==i.targetInst||null==i.targetInst.exchange){e=!1;break}}if(e){if(isGroupMarginFeature){let e=[];for(let t=0;t<I.length;t++){const i=I[t];0!=i.quantity&&e.push({exchange:i.targetInst.exchange,order_type:"MARKET",price:i.averagePrice,product:i.product,quantity:Math.abs(i.quantity),tradingsymbol:i.targetInst.tradingsymbol,transaction_type:i.quantity<0?"SELL":"BUY",variety:"regular"})}let t=await Hoffman(JSON.stringify(e));-1!=t&&(oe.innerText=formatToCompactNumber(t.final.total.toFixed(0)))}break}await delay(50)}}async function p(){for(;isAppActive&&groupFunctionStatus[i]&&null==B.value;)await delay(50);if(""==B.value)return _=!1,void c();for(Burton(T,B.value),await delay(50);isAppActive&&groupFunctionStatus[i];){let e=await Fuller(T,B.value);if(-1!=e&&-1!=e.price){let t=-1==e.straddlePrice?"N/A":e.straddlePrice.toFixed(2),i=e.price.toFixed(2);ae.innerText=-1==e.atmIV?"N/A":e.atmIV.toFixed(2),te.innerText=-1==e.price?"N/A":i,ie.innerText=t;let a=0;for(let t=0;t<I.length;t++){const i=I[t];let n=e.price,o=parseFloat(i.strikeNumber),r=e.yearDiff,s=.07365;if(1==i.callPutType||2==i.callPutType){let e=Bishop(1==i.callPutType,n,o,r,s,i.ltp);null!=e&&(a+=e*i.quantity)}else a+=i.quantity}ne.innerText=a.toFixed(2)}await delay(1e3)}}Brewer(R),isProjectProfitFeature&&_&&(p(),f()),isProjectProfitFeature||($.style.display="none",ee.style.display="none");let re=0,se=0,le=[];le.push({sampleStrike:0,targetProfit:0}),I.forEach((e=>{0!=e.quantity&&(1==e.callPutType?re+=e.quantity:2==e.callPutType?se+=e.quantity:3!=e.callPutType&&4!=e.callPutType||(re+=e.quantity,se-=e.quantity),le.push({sampleStrike:e.strikeNumber,targetProfit:0}))})),le.forEach((e=>{let t=0;I.forEach((i=>{let a=i.callPutType,n=i.quantity,o=-1==i.quantityMultiplier?0:i.quantityMultiplier,r=i.averagePrice,s=i.ltp,l=i.pnl-(s-r)*n*o;t+=0==n?l:l+1*o*n*GetStrikeProfitY(e.sampleStrike,i.strikeNumber,a,r)})),e.targetProfit=t}));const ce=le.reduce(((e,t)=>e.targetProfit>t.targetProfit?e:t)),ue=le.reduce(((e,t)=>e.targetProfit<t.targetProfit?e:t));let de="",fe="";if(X.innerText=rupeeZeroDecimalFormatter.format(ce.targetProfit),Z.innerText=rupeeZeroDecimalFormatter.format(ue.targetProfit),X.classList.toggle("text-Positive",ce.targetProfit>=0||re>0),X.classList.toggle("text-Negative",ce.targetProfit<0&&re<=0),Z.classList.toggle("text-Positive",ue.targetProfit>=0&&re>=0),Z.classList.toggle("text-Negative",ue.targetProfit<0||re<0),re<0?(Z.innerText="Unlimited",fe="<span class='text-Negative'>Unlimited  loss at the upside</span>"):fe="Max loss if <span class='toolTipSpan'>"+T+"</span> expires at level of <span class='toolTipSpan'>"+ue.sampleStrike+"</span> .",re>0?(X.innerText="Unlimited",de="<span class='text-Positive'>Unlimited profit at the upside</span>"):de="Max profit if <span class='toolTipSpan'>"+T+"</span> expires at level of <span class='toolTipSpan'>"+ce.sampleStrike+"</span> .",Holland(R,".ktMaxProfit",de),Holland(R,".ktMaxLoss",fe),isPayOffDisabled&&(R.querySelector(".payoffButton").style.display="none"),!isPayOffDisabled){let pe,me,ye,ge,Se=R.querySelector(".payoffChart"),he=R.querySelector(".payoffButton"),we={foIndexName:T};if(he=cloneRemoveEventListeners(he),he.addEventListener("click",(function(){R.classList.contains("hiddenChart")?g(!0):g(!1)})),G&&null!=E.payoffChartObject)me=E.payoffChartObject,ye=E.payOffAreaSeries,ge=E.volumeSeries,me.unsubscribeCrosshairMove(E.handler.crosshairMoveHandler),E.handler.toolTip.remove(),E.handler=Dunn(Se,me,ye,T),pe=Hart(T,D);else{let be=R.querySelector("#payoffZoomIn"),ke=R.querySelector("#payoffZoomOut");be.addEventListener("click",(function(){let e=me.timeScale().getVisibleRange(),t=e.from,i=e.to;me.timeScale().setVisibleRange({from:t+500,to:i-500})})),ke.addEventListener("click",(function(){let e=me.timeScale().getVisibleRange(),t=e.from,i=e.to;me.timeScale().setVisibleRange({from:t-500,to:i+500})})),me=LightweightCharts.createChart(Se,Kelly()),ye=me.addBaselineSeries(Howard()),ge=me.addHistogramSeries({priceFormat:{type:"volume"},lastValueVisible:!1,crosshairMarkerVisible:!1,axisLabelVisible:!1,priceLineVisible:!1,priceScaleId:""}),ge.priceScale().applyOptions({scaleMargins:{top:0,bottom:0}}),pe=Hart(T,D);let Me=Dunn(Se,me,ye,T);isCacheRowFeature&&(W.payoffChartObject=me,W.payOffAreaSeries=ye,W.volumeSeries=ge,W.instToken=pe,W.indexInfo=we,W.handler=Me)}async function m(){let e=[],t=I.reduce(((e,t)=>e.strikeNumber>t.strikeNumber?e:t)),i=I.reduce(((e,t)=>e.strikeNumber<t.strikeNumber?e:t)),a=t.strikeNumber+t.averagePrice,n=i.strikeNumber-i.averagePrice;middlePoint=(a+n)/2;let o=middlePoint-.03*middlePoint,r=middlePoint+.03*middlePoint;o*=.95,r*=1.05;let s=!1,l=I.filter((function(e){return 3==e.callPutType||4==e.callPutType}));s=l.length>0,s&&(middlePoint=l[0].ltp,o=.9*middlePoint,r=1.1*middlePoint);let c=await Davidson(pe);-1==c||s||(middlePoint=c,o=Math.min(.95*c,.97*n),r=Math.max(1.05*c,1.03*a));let u=.0012*middlePoint,d=(r-o)/u;if(u=findClosest(indexPriceSnapArray,u),o=u*Math.ceil(o/u),r=u*Math.ceil(r/u),d>350){let e=middlePoint-o,t=r-middlePoint,i=350/d;o=middlePoint-e*i,r=middlePoint+t*i,o=u*Math.ceil(o/u),r=u*Math.ceil(r/u)}let f=o;for(;f<r;){let t=0;I.forEach((e=>{t+=y(e,f)})),e.push({time:f,value:Math.round(t)}),f+=u}ye.setData(e),me.timeScale().fitContent()}function y(e,t){let i=0,a=e.callPutType,n=e.quantity,o=e.quantityMultiplier,r=e.averagePrice,s=e.ltp,l=e.pnl-(s-r)*n*o;return i=0==e.quantity?l:l+o*n*GetStrikeProfitY(t,e.strikeNumber,a,r),i}function g(e){e&&R.classList.contains("hiddenChart")?(payOffGraphStatus.add(x),R.classList.remove("hiddenChart"),m()):R.classList.contains("hiddenChart")||(payOffGraphStatus.delete(x),R.classList.add("hiddenChart"))}async function S(){let e=await Schultz(pe);for(;isAppActive&&groupFunctionStatus[i];){let t=-1,i=await Fuller(T,void 0),a=Fowler(e);if(-1!=i&&-1!=i.price?t=i.price:-1!=a&&-1!=a.last_price&&(t=a.last_price),-1!=t){let e=[];e.push({time:t,value:5e4,color:"#3b6feb"}),ge.setData(e);let i=0;I.forEach((e=>{i+=y(e,t)})),isProjectProfitFeature&&(l[F]=i,ee.innerText=rupeeZeroDecimalFormatter.format(i),ee.classList.toggle("text-Positive",i>0),ee.classList.toggle("text-Negative",i<0),null!=A&&(A.content="Projected profit if <span class='toolTipSpan'>"+T+"</span> expires at current level of <span class='toolTipSpan'>"+t+"</span> ."),h())}await delay(1500)}}new ResizeObserver((e=>{me.timeScale().fitContent()})).observe(Se),me.timeScale().fitContent(),S()}}}function h(){currentTotalProjected=0;for(let e=0;e<l.length;e++){let t=l[e];currentTotalProjected+=t}}Grant(),tbodyObserver=new MutationObserver((e=>function(e){isLightGroupCreation?(Dominguez("new child added by count Element"),Snyder(isAPIMode)):e.forEach((e=>{if(e.addedNodes.length>0)return Dominguez("new child added"),void Snyder(isAPIMode)}))}(e))),isLightGroupCreation?tbodyObserver.observe(positionCountElement,{subtree:!0,characterData:!0}):tbodyObserver.observe(t,{childList:!0})}async function Payne(){Snyder(!0),Dominguez("quantity change")}async function Grant(){if(isGroupSettingEnabled&&0!=activeGroups.length)for(let e=0;e<activeGroups.length;e++){const t=activeGroups[e],i=t.groupElements;let a=0;for(let e=0;e<i.length;e++)a+=parseFloat(i[e].pnlElement.innerText.replace(/,/g,""));let n=a.toLocaleString("en-IN",{maximumFractionDigits:2,minimumFractionDigits:2});a>0&&(n="+"+n),t.groupProfitElement.innerText=n,t.groupProfitElement.classList.toggle("text-Positive",a>=0),t.groupProfitElement.classList.toggle("text-Negative",a<0)}}function Dunn(e,t,i,a){let n=document.createElement("div");n.classList.add("payoffToolTipStyle"),e.appendChild(n);let o=payoffTooltipBlockHTML,r=0,s=a,l=function(t){if(Ramos(t))n.style.display="none";else{n.style.display="block";const a=t.seriesData.get(i);if(null==a)return;const l=void 0!==a.value?a.value:a.close;let c=rupeeZeroDecimalFormatter.format(l),u=o.replace("$instHeader",s);u=u.replace("$strikeLevel",t.time),u=u.replace("$profitAmount",c),l>=0&&1!=r?(n.classList.remove("negativeTooltip"),n.classList.add("positiveTooltip"),r=1):l<0&&-1!=r&&(n.classList.remove("positiveTooltip"),n.classList.add("negativeTooltip"),r=-1),n.innerHTML=u;const d=i.priceToCoordinate(l);let f=t.point.x-50;if(null===d)return;f=Math.max(0,Math.min(e.clientWidth-80,f));const p=Math.max(0,Math.min(e.clientHeight-80-15,d+15));n.style.left=f+"px",n.style.top=p+"px"}};return t.subscribeCrosshairMove(l),{crosshairMoveHandler:l,toolTip:n}}let kiteGroupList=[];function Kelley(e){let t=groupBy(e,"name"),i=Object.keys(t);for(let e=0;e<i.length;e++){const a=t[i[e]];a.sort((function(e,t){return e.isOpen&&!t.isOpen?-1:!e.isOpen&&t.isOpen||e.instFullName>t.instFullName?1:-1}));for(let e=0;e<a.length;e++)positionTableBody.appendChild(a[e].row)}for(let e=0;e<i.length;e++){let a=i[e];a.split(/(\s+)/)[0],t[a][0].id;let n=!1;projectedGroupWise.push(0),payOffGraphStatus.has(a)&&(n=!0)}}let tickSocket,foInstruments=[],freezeMapping=[],underlyingMapping=[],foKeys=[],eqFOKeys=[],equityInstruments=[],commoditySymbols=[],commodityMultiplierMapping=[],instLoaded=!1;async function Spencer(){commodityMultiplierMapping=await Ross("commodityMultiplierMappingKey",commodityMultiplierMapping);let e=await fetch(chrome.runtime.getURL("Blocks/JsonData/underlying_mapping.json"));underlyingMapping=await e.json(),Arnold();let t=[],i=0,a=!1,n=await fetch(chrome.runtime.getURL("Blocks/JsonData/equityList.txt")),o=await n.text(),r=o.split("\n"),s=r[0].split(",");for(let e=1;e<r.length;e++){if(0===r[e].trim().length)continue;let t={},i=r[e].split(",");for(let e=0;e<i.length;e++)4!=e&&7!=e&&(t[s[e].trim()]=i[e].trim());equityInstruments.push(t)}n=await fetch(chrome.runtime.getURL("Blocks/JsonData/commodity.txt")),o=await n.text(),r=o.split("\n"),s=r[0].split(",");for(let e=1;e<r.length;e++){if(0===r[e].trim().length)continue;let t={},i=r[e].split(",");for(let e=0;e<i.length;e++)t[s[e].trim()]=i[e].trim();commoditySymbols.push(t)}{let e=(new Date).getTime(),n=await fetchSyncStorage("lastInstLoadTime");if(null!=n&&null!=n){i=(e-new Date(n))/36e5;let o=await fetchSyncStorage("foInstruments");null!=o&&i<48?(t=o,a=!0,l()):i=0}}if(i>12||!a){await setSyncStorage("isInstLoading",!0);let e=await querySelectWait(document,".app"),i=document.createElement("div");i.id="tradeDiv",e.appendChild(i),i.innerHTML=kiteTradeFrame;let a=!0;for(;isAppActive&&a;)a=await fetchSyncStorage("isInstLoading"),await delay(15);let n=await fetchSyncStorage("foInstruments");null!=n&&(currentTime=(new Date).getTime(),await setSyncStorage("lastInstLoadTime",currentTime),t=n),l(),i.remove()}function l(){instLoaded=!0,foInstruments=groupBy(t,"name"),foKeys=Object.keys(foInstruments);let e=t.filter((e=>"MCX"!=e.exchange));eqFOKeys=Object.keys(groupBy(e,"name")),e=[]}}async function Arnold(){let e=await fetch(chrome.runtime.getURL("Blocks/JsonData/FreezeOutput.json"));freezeMapping=await e.json(),freezeMapping=await Ross("freezeQuantityJson",freezeMapping);let t=!0,i=(new Date).getTime(),a=await fetchSyncStorage("lastFreezeQuantityLoadTime");if(null!=a&&null!=a&&(i-new Date(a))/36e5<6&&(t=!1),t=!0,t){let e=await fetch("https://kiteplus.radiuscraft.com/wp-content/uploads/freezeOutput.json");if(e.ok){let t=await e.json();null!=t&&(await setSyncStorage("freezeQuantityJson",t),freezeMapping=await Ross("freezeQuantityJson",t),i=(new Date).getTime(),await setSyncStorage("lastFreezeQuantityLoadTime",i))}}}async function Pierce(){for(;!instLoaded;)await delay(10);return!0}function Vazquez(e,t,i){if("NFO"==t||"BFO"==t||"MCX"==t)if(null!=i){if(i in foInstruments){let t=foInstruments[i];for(let i=0;i<t.length;i++){const a=t[i];if(a.instrument_token==e)return a}}}else for(let t=0;t<foKeys.length;t++){let i=foInstruments[foKeys[t]];for(let t=0;t<i.length;t++){const a=i[t];if(a.instrument_token==e)return a}}for(let t=0;t<equityInstruments.length;t++){const i=equityInstruments[t];if(i.instrument_token==e)return i}}async function Hansen(e,t,i){let a=Duncan(e),n=null==i?a[0]:i,o=Andrews(e,n);o=o.filter((e=>"FUT"!=e.instrument_type)),o=o.sort(((e,t)=>parseFloat(e.strike)>parseFloat(t.strike)?1:-1));let r=o.filter((e=>"CE"==e.instrument_type)),s=o.filter((e=>"PE"==e.instrument_type)),l=r.map((e=>e.strike)),c=s.map((e=>e.strike));if(0==l.length)return;let u=l.reduce(((e,i)=>Math.abs(i-t)<Math.abs(e-t)?i:e)),d=c.reduce(((e,i)=>Math.abs(i-t)<Math.abs(e-t)?i:e)),f=r[l.indexOf(u)];return{expiry:n,PE:s[c.indexOf(d)],CE:f}}async function Peters(e,t,i){let a=Andrews(e,i);return a=a.filter((e=>"FUT"!=e.instrument_type)),a=a.sort(((e,t)=>parseFloat(e.strike)>parseFloat(t.strike)?1:-1)),{PE:a.filter((e=>"CE"==e.instrument_type)),CE:a.filter((e=>"PE"==e.instrument_type))}}function Santos(e){let t="",i="",a="",n=JSON.parse(e.name);if(e.expiry&&"FUT"!==e.instrument_type){const o=new Date(e.expiry);i=o.getDate()+ordinal_suffix_of(o.getDate()),a=o.toLocaleString("en-US",{month:"short"}).toUpperCase(),t+=`${n} ${i} ${a} ${Math.trunc(e.strike)} ${e.instrument_type}`}else"FUT"===e.instrument_type?t+=`${n} ${new Date(e.expiry).toLocaleString("en-US",{month:"short"}).toUpperCase()} FUT`:t+=e.tradingsymbol;return t}function Hart(e,t){let i=underlyingMapping.find((t=>t.FoName==e));return null!=i?i.InstrumentToken:"MCX"!=t&&(i=equityInstruments.find((t=>t.tradingsymbol==e)),null!=i)?JSON.parse(i.instrument_token):(i=Cunningham(JSON.stringify(e)),null!=i?JSON.parse(i.instrument_token):void 0)}function Bradley(e){let t=freezeMapping.find((t=>t.Name==e));if(null!=t)return t.FreezeQuantity}function Knight(e){let t=underlyingMapping.find((t=>t.Name==e));return null!=t?t.FoName:e}function Elliott(e){let t=e.toUpperCase();return foInstruments.hasOwnProperty(t)}function Cunningham(e){let t=e.toUpperCase(),i=foInstruments[t];if(null==i)return;let a=i.filter((e=>"FUT"==e.instrument_type));return a=a.sort(((e,t)=>e.expiry>t.expiry)),a.length>0?a[0]:void 0}function Duncan(e){let t=e.toUpperCase(),i=[];if(t in foInstruments){let e=foInstruments[t],a=groupBy(e,"expiry");i=Object.keys(a),i=i.sort()}let a=getISTTimeStamp();return i=i.filter((e=>!((new Date(e).getTime()-a)/36e5<-27))),i}async function Armstrong(e,t){for(let i=0;i<commodityMultiplierMapping.length;i++){const a=commodityMultiplierMapping[i];if(a.name==e)return void(a.multiplier!=t&&(a.multiplier=t,await setSyncStorage("commodityMultiplierMappingKey",commodityMultiplierMapping)))}commodityMultiplierMapping.push({name:e,multiplier:t}),await setSyncStorage("commodityMultiplierMappingKey",commodityMultiplierMapping)}function Hudson(e){for(let t=0;t<commodityMultiplierMapping.length;t++){const i=commodityMultiplierMapping[t];if(i.name==e)return i.multiplier}return-1}function Carroll(e){if(!isJsonString(e))return 1;let t=JSON.parse(e),i=commoditySymbols.filter((e=>e.symbol==t));return i.length>0?i[0].multiplier:1}function Lane(e){for(let t=0;t<targetInstruments.length;t++){const i=targetInstruments[t];if(i.instrument_token==e)return i}}function Riley(e,t){let i=e.toUpperCase(),a=[],n=new Date(t);if(i in foInstruments){let e=foInstruments[i];for(let t=0;t<e.length;t++){const i=e[t];let o=new Date(i.expiry);n.getMonth()==o.getMonth()&&a.push(i)}}return a}function Andrews(e,t){let i=e.toUpperCase(),a=[];if(i in foInstruments){let e=foInstruments[i];a=groupBy(e,"expiry")[t]}return a}async function Alvarado(){for(;isAppActive&&null===Santiago();)await delay(20);await delay(50),Spencer(),Pena(),Matthews(),Ortega(),document.addEventListener("kc_OrderUpdate",(function(e){})),document.addEventListener("kc_OrderSetUpdate",(function(e){Matthews(),isLightGroupCreation||Snyder(!1)}))}async function Ray(){for(;;)await delay(1e3)}async function Delgado(){let e=await Maldonado(kc_root+kc_userMargins,"GET","");if(-1==e)return-1;if(e.ok){const t=await e.json();let i=t.data.equity,a=i.utilised.exposure+i.utilised.span+i.utilised.option_premium,n=t.data.commodity,o=n.utilised.exposure+n.utilised.span+n.utilised.option_premium;return{eq_AvailMargin:i.net,eq_UserMargin:a,eq_AvailCash:i.available.live_balance,co_AvailMargin:n.net,co_UserMargin:o,co_AvailCash:n.available.live_balance}}return-1}async function Berry(e,t){let i={};for(let t=0;t<e.length;t++){const a=e[t];i[a.exchange+":"+a.instrument_token]=t+2}let a=new URLSearchParams(i);var n=kc_marketWatchFull+"/"+t+"/items";let o=localStorage.getItem("__storejs_kite_public_token").slice(1,-1);return(await fetch(n,{headers:{accept:"application/json, text/plain, */*","x-csrftoken":o},method:"PUT",body:a})).ok?1:-1}async function Perkins(){let e=localStorage.getItem("__storejs_kite_public_token").slice(1,-1),t=await fetch(kc_marketWatchFull,{headers:{accept:"application/json, text/plain, */*","x-csrftoken":e,"x-kite-Userid":uID},method:"GET"});return t.ok?(await t.json()).data:-1}async function Hoffman(e){await delay(10);let t=await Maldonado(kc_root+kc_basketMarginConsiderPosition,"POST",e);return-1==t?-1:t.ok?(await t.json()).data:-1}async function Johnston(e){let t=[];for(let i=0;i<e.length;i++){const a=e[i];t.push({context:"order_window.PLACE",exchange:a.inst.exchange,order_type:a.orderType,price:a.ltp,product:"NRML",quantity:Math.abs(a.quantity),tradingsymbol:a.inst.tradingsymbol,transaction_type:a.isSell?"SELL":"BUY",variety:"regular"})}let i=await Maldonado(kc_root+kc_nudgeOrder,"POST",JSON.stringify(t));return-1==i?-1:i.ok?(await i.json()).data:-1}async function Matthews(){await delay(10),isFreshPositionLoaded=!1;let e=await Maldonado(kc_root+kc_positions,"GET","");if(-1==e||!e.ok)return await delay(3e3),void Matthews();if(e.ok){isFreshPositionLoaded=!0;const t=await e.json();let i=t.data.net;return Williamson(t.data),i}}let isSocketOpen=!1,lastMessageTime=0,tokenSet_PendingUnSub=[],tokenSet_Global=[],tokenSet_Positions=[],tokenSet_Baskets=[],tokenSet_IndexMeta=[];async function Pena(){await delay(10);let e=5,t="user_id="+uID,i="enctoken="+encodeURIComponent(localStorage.getItem("__storejs_kite_enctoken").slice(1,-1)),a="uid=1721233381501";if(uID.length>0){let e="";for(var n=0;n<uID.length;n++)e+=uID.charCodeAt(n);e="172"+e.substring(0,10),a="uid="+e}let o="api_key=kitefront&"+t+"&"+i+"&"+a+"&user-agent=kite3-web&version=3.0.0";lastMessageTime=Math.floor(Date.now()/1e3);let r="wss://ws.zerodha.com/?"+o;async function s(){await delay(20),isAppActive&&(null!=tickSocket&&tickSocket.close(),tickSocket=new WebSocket(r),tickSocket.binaryType="arraybuffer",tickSocket.onclose=async function(e){await delay(200)},tickSocket.onopen=async function(t){isSocketOpen=!0,e=4,Dominguez("new socket"),tokenSet_PendingUnSub=[];let i=[],a=[],n=[];tokenSet_Baskets.length>0&&(i=JSON.parse(JSON.stringify(tokenSet_Baskets))),tokenSet_Positions.length>0&&(a=JSON.parse(JSON.stringify(tokenSet_Positions))),tokenSet_IndexMeta.length>0&&(n=JSON.parse(JSON.stringify(tokenSet_IndexMeta))),tokenSet_Baskets=[],tokenSet_Positions=[],tokenSet_IndexMeta=[],i.length>0&&Chapman(i),await delay(50),a.length>0&&(Guerrero(a),Harper()),await delay(50),n.length>0&&George(n),await delay(50)},tickSocket.onerror=function(e){this&&this.readyState==this.OPEN&&this.close()},tickSocket.onmessage=async function(e){if(lastMessageTime=Math.floor(Date.now()/1e3),isAbv(e.data)){if(e.data.byteLength>2){let t=Morrison(e.data);if(t)for(let e=0;e<t.length;e++)Padilla(t[e])}}else{let t=Carlson(e.data);if(null==t)return;if("order"===t.type){Larson(e.data.message);let t=JSON.parse(e.data);"OPEN"!=t.status&&"CANCELLED"!=t.status&&Harper(),"TRIGGER_PENDING"==t.status&&Reynolds(),Burke()}}})}Willis((async e=>{await delay(100);let t=[];for(let e=0;e<Math.min(underlyingMapping.length,mainUnderlyingCount);e++)t.push(underlyingMapping[e].InstrumentToken);Guerrero(t)})),await s(),window.onpagehide=e=>{e.persisted||tickSocket.readyState==WebSocket.OPEN&&tickSocket.close()},async function(){for(;isAppActive;){let t=Math.floor(Date.now()/1e3);t>lastMessageTime+e&&(e=3,isSocketOpen=!1,Dominguez("disconnected Socket"),tickSocket.close(),s(),lastMessageTime=t),await delay(750)}}(),await delay(2e3)}async function Willis(e){for(;!isSocketOpen;)await delay(50);e(!0)}function Carpenter(){let e=[...tokenSet_Positions,...tokenSet_Baskets,...tokenSet_IndexMeta];tokenSet_Global=[...new Set(e)],Welch()}function Lawrence(){return null!=tickSocket&&null!=tickSocket&&tickSocket.readyState==WebSocket.OPEN}function Sandoval(e,t){if(!isReal)for(let t=0;t<e.length;t++)Vazquez(e[t],"",null)}function Guerrero(e){if(!Lawrence())return;let t=(e=[...new Set(e)]).filter((e=>!tokenSet_Positions.includes(e)));tokenSet_Positions.push(...t);let i=t,a=e.filter((e=>!i.includes(e))),n=[];for(let e=0;e<a.length;e++)Day(a[e])||n.push(a[e]);n.length>0&&i.push(...n),Carpenter(),0!=i.length&&(Greene(i,modeFull),Walsh(i),Sandoval(i,!0))}function George(e){if(!Lawrence())return;let t=(e=[...new Set(e)]).filter((e=>!tokenSet_IndexMeta.includes(e)));tokenSet_IndexMeta.push(...t);let i=t.filter((e=>!tokenSet_Baskets.includes(e)));i=i.filter((e=>!tokenSet_Positions.includes(e)));let a=e.filter((e=>!i.includes(e))),n=[];for(let e=0;e<a.length;e++)Day(a[e])||n.push(a[e]);n.length>0&&i.push(...n),Carpenter(),0!=i.length&&(Greene(i,modeFull),Walsh(i),Sandoval(i,!0))}function Chapman(e){if(!Lawrence())return;let t=(e=[...new Set(e)]).filter((e=>!tokenSet_Baskets.includes(e)));tokenSet_Baskets.push(...t);let i=t.filter((e=>!tokenSet_IndexMeta.includes(e)));i=i.filter((e=>!tokenSet_Positions.includes(e)));let a=e.filter((e=>!i.includes(e))),n=[];for(let e=0;e<a.length;e++)Day(a[e])||n.push(a[e]);n.length>0&&i.push(...n),Carpenter(),0!=i.length&&(Greene(i,modeFull),Walsh(i),Sandoval(i,!0))}function Rios(e){if(!Lawrence())return;null==e&&(e=tokenSet_IndexMeta);let t=(e=[...new Set(e)]).filter((e=>!tokenSet_Positions.includes(e)));t=t.filter((e=>!tokenSet_Baskets.includes(e))),tokenSet_PendingUnSub=[...tokenSet_PendingUnSub,...t],tokenSet_IndexMeta=tokenSet_IndexMeta.filter((t=>!e.includes(t)))}function Estrada(){if(!Lawrence())return;targetTokens=tokenSet_Baskets;let e=targetTokens.filter((e=>!tokenSet_Positions.includes(e)));e=e.filter((e=>!tokenSet_IndexMeta.includes(e))),tokenSet_PendingUnSub=[...tokenSet_PendingUnSub,...e],tokenSet_Baskets=tokenSet_Baskets.filter((e=>!targetTokens.includes(e)))}async function Ortega(){for(;isAppActive;){if(Lawrence()){let e=[...tokenSet_Positions,...tokenSet_Baskets,...tokenSet_IndexMeta],t=tokenSet_PendingUnSub.filter((t=>!e.includes(t))),i=[...new Set(t)];t.length>0&&(Nunez(i),Bowman(i),Sandoval(i,!1),Carpenter()),tokenSet_PendingUnSub=[]}await delay(5e3)}}function Greene(e,t){let i={a:mSubscribe,v:e};tickSocket.send(JSON.stringify(i)),i={a:"mode",v:[t,e]},tickSocket.send(JSON.stringify(i))}function Nunez(e){if(!isSocketOpen)return-1;if(0==e.length)return;let t={a:mUnSubscribe,v:e};tickSocket.send(JSON.stringify(t))}async function Wheeler(e){let t=new URLSearchParams(e);return await Maldonado(kc_root+kc_placeOrder,"POST",t)}async function Valdez(e){let t=new URLSearchParams(e);return await Maldonado(kc_root+kc_placeOrderIceberg,"POST",t)}const kc_root="https://kite.zerodha.com/oms",kc_userMargins="/user/margins",kc_positions="/portfolio/positions",kc_marketWatchFull="https://kite.zerodha.com/api/marketwatch",kc_placeOrder="/orders/regular",kc_placeOrderIceberg="/orders/iceberg",kc_basketMarginConsiderPosition="/margins/basket?consider_positions=true&mode=compact",kc_basketMArgin="/margins/basket",kc_nudgeOrder="/nudge/orders",marginSetUpdate=new Event("kc_MarginSetUpdate"),orderSetUpdateEvent=new Event("kc_OrderSetUpdate"),orderUpdateEvent=new CustomEvent("kc_OrderUpdate",{detail:{data:""}}),riskFreeInterest=0,kiteEquityCashFreezeLimit=1e5,mainUnderlyingCount=3,kitePlusFOExchanges=["NFO","BFO","MCX"],kitePlusExchanges=["NSE","BSE","NFO","BFO","MCX"],defaultSearchInstruments=["NIFTY","BANKNIFTY","SENSEX"],enumNFO="NFO",enumBFO="BFO",enumNSE="NSE",modeFull="full",modeQuote="quote",modeLTP="ltp",mSubscribe="subscribe",mUnSubscribe="unsubscribe",mSetMode="mode",monthConst=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],NseCM=1,NseFO=2,NseCD=3,BseCM=4,BseFO=5,BseCD=6,McxFO=7,McxSX=8,Indices=9;let keyToken="",uID="",isOrderSetUpdating=!1,orderSetBufferCounter=0,marginSetBufferCounter=0,totalCounter=0;async function Harper(){totalCounter++,0==orderSetBufferCounter&&(document.dispatchEvent(orderSetUpdateEvent),Dominguez("updating order Set Zero")),orderSetBufferCounter++,await delay(1e3),orderSetBufferCounter--,1==orderSetBufferCounter&&(document.dispatchEvent(orderSetUpdateEvent),Dominguez("updating order Set Zero"))}async function Burke(){marginSetBufferCounter++,await delay(1e3),marginSetBufferCounter--,0==marginSetBufferCounter&&document.dispatchEvent(marginSetUpdate)}async function Larson(e){orderUpdateEvent.detail.message="new order",document.dispatchEvent(orderUpdateEvent)}function Santiago(){let e=localStorage.getItem("__storejs_kite_enctoken").slice(1,-1);if(null===e)return null;keyToken="enctoken "+e,e=localStorage.getItem("__storejs_kite_user/user_id").slice(1,-1),null!=e&&(uID=e)}async function Maldonado(e,t,i){let a,n={},o=!1;return n.headers={accept:"application/json, text/plain, */*",authorization:keyToken},n.method=t,"POST"==t&&(n.body=i),await fetch(e,n).then((e=>{a=e})).catch((e=>{o=!0})),o?-1:a}function Morrison(e){const t=Franklin(e),i=[];for(let e=0;e<t.length;e++){const a=t[e],n=buf2long(a.slice(0,4)),o=255&n;let r=!0;o===Indices&&(r=!1);let s=100;if(o===NseCD?s=1e7:o==BseCD&&(s=1e4),8===a.byteLength)i.push({tradable:r,mode:modeLTP,instrument_token:n,last_price:buf2long(a.slice(4,8))/s});else if(28===a.byteLength||32===a.byteLength){let e=modeQuote;32===a.byteLength&&(e=modeFull);const t={tradable:r,mode:e,instrument_token:n,last_price:buf2long(a.slice(4,8))/s,ohlc:{high:buf2long(a.slice(8,12))/s,low:buf2long(a.slice(12,16))/s,open:buf2long(a.slice(16,20))/s,close:buf2long(a.slice(20,24))/s},change:buf2long(a.slice(24,28))};if(0!=t.ohlc.close&&(t.change=100*(t.last_price-t.ohlc.close)/t.ohlc.close),32===a.byteLength){t.exchange_timestamp=null;const e=buf2long(a.slice(28,32));e&&(t.exchange_timestamp=new Date(1e3*e))}i.push(t)}else if(44===a.byteLength||184===a.byteLength){let e=modeQuote;184===a.byteLength&&(e=modeFull);const t={tradable:r,mode:e,instrument_token:n,last_price:buf2long(a.slice(4,8))/s,last_traded_quantity:buf2long(a.slice(8,12)),average_traded_price:buf2long(a.slice(12,16))/s,volume_traded:buf2long(a.slice(16,20)),total_buy_quantity:buf2long(a.slice(20,24)),total_sell_quantity:buf2long(a.slice(24,28)),ohlc:{open:buf2long(a.slice(28,32))/s,high:buf2long(a.slice(32,36))/s,low:buf2long(a.slice(36,40))/s,close:buf2long(a.slice(40,44))/s},change:0};if(0!=t.ohlc.close&&(t.change=100*(t.last_price-t.ohlc.close)/t.ohlc.close),184===a.byteLength){t.last_trade_time=null;const e=buf2long(a.slice(44,48));e&&(t.last_trade_time=new Date(1e3*e)),t.exchange_timestamp=null;const i=buf2long(a.slice(60,64));i&&(t.exchange_timestamp=new Date(1e3*i)),t.oi=buf2long(a.slice(48,52)),t.oi_day_high=buf2long(a.slice(52,56)),t.oi_day_low=buf2long(a.slice(56,60)),t.depth={buy:[],sell:[]};let n=0,o=a.slice(64,184);for(let e=0;e<10;e++)n=12*e,t.depth[e<5?"buy":"sell"].push({quantity:buf2long(o.slice(n,n+4)),price:buf2long(o.slice(n+4,n+8))/s,orders:buf2long(o.slice(n+8,n+10))})}i.push(t)}}return i}function buf2long(e){let t=new Uint8Array(e),i=0,a=t.length;for(let e=0,n=a-1;e<a;e++,n--)i+=t[n]<<8*e;return i}function Franklin(e){let t=buf2long(e.slice(0,2)),i=2,a=[];for(let n=0;n<t;n++){const t=buf2long(e.slice(i,i+2)),n=e.slice(i+2,i+2+t);a.push(n),i+=2+t}return a}function Carlson(e){try{e=JSON.parse(e)}catch(e){return null}return e}let logMessageData=[],lastLogCleanTimeStamp=0,isLogEnabled=!1;async function Austin(){isLogEnabled=await Ross("prefLogMessageKey",isLogEnabled),logMessageData=await Ross("logMessageDataKey",logMessageData),lastLogCleanTimeStamp=await Ross("lastLogCleanTimeStampKey",lastLogCleanTimeStamp);let e=getISTTimeStamp();if(e>lastLogCleanTimeStamp+864e5){lastLogCleanTimeStamp=e;let t=new Date(e);t.setUTCHours(8,15,0),lastLogCleanTimeStamp=t.getTime(),await setSyncStorage("lastLogCleanTimeStampKey",lastLogCleanTimeStamp),logMessageData=[],await setSyncStorage("logMessageDataKey",logMessageData)}}async function Dominguez(e){if(!isLogEnabled)return;let t=getTimeForLog(new Date)+","+instanceCounter+","+e;logMessageData.push(t),await setSyncStorage("logMessageDataKey",logMessageData)}function Carr(e,t,i,a,n){var o=(Math.log(e/t)+(a+Math.pow(n,2)/2)*i)/(n*Math.sqrt(i)),r=o-n*Math.sqrt(i);return t*Math.exp(-a*i)*Jacobs(-r)-e*Jacobs(-o)}function Lawson(e,t,i,a,n){var o=(Math.log(e/t)+(a+Math.pow(n,2)/2)*i)/(n*Math.sqrt(i)),r=o-n*Math.sqrt(i);return e*Jacobs(o)-t*Math.exp(-a*i)*Jacobs(r)}function Jacobs(e){return(1+Obrien(e/Math.sqrt(2)))/2}function Obrien(e){var t=e>=0?1:-1,i=1/(1+.3275911*(e=Math.abs(e)));return t*(1-((((1.061405429*i-1.453152027)*i+1.421413741)*i-.284496736)*i+.254829592)*i*Math.exp(-e*e))}function d1(e,t,i,a,n){return(Math.log(e/t)+(a+.5*Math.pow(n,2))*i)/(n*Math.sqrt(i))}function Lynch(e,t,i,a,n){var o=(Math.log(e/t)+(a+Math.pow(n,2)/2)*i)/(n*Math.sqrt(i));return e*Math.sqrt(i)*Singh(o)}function Singh(e){return 1/Math.sqrt(2*Math.PI)*Math.exp(-.5*Math.pow(e,2))}let ivGuesses=[.2,.15,.1,.25,.3,.05,.35,.4,.4,.5,.6,.8];function Vega(e,t,i,a,n,o,r=1e-6,s=5e3){let l=.2,c=0;for(;c<ivGuesses.length;){c++,l=ivGuesses[c-1];for(var u=0;u<s;u++){var d=(e?Lawson(t,i,a,n,l):Carr(t,i,a,n,l))-o;if(Math.abs(d)<r)return l;var f=Lynch(t,i,a,n,l);if(0===f)break;l-=d/f}}return l}function Bishop(e,t,i,a,n,o,r=1e-6,s=100){let l=Vega(e,t,i,a,n,o);if(Math.abs(l)>100)return;let c=e?Montgomery(t,i,a,n,l):Oliver(t,i,a,n,l);return c=mathClamp(c,-.99,.99),isNaN(c)?void 0:c}function Montgomery(e,t,i,a,n){return Jacobs(d1(e,t,i,a,n))}function Oliver(e,t,i,a,n){return Jacobs(d1(e,t,i,a,n))-1}let plWarningElement,currentTokens=[],pnlFunctionStatus=[],pnlCallCounter=0,daysOrderCount=0,activePositions=[],activeGroupWise=[],activeGroupExpiryWise=[],groupWiseNudge=[],isPositionCorrupt=!1,isFreshPositionLoaded=!1,isPositionTickerIssue=!1,isGroupCalProfitActive=!1;async function Jensen(){plWarningElement=document.querySelector("#plWarningElement"),Espinoza(),document.addEventListener("keydown",(function(e){if(e.altKey&&"j"===e.key){isGroupCalProfitActive=!isGroupCalProfitActive;let e=document.querySelector(".open-positions");null!=e&&e.classList.toggle("calActive",isGroupCalProfitActive)}}))}async function Harvey(e){null!=plWarningElement&&plWarningElement.classList.toggle("displayHidden",!e)}async function Williamson(e){await Pierce(),pnlFunctionStatus=pnlFunctionStatus.map((e=>!1)),pnlFunctionStatus.push(!0),pnlCallCounter++;let t=pnlCallCounter-1,i=e.net,a=e.day;daysOrderCount=a.length;let n=[];for(let e=0;e<i.length;e++){let t,a=i[e].instrument_token,o=i[e];kitePlusExchanges.includes(o.exchange)||0==o.quantity||(isPositionCorrupt=!0);let r=activePositions.findIndex((e=>e.instrument_token===a&&e.product==o.product));-1!=r?activePositions[r].quantity!=i[e].quantity&&(t=null!=activePositions[r].inst?activePositions[r].inst:Vazquez(a,o.exchange),activePositions[r]=Dean(i[e],t)):(t=Vazquez(a,o.exchange),activePositions.push(Dean(i[e],t)),currentTokens.includes(a)||(currentTokens.push(a),n.push(a)))}let o=groupBy(activePositions,"foName"),r=Object.keys(o);activeGroupWise=[],groupWiseNudge=[],activeGroupExpiryWise=[];let s=[];for(let e=0;e<r.length;e++){if("undefined"==r[e]||null==r[e])continue;let t=Hart(JSON.parse(r[e]));null!=t&&s.push(t),activeGroupWise.push({name:r[e],positions:o[r[e]],profit:0})}for(let e=0;e<activeGroupWise.length;e++){const t=activeGroupWise[e];t.positions.every((({expiry:e})=>e===t.positions[0].expiry))&&(t.expiry=void 0,null!=t.positions[0].inst&&(t.expiry=t.positions[0].inst.expiry))}Willis((e=>{Guerrero(s)}));for(let e=0;e<r.length;e++){let t=groupBy(o[r[e]],"expiry"),i=Object.keys(t);for(let a=0;a<i.length;a++)activeGroupExpiryWise.push({name:r[e],expiry:i[a],positions:t[i[a]],profit:0})}for(n.length>0&&Willis((e=>{Guerrero(n)})),isGroupStopLossFeature&&async function(){for(let e=0;e<activeGroupWise.length;e++){let t=[];for(let i=0;i<activeGroupWise[e].positions.length;i++){const a=activeGroupWise[e].positions[i];t.push({inst:a.inst,variety:"regular",exchange:a.inst.exchange,tradingsymbol:a.inst.tradingsymbol,transaction_type:a.isSell?"SELL":"BUY",orderType:"MARKET",quantity:Math.abs(a.quantity),ltp:0,product:"NRML",validity:"DAY",trigger_price:"0",squareoff:"0",stoploss:"0",trailing_stoploss:"0",user_id:uID})}let i=await Johnston(t),a="";if(i.length>0)for(let e=0;e<i.length;e++){const t=i[e];if(t.length>0){let e=t[0].message;e=e.toLowerCase(),"freeze_quantity_basket_order"==t[0].type?a="freeze":e.includes("market")&&e.includes("blocked")&&(a="market")}}groupWiseNudge.push({name:activeGroupWise[e].name,message:a})}}();pnlFunctionStatus[t]&&isAppActive;){let e=0;currentDayHistory=0;for(let e=0;e<activeGroupWise.length;e++)activeGroupWise[e].profit=0,activeGroupWise[e].callPNL=0,activeGroupWise[e].putPNL=0,activeGroupWise[e].callPremium=0,activeGroupWise[e].putPremium=0;for(let e=0;e<activeGroupExpiryWise.length;e++)activeGroupExpiryWise[e].profit=0,activeGroupExpiryWise[e].callPNL=0,activeGroupExpiryWise[e].putPNL=0,activeGroupExpiryWise[e].callPremium=0,activeGroupExpiryWise[e].putPremium=0;for(let t=0;t<activePositions.length;t++){const i=activePositions[t];i.callPNL=0,i.putPNL=0;let a=await Davidson(i.instrument_token);-1!=a&&(i.last_price=a),i.totalProfit=i.sell_value-i.buy_value+i.quantity*i.quantityMultiplier*i.last_price,i.dayProfit=i.day_sell_value-i.day_buy_value+(i.quantity-i.overnight_quantity)*i.quantityMultiplier*i.last_price,"CE"==i.inst.instrument_type&&(i.callPNL=i.totalProfit+0,i.callPremium=-i.quantity*i.quantityMultiplier*i.average_price),"PE"==i.inst.instrument_type&&(i.putPNL=i.totalProfit+0,i.putPremium=-i.quantity*i.quantityMultiplier*i.average_price),e+=i.totalProfit,currentDayHistory+=i.dayProfit;for(let e=0;e<activeGroupWise.length;e++)if(activeGroupWise[e].name==i.foName){activeGroupWise[e].profit+=i.totalProfit,activeGroupWise[e].callPNL+=i.callPNL,activeGroupWise[e].putPNL+=i.putPNL,activeGroupWise[e].callPremium+=i.callPremium,activeGroupWise[e].putPremium+=i.putPremium;break}for(let e=0;e<activeGroupExpiryWise.length;e++){const t=activeGroupExpiryWise[e];if(t.name==i.foName&&t.expiry==i.expiry){activeGroupExpiryWise[e].profit+=i.totalProfit,activeGroupExpiryWise[e].callPNL+=i.callPNL,activeGroupExpiryWise[e].putPNL+=i.putPNL,activeGroupExpiryWise[e].callPremium+=i.callPremium,activeGroupExpiryWise[e].putPremium+=i.putPremium;break}}}let t=prefGroupExpiryWise.key?activeGroupExpiryWise:activeGroupWise;for(let e=0;e<t.length;e++){let i=t[e];isGroupCalProfitActive&&Hicks(i),Hunt(i)}isFreshPositionLoaded&&(Phillips(e,currentDayHistory),Simpson(e)),Harvey(!isSocketOpen||!isFreshPositionLoaded),await delay(300)}}let testPNLCounter=0;function Dean(e,t){let i={inst:t,totalProfit:0,callPremium:0,putPremium:0,callPNL:0,putPNL:0,dayProfit:0,isSell:e.quantity<0,freezeLimit:void 0,quantityMultiplier:1,exchange:e.exchange,tradingsymbol:e.tradingsymbol,instrument_token:e.instrument_token,product:e.product,quantity:e.quantity,overnight_quantity:e.overnight_quantity,last_price:e.last_price,average_price:e.average_price,pnl:e.pnl,buy_quantity:e.buy_quantity,buy_price:e.buy_price,buy_value:e.buy_value,sell_quantity:e.sell_quantity,sell_price:e.sell_price,sell_value:e.sell_value,day_buy_quantity:e.day_buy_quantity,day_buy_price:e.day_buy_price,day_buy_value:e.day_buy_value,day_sell_quantity:e.day_sell_quantity,day_sell_price:e.day_sell_price,day_sell_value:e.day_sell_value,foName:void 0!==t?t.name:"undefined",expiry:void 0!==t?t.expiry:"undefined"};return"MCX"==e.exchange&&(i.quantityMultiplier=e.multiplier,Armstrong(t.name,e.multiplier)),"BSE"!=e.exchange&&"NSE"!=e.exchange||(i.foName=JSON.stringify(e.tradingsymbol)),"BSE"==e.exchange||"NSE"==e.exchange?i.freezeLimit=kiteEquityCashFreezeLimit:"BFO"!=e.exchange&&"NFO"!=e.exchange||null!=i.foName&&(i.freezeLimit=Bradley(JSON.parse(i.foName))),i}function Sims(e,t,i,a,n){let o;for(let n=0;n<activePositions.length;n++){const r=activePositions[n];let s=1;if(null==r.inst)continue;"CE"==r.inst.instrument_type?s=1:"PE"==r.inst.instrument_type?s=2:"FUT"==r.inst.instrument_type?s=3:"EQ"==r.inst.instrument_type&&(s=4);let l=t;3!=s&&4!=s||(l=0);let c=Math.abs(r.average_price-a);if(r.foName==JSON.stringify(e)&&r.inst.strike==l&&c<=.1&&s==i){o=r.inst;break}}return o}async function Espinoza(){for(;isAppActive;){let e=prefGroupExpiryWise.key?activeGroupExpiryWise:activeGroupWise;for(let t=0;t<e.length;t++){let i=e[t];for(let e=0;e<groupTargetSetObject.length;e++){const t=groupTargetSetObject[e];let a=null==i.expiry?"":i.expiry;if(t.groupName==JSON.parse(i.name)&&t.expiry==a){t.currentPNL=i.profit,t.isStopLossActive&&t.currentPNL<=t.stoploss&&(t.isStopLossActive=!1,t.isTargetActive=!1,Munoz(t,!1),Dixon(!1),Howell(i)),t.isTargetActive&&t.currentPNL>=t.target&&(t.isStopLossActive=!1,t.isTargetActive=!1,Dixon(!1),Howell(i),Munoz(t,!0));break}}}await delay(500)}}async function Howell(e){await delay(10);let t=!1;for(let i=0;i<groupWiseNudge.length;i++){const a=groupWiseNudge[i];if(a.name==e.name&&"market"==a.message){t=!0;break}}let i=e.positions.map((e=>e));i=i.sort(((e,t)=>!e.isSell&&t.isSell?1:!t.isSell&&e.isSell?-1:1));let a=[];for(let e=0;e<i.length;e++){let t=i[e],n=t.freezeLimit,o=Math.abs(t.quantity);if(o>n&&null!=n){let e=t.inst.lot_size,i=o/e,r=Math.ceil(o/n),s=distributeNumber(i,r);for(let i=0;i<s.length;i++){let n=JSON.parse(JSON.stringify(t));n.quantity=s[i]*e,a.push(n)}}else a.push(t)}for(let e=0;e<a.length;e++){const i=a[e];if(0==i.quantity)continue;let n=0;if(t){let e=getProtectedBuyPrice(i.ltp),t=getProtectedSellPrice(i.ltp),a=i.isSell?t:e;a=(Math.ceil(20*a)/20).toFixed(2)}let o={variety:"regular",exchange:i.exchange,tradingsymbol:i.tradingsymbol,transaction_type:i.isSell?"BUY":"SELL",order_type:t?"LIMIT":"MARKET",quantity:Math.abs(i.quantity),price:n,product:i.product,validity:"DAY",trigger_price:"0",squareoff:"0",stoploss:"0",trailing_stoploss:"0",user_id:uID},r=await Wheeler(o);null!=r.ok&&r.ok||(await r.json(),showPlusMessage(document,"Error Exiting Positions","error")),await delay(15)}}let syntheticList=[];async function Li(){await Pierce(),await delay(5e3)}let watchListSyntheticList=[],basketSyntheticList=[],ivChartSyntheticList=[],positionSyntheticList=[];function Wong(e,t){for(let i=0;i<e.length;i++)if(e[i].symbol==t.symbol&&e[i].expiry==t.expiry)return!0;return!1}async function Reid(e,t){watchListSyntheticList.push({symbol:e,expiry:t}),Weber(e,t)}async function Hanson(){let e=watchListSyntheticList.filter((e=>!Wong(basketSyntheticList,e)));e=e.filter((e=>!Wong(positionSyntheticList,e))),e=e.filter((e=>!Wong(ivChartSyntheticList,e)));for(let t=0;t<e.length;t++){const i=e[t];Wang(i.symbol,i.expiry)}watchListSyntheticList=[]}async function Le(e,t){ivChartSyntheticList.push({symbol:e,expiry:t}),Weber(e,t)}async function McCoy(e,t){basketSyntheticList.push({symbol:e,expiry:t}),Weber(e,t)}async function Garrett(){let e=basketSyntheticList.filter((e=>!Wong(watchListSyntheticList,e)));e=e.filter((e=>!Wong(positionSyntheticList,e))),e=e.filter((e=>!Wong(ivChartSyntheticList,e)));for(let t=0;t<e.length;t++){const i=e[t];Wang(i.symbol,i.expiry)}basketSyntheticList=[]}async function Burton(e,t){Wong(positionSyntheticList,{symbol:e,expiry:t})||(positionSyntheticList.push({symbol:e,expiry:t}),Weber(e,t))}async function Fuller(e,t){let i=[];return i=syntheticList.filter((i=>i.symbol==e&&i.expiry==t)),i.length>0?i[0]:-1}async function Wang(e,t){let i=syntheticList.find((i=>i.symbol==e&&i.expiry==t));null!=i&&(i.isRunning=!1),Rios(i.tokenList)}async function Weber(e,t){let i,a,n,o=syntheticList.find((i=>i.symbol==e&&i.expiry==t));if(null!=o&&null!=o){if(i=o,i.isRunning)return;i.isRunning=!0,i.isReady=!1,i.tokenList=[]}else i={isRunning:!0,isReady:!1,baseTickData:-1,symbol:e,expiry:t,atmStrike:-1,straddlePrice:-1,cePrice:-1,pePrice:-1,price:-1,thetaPrice:-1,ceTheta:-1,peTheta:-1,atmIV:-1,tokenList:[],actualExpiry:void 0},syntheticList.push(i);let r=-1,s=!1,l=Hart(e);for(;isAppActive&&null==l;)l=Hart(e),await delay(10);George([l]);let c=await Schultz(l);for(;isAppActive&&i.isRunning;){let o=Fowler(c);if(a=await Hansen(JSON.stringify(e),o.last_price,t),null==a){await delay(100);continue}let l=parseFloat(a.CE.strike),u=l,d=JSON.parse(a.CE.instrument_token),f=JSON.parse(a.PE.instrument_token),p=d,m=f,y=-1,g=-1,S=-1,h=-1;i.actualExpiry=a.expiry;let w=new Date;if(!isNaN(Date.parse(i.actualExpiry))){let e=new Date(i.actualExpiry);w=new Date(e.getFullYear(),e.getMonth(),e.getDate(),15,30,0,0)}i.baseTickData=o,-1!=i.price&&(s=!0,n=await Hansen(JSON.stringify(e),i.price,t),u=parseFloat(n.CE.strike),p=JSON.parse(n.CE.instrument_token),m=JSON.parse(n.PE.instrument_token));let b=[d,f,p,m];George(b),i.tokenList=[...new Set([...i.tokenList,...b])];let k=await Luna(d),M=await Luna(f),v=await Luna(p),C=await Luna(m);if(-1==k||-1==M||-1==v||-1==C){await delay(1e3);continue}let P=(new Date).getTime();for(;isAppActive&&!((new Date).getTime()-P>1e4)&&(s||-1==i.price);){let e=s?500:25,t=Fowler(k);if(y=t.last_price,g=Fowler(M).last_price,s&&(S=Fowler(v).last_price,h=Fowler(C).last_price,-1!=S&&-1!=h&&(i.isReady=!0)),-1!=y&&-1!=g){r=l+y-g;let e=!1,a=getYearDiff(t.last_trade_time,w);8760*a<.0833&&(e=!0);let n=r-u;if(i.atmStrike=u,i.cePrice=S,i.pePrice=h,i.straddlePrice=S+h,i.price=r,i.thetaPrice=S+h-Math.abs(n),i.ceTheta=n>0?i.cePrice-n:i.cePrice,i.peTheta=n<0?i.pePrice+n:i.pePrice,i.yearDiff=a,e)i.atmIV=-1;else{let e=100*Vega(!0,r,u,a,.07,i.cePrice),t=100*Vega(!1,r,u,a,.07,i.pePrice);i.atmIV=(e+t)/2,i.ceIV=e,i.peIV=t,i.atmIV<=0&&(i.atmIV=1),i.atmIV>100&&(i.atmIV=100)}}await delay(e)}await delay(100)}}const tickerDebugUpdateEvent=new Event("onTickerDebugUpdate");async function Welch(){document.dispatchEvent(tickerDebugUpdateEvent)}async function Rojas(){if(isReal)return;await Pierce();let e=!1,t=document.createElement("div");(await querySelectWait(document,".app")).appendChild(t),t.id="TickerDebugWindow";let i=Moreno("TickerDebugWindow");t.innerHTML=i,makeDraggable(t);let a=t.querySelector(".globalTickers .tickerData"),n=t.querySelector(".positionTickers .tickerData"),o=t.querySelector(".basketTickers .tickerData"),r=t.querySelector(".indexMetaTickers .tickerData"),s=t.querySelector(".pendingUnSubTickers .tickerData"),l=t.querySelector(".globalTickers .tokenCount"),c=t.querySelector(".positionTickers .tokenCount"),u=t.querySelector(".basketTickers .tokenCount"),d=t.querySelector(".indexMetaTickers .tokenCount"),f=t.querySelector(".pendingUnSubTickers .tokenCount"),p=t.querySelector(".refreshButton"),m=!1;async function y(){t.style.visibility=e?"visible":"collapse"}function g(e,t,i){t.innerHTML="",i.innerText="("+e.length+")";let a=[];for(let t=0;t<e.length;t++){let i=Vazquez(e[t],"NFO");a.push(Santos(i))}a.sort();for(let e=0;e<a.length;e++){const i=a[e];let n=document.createElement("div");n.innerText=i,t.appendChild(n)}}document.querySelector("#statusRootDiv").addEventListener("click",(function(t){if(t.ctrlKey)return e=!0,void y()})),document.addEventListener("onTickerDebugUpdate",(function(e){m=!0})),p.addEventListener("click",(function(t){e=!1,y()})),async function(){for(;isAppActive;)m&&(g(tokenSet_Global,a,l),g(tokenSet_Positions,n,c),g(tokenSet_Baskets,o,u),g(tokenSet_IndexMeta,r,d),g(tokenSet_PendingUnSub,s,f),m=!1),await delay(500)}(),y()}let instConstants=[];async function Yang(){isAPIMode||(instConstants.push({name:"NIFTY 50",foName:"NIFTY",instToken:"256265",lastPrice:-1}),instConstants.push({name:"NIFTY BANK",foName:"BANKNIFTY",instToken:"260105",lastPrice:-1}),instConstants.push({name:"NIFTY FIN SERVICE",foName:"FINNIFTY",instToken:"257801",lastPrice:-1}),instConstants.push({name:"NIFTY MID SELECT",foName:"MIDCPNIFTY",instToken:"288009",lastPrice:-1}),instConstants.push({name:"SENSEX",foName:"SENSEX",instToken:"265",lastPrice:-1}),instConstants.push({name:"BANKEX",foName:"BANKEX",instToken:"274441",lastPrice:-1}),Banks())}async function Banks(){await delay(20);let e,t=!1;for(;!t&&isAppActive;)e=document.querySelectorAll(".header-left .instrument-widget"),0!=e.length&&null!=e[0].querySelector(".last-price")&&(t=!0),await delay(100);for(;isAppActive;){for(let t=0;t<e.length;t++){let i=e[t].querySelector(".tradingsymbol"),a=e[t].querySelector(".last-price");if(null!=i){let e=-1,t=i.innerText,n=instConstants.findIndex((e=>e.name===t));-1!=n?null!=a&&(e=parseFloat(a.innerText.replace(/,+,/g,"")),instConstants[n].lastPrice=e):(e=parseFloat(a.innerText.replace(/,+,/g,"")),isNaN(e)||instConstants.push({name:t,instToken:Hart(t),foName:t,lastPrice:e}))}}await delay(1500)}}let kt_tooltip,kt_CustomTooltip,kt_StaticCustomTooltip,tickDatabase=[];function Padilla(e){let t=tickDatabase.find((t=>t.instrument_token===e.instrument_token));null==t?tickDatabase.push({instrument_token:e.instrument_token,isActive:!0,isInit:!0,last_price:e.last_price,ohlc:e.ohlc,change:e.change,depth:e.depth,last_trade_time:e.last_trade_time}):(t.isActive&&(t.isInit=!0),t.last_price=e.last_price,t.depth=e.depth,t.depth=e.depth,t.last_trade_time=e.last_trade_time)}function Day(e){let t=tickDatabase.find((t=>t.instrument_token===e));return null!=t&&t.isInit}function Walsh(e){for(let t=0;t<tickDatabase.length;t++){const i=tickDatabase[t];for(let t=0;t<e.length;t++)if(e[t]==i.instrument_token){i.isActive=!0;break}}}function Bowman(e){for(let t=0;t<tickDatabase.length;t++){const i=tickDatabase[t];for(let t=0;t<e.length;t++)e[t]==i.instrument_token&&(i.isActive=!1,i.isInit=!1)}}async function Schultz(e){for(;isAppActive;){let t=tickDatabase.findIndex((t=>t.instrument_token===e));if(-1!=t&&tickDatabase[t].isActive)return t;await delay(50)}}async function Luna(e){let t=0;for(;isAppActive;){let i=tickDatabase.findIndex((t=>t.instrument_token===e));if(-1!=i&&tickDatabase[i].isActive)return i;if(t++,t>50)return-1;await delay(50)}}function Fowler(e){return tickDatabase[e]}async function Mejia(e){if(isAPIMode){let t=0;for(;isAppActive;){let i=tickDatabase.findIndex((t=>t.instrument_token===e));if(-1!=i)return tickDatabase[i];if(t++,t>50)return-1;await delay(50)}}return-1}async function Davidson(e){if(!isAPIMode){let t=instConstants.findIndex((t=>t.instToken===e));return-1!=t?instConstants[t].lastPrice:-1}{let t=0;for(;isAppActive;){let i=tickDatabase.findIndex((t=>t.instrument_token===e));if(-1!=i&&tickDatabase[i].isActive)return tickDatabase[i].last_price;if(t++,t>50)return-1;await delay(50)}}}function Acosta(){kt_tooltip=document.createElement("div"),kt_tooltip.className="kt-tooltip",document.body.appendChild(kt_tooltip),kt_CustomTooltip=document.createElement("div"),kt_CustomTooltip.className="kt-tooltip",document.body.appendChild(kt_CustomTooltip),kt_StaticCustomTooltip=document.createElement("div"),kt_StaticCustomTooltip.className="kt-tooltip",document.body.appendChild(kt_StaticCustomTooltip)}function Brewer(e){e.querySelectorAll("[kt-tooltip]").forEach((e=>{let t=e.getAttribute("kt-tooltip");if(t){let i,a=kt_tooltip;a.style.visibility="visible",e.addEventListener("mouseenter",(()=>{t=e.getAttribute("kt-tooltip"),a.innerText=t,i=setTimeout((()=>{Juarez(e,a),a.style.visibility="visible",a.style.opacity="1",Juarez(e,a)}),500)})),e.addEventListener("mouseleave",(()=>{clearTimeout(i),a.style.visibility="hidden",a.style.opacity="0",a.innerText=""}))}}))}function May(e,t){let i={isActive:!1,content:""};return e.querySelectorAll(t).forEach((e=>{let t=e.getAttribute("kt-tooltip");if(t){let a,n=kt_CustomTooltip;e.addEventListener("mouseenter",(()=>{i.isActive=!0,t=e.getAttribute("kt-tooltip"),n.innerHTML=i.content,a=setTimeout((()=>{Juarez(e,n),n.innerHTML=i.content,n.style.visibility="visible",n.style.opacity="1",Juarez(e,n)}),300)})),e.addEventListener("mouseleave",(()=>{i.isActive=!1,clearTimeout(a),n.style.visibility="hidden",n.style.opacity="0"}))}})),i}function Holland(e,t,i){e.querySelectorAll(t),e.querySelectorAll(t).forEach((e=>{let t=e.getAttribute("kt-tooltip");if(t){let a,n=kt_StaticCustomTooltip;e.addEventListener("mouseenter",(()=>{t=e.getAttribute("kt-tooltip"),n.innerHTML=i,a=setTimeout((()=>{Juarez(e,n),n.style.visibility="visible",n.style.opacity="1",Juarez(e,n)}),300)})),e.addEventListener("mouseleave",(()=>{clearTimeout(a),n.style.visibility="hidden",n.style.opacity="0"}))}}))}async function Juarez(e,t){const i=e.getBoundingClientRect(),a=t.offsetWidth,n=t.offsetHeight;let o=0,r=0;o=i.top+window.scrollY-n-8,r=i.left+window.scrollX+(i.width-a)/2,t.style.top=`${o}px`,t.style.left=`${r}px`}async function Newman(){if(isWatchListFeatureEnabled){document.querySelector("#watchListSettingButton").addEventListener("click",(function(){document.querySelector("#tabToggle02").checked=!0,utilityContainer.style.display="block",Jordan()}));let e=document.querySelector("#watchListDeleteButton");null!=e&&e.addEventListener("dblclick",(function(){Pearson()}));let t=document.querySelector("#watchListGenerateButton");null!=t&&t.addEventListener("dblclick",(function(){Curtis()}))}}let isGenerateButtonBlocked=!1,isDeleteButtonBlocked=!1,autoFetchCheck=!1;async function Pearson(){isWatchListFeatureEnabled&&(isDeleteButtonBlocked||(isDeleteButtonBlocked=!0,Figueroa()))}let isGenerateAvailable=!0;async function Curtis(){isAPIMode?isGenerateAvailable&&(isGenerateAvailable=!1,await Cortez(),isGenerateAvailable=!0):showPlusMessage(document,"Feature is not available at the moment","error")}async function Cortez(){showPlusMessage(document,"Loading Instruments...","info");let e=await fetchSyncStorage("prefTotalStrikesKey"),t=await fetchSyncStorage("prefITMStrikesKey");e=parseInt(e),t=parseInt(t);let i,a=await fetchSyncStorage("prefStrikeOrderFormatKey"),n=await fetchSyncStorage("prefOptionChainTypeKey"),o=[],r=document.querySelector(".vddl-list").querySelectorAll(".instrument"),s=document.querySelector(".marketwatch-sidebar .item.selected"),l=-1;if(null==s)return void showPlusMessage(document,"Try again! errorCode wl101","error");let c=!0;if(0==r.length){if(!isIndexMetaInit)return void showPlusMessage(document,"Add desired instrument at the first slot","error");c=!1}if(c){let e,t=await Perkins();if(-1==t)return void showPlusMessage(document,"Try again! errorCode wl102","error");for(let i=0;i<t.length;i++){const a=t[i];if(a.id==s.innerText){e=a;break}}if(0==e.items.length)return void showPlusMessage(document,"Add desired instrument at the first slot","error");for(let t=1;t<e.items.length;t++){const i=e.items[t];"NFO"!=i.exchange&&"BFO"!=i.exchange&&"FIT"!=i.segment&&o.push(i)}let a,n=e.items[0],c="",u="";if(!instLoaded)return void showPlusMessage(document,"Try again later! errorCode wl100","error");if("NFO"==n.exchange||"BFO"==n.exchange||"MCX"==n.exchange){a=n.expiry;let e,t=Vazquez(n.instrument_token,n.exchange,null);if(null==t)return void showPlusMessage(document,"Try again! errorCode wl103","error");if("MCX"!=n.exchange){if(e=Hart(JSON.parse(t.name)),null==e)return void showPlusMessage(document,"Try again! errorCode wl104","error")}else e=JSON.parse(Cunningham(t.name).instrument_token);if(u=JSON.parse(t.name),c=e,Guerrero([c]),l=await Davidson(c),-1==l)return void showPlusMessage(document,"Try again! LTP error","error")}else{if("NSE"!=n.exchange&&"BSE"!=n.exchange)return void showPlusMessage(document,"Feature not available for this exchange","error");{let e=r[0].querySelector(".last-price");if(l=e.innerText,c=n.instrument_token,u=Knight(n.tradingsymbol),isIndexMetaInit&&u==prefIndexMetaSymbol&&null!=prefIndexMetaExpiry)a=prefIndexMetaExpiry;else{let e=Duncan(JSON.stringify(u));if(0==e.length)return void showPlusMessage(document,"Feature not available for this exchange","error");a=e[0]}}}if(-1==l)return void showPlusMessage(document,"Try again! errorCode wl106","error");i="MCX"!=n.exchange?Andrews(JSON.stringify(u),a):Riley(JSON.stringify(u),a)}else{let e=prefIndexMetaSymbol,t=prefIndexMetaExpiry;if(null==t)return void showPlusMessage(document,"Feature not available for this exchange","error");let a=await Fuller(e,t);if(-1==a)return void showPlusMessage(document,"Price Fetch Error! not available for this exchange","error");l=a.price,i=Andrews(JSON.stringify(e),t)}if(i=i.filter((e=>"FUT"!=e.instrument_type)),null==i||0==i.length)return void showPlusMessage(document,"No instruments available to add","error");i.sort((function(e,t){return parseInt(e.strike)>parseInt(t.strike)?1:-1}));let u=i.filter((e=>"CE"==e.instrument_type)),d=i.filter((e=>"PE"==e.instrument_type)),f=u.map((e=>e));f.sort((function(e,t){return Math.abs(l-parseInt(e.strike))-Math.abs(l-parseInt(t.strike))}));let p=0;if(null==f[0])return void showPlusMessage(document,"Can't find instruments to add","error");p=f[0].strike;let m=u.findIndex((e=>e.strike==p)),y=d.findIndex((e=>e.strike==p)),g=groupBy(i,"strike"),S=Object.keys(g),h=S.findIndex((e=>e==p)),w=[],b=Math.max(m-t,0),k=Math.min(y+t,d.length-1),M=Math.ceil(e/2),v=Math.min(h-Math.floor(M/2),S.length),C=!1,P=[],x=[];if("ATM"==n&&(C=!0),C)for(let e=0;e<M;e++){let t=S[v+e];w.push(g[t][1]),w.push(g[t][0])}else{for(let t=0;t<e/2;t++)k-t<0||x.push(d[k-t]);for(let t=0;t<e/2;t++)b+t>=u.length||P.push(u[b+t])}if("PE"==a?(x.reverse(),w.push(...x),w.push(...P)):(w.push(...P),x.reverse(),w.push(...x)),e>65){for(let e=0;e<o.length;e++){const t=o[o.length-e-1];w.unshift(t)}let e=await Berry(w,s.innerText);if(1==e)return;-1==e&&showPlusMessage(document,"Try again! error wl109","error")}await Figueroa();let T=null;for(;null==T;)T=document.querySelector(".marketwatch-sidebar .omnisearch input"),await delay(50);let I=document.querySelector(".marketwatch-sidebar .omnisearch");I.style.visibility="hidden";for(let e=0;e<w.length;e++)T.value=w[e].tradingsymbol,T.dispatchEvent(new Event("input",{bubbles:!0})),await delay(5),document.querySelector(".omnisearch-results .results-item").dispatchEvent(new MouseEvent("click")),await delay(5);I.style.visibility="visible"}async function Douglas(){if(!isWatchListFeatureEnabled)return;if(isGenerateButtonBlocked&&showPlusMessage(document,"Wait or try refreshing the page","error"),autoFetchCheck)return;if(isGenerateButtonBlocked)return;isGenerateButtonBlocked=!0,showPlusMessage(document,"Loading instruments....","info"),await setSyncStorage("validSensiSession",!0),await Figueroa(),await delay(15);let e=document.querySelector("body");e.classList.add("hiddenOC"),await setSyncStorage("isAutoGenerate",!0),Navarro();let t=document.querySelector(".container-left .instruments");!async function(){let i=(new Date).getTime();autoFetchCheck=!0;let a=!1;for(;autoFetchCheck&&isAppActive;){if(autoFetchCheck=await fetchSyncStorage("isAutoGenerate"),((new Date).getTime()-i)/1e3>10){autoFetchCheck=!1,await setSyncStorage("isAutoGenerate",!1),a=!0;break}await delay(100)}if(!a){let e=await fetchSyncStorage("sensiCallBack");"success"==e?showPlusMessage(document,"Instruments loaded successfully","normal"):"fail"==e&&showPlusMessage(document,"Try again","error")}a&&showPlusMessage(document,"Timeout! Try again","error");let n=document.querySelector(".option-chain-modal .modal-wrapper");null!=n&&n.dispatchEvent(new MouseEvent("mousedown",{view:window,bubbles:!0,cancelable:!1})),isGenerateButtonBlocked=!1,e.classList.remove("hiddenOC"),null!=t&&(t.scrollTop=0),await setSyncStorage("validSensiSession",!1)}()}let farOTMPreset={totalStrikes:48,itmStrikes:-3},stranglePreset={totalStrikes:48,itmStrikes:-3};async function Joseph(){await setSyncStorage("sensiCallBack","NA");let e=document.querySelector("#idPrefOptionChainType"),t=document.querySelector("#idPrefTotalStrikes"),i=document.querySelector("#idPrefITMStrikes");isPrem&&("ATM"==e.value&&(i.disabled=!0),e.addEventListener("change",(async function(){let a=e.value;i.disabled=!1,"OTM"==a?(i.value=2,t.value=44,await setSyncStorage("prefITMStrikesKey",i.value),await setSyncStorage("prefTotalStrikesKey",t.value)):"FAR_OTM"==a?(i.value=-4,t.value=48,await setSyncStorage("prefITMStrikesKey",i.value),await setSyncStorage("prefTotalStrikesKey",t.value)):"ATM"==a&&(t.value=20,await setSyncStorage("prefTotalStrikesKey",t.value),i.disabled=!0)})))}function Barrett(e){var t=document.querySelector("#messageParent");t.style.display="block";var i=t.querySelector("#messageBody");t.querySelector("#messageCloseBtn").addEventListener("click",(function(){document.querySelector("#messageParent").style.display="none"})),i.innerText=e}async function Navarro(){let e;await delay(100);let t=document.querySelector(".vddl-list").querySelectorAll(".instrument");if(0==t.length)return await setSyncStorage("isAutoGenerate",!1),await setSyncStorage("sensiCallBack",""),void showPlusMessage(document,"Add desired instrument at the first slot","error");let i=t[0];i.classList.add("hideInstrument"),await delay(400);let a=i.querySelector(".info");for(a.dispatchEvent(new MouseEvent("mouseenter",{view:window,bubbles:!0,cancelable:!1}));null==e&&isAppActive;)e=i.querySelector(".context-menu-button"),await delay(waitMS);await delay(50),e.parentElement.dispatchEvent(new MouseEvent("click")),await delay(100);let n=i.querySelectorAll("li");if(null==n)return await setSyncStorage("isAutoGenerate",!1),await setSyncStorage("sensiCallBack",""),i.classList.remove("hideInstrument"),void showPlusMessage(document,"Try again","error");let o=n[n.length-1];if(null==o)return await setSyncStorage("isAutoGenerate",!1),await setSyncStorage("sensiCallBack",""),i.classList.remove("hideInstrument"),void showPlusMessage(document,"Try again","error");if(!o.querySelector("span").innerText.toLowerCase().includes("option"))return await setSyncStorage("isAutoGenerate",!1),await setSyncStorage("sensiCallBack",""),showPlusMessage(document,"Can't load option chain for this instrument","error"),void i.classList.remove("hideInstrument");let r=n[n.length-1].querySelector("a");r.removeAttribute("href"),r.dispatchEvent(new MouseEvent("click")),await delay(50),a.dispatchEvent(new MouseEvent("mouseleave",{view:window,bubbles:!0,cancelable:!1})),await delay(100),i.classList.remove("hideInstrument")}async function Figueroa(){let e=document.querySelector(".vddl-list"),t=(document.querySelector(".container-left .instruments"),e.querySelectorAll(".instrument"));for(let e=0;e<t.length;e++){let i,a=t[e].querySelector(".info"),n=a.querySelector(".nice-name");if(null==n||n.innerText.includes(" CE")||n.innerText.includes(" PE")){for(a.dispatchEvent(new MouseEvent("mouseenter",{view:window,bubbles:!0,cancelable:!1}));null==i&&isAppActive;)i=a.parentElement.querySelector(".actions"),await delay(waitMS);Keller(a),await delay(30)}}isDeleteButtonBlocked=!1}function Keller(e){let t=e.parentElement.querySelector("[aria-label='Delete']");null!=t&&t.dispatchEvent(new MouseEvent("click"))}